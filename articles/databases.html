

<!DOCTYPE html>
<html class="writer-html5" lang="ru" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üóÑÔ∏è –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ SQL &mdash; –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è projectTemplate 0.1</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
      <link rel="stylesheet" type="text/css" href="../_static/custom.css" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=490fdf2e"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../_static/copybutton.js?v=f281be69"></script>
      <script>let toggleHintShow = '–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å';</script>
      <script>let toggleHintHide = '–°–≤–µ—Ä–Ω—É—Ç—å';</script>
      <script>let toggleOpenOnPrint = 'true';</script>
      <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
      <script src="../_static/translations.js?v=cd1d70c9"></script>
      <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
      <script src="../_static/custom.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="–ê–ª—Ñ–∞–≤–∏—Ç–Ω—ã–π —É–∫–∞–∑–∞—Ç–µ–ª—å" href="../genindex.html" />
    <link rel="search" title="–ü–æ–∏—Å–∫" href="../search.html" />
    <link rel="next" title="üìö –†–∞–±–æ—Ç–∞ —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π" href="documentation.html" />
    <link rel="prev" title="Recommendations: –ü–æ–ª–µ–∑–Ω—ã–µ –¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è" href="recommendations.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #2980B9" >

          
          
          <a href="../index.html" class="icon icon-home">
            projectTemplate
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="–ü–æ–∏—Å–∫ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏" aria-label="–ü–æ–∏—Å–∫ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="–ú–µ–Ω—é –Ω–∞–≤–∏–≥–∞—Ü–∏–∏">
              <p class="caption" role="heading"><span class="caption-text">–í–≤–µ–¥–µ–Ω–∏–µ:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">üìú Overview: –û–±–∑–æ—Ä —à–∞–±–ª–æ–Ω–∞</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">‚öôÔ∏è Getting started: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —à–∞–±–ª–æ–Ω–∞</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">–û—Å–Ω–æ–≤—ã:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="basics.html">üó∫Ô∏è Roadmap: –∫–∞–∫ —Ä–∞–±–æ—Ç–∞—Ç—å —Å —à–∞–±–ª–æ–Ω–æ–º</a></li>
<li class="toctree-l1"><a class="reference internal" href="recommendations.html">Recommendations: –ü–æ–ª–µ–∑–Ω—ã–µ –¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">üóÑÔ∏è –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ SQL</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#sqlite">üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å SQLite</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id1">üõ†Ô∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î</a></li>
<li class="toctree-l2"><a class="reference internal" href="#sqlalchemy">üß© SQLAlchemy</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#engine">üöÄ –î–≤–∏–∂–æ–∫ (Engine)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#session">üß≠ –°–µ—Å—Å–∏—è (Session)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id2">–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã —Å–µ—Å—Å–∏–∏</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#sessionmaker">üè≠ –§–∞–±—Ä–∏–∫–∞ —Å–µ—Å—Å–∏–π (Sessionmaker)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#connection">üß© –î–µ–∫–æ—Ä–∞—Ç–æ—Ä <code class="docutils literal notranslate"><span class="pre">&#64;connection</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#orm">üìä ORM</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#base">üß± –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å <code class="docutils literal notranslate"><span class="pre">Base</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#user">üß© –ú–æ–¥–µ–ª—å <code class="docutils literal notranslate"><span class="pre">User</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#id3">üèóÔ∏è –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –º–æ–¥–µ–ª–∏</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id4">üîÑ –ò–∑–º–µ–Ω–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id5">üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π –≤ –ë–î</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#alembic-env-py">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ <code class="docutils literal notranslate"><span class="pre">alembic/env.py</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#src-databases-sqlite-models-init-py">–≠–∫—Å–ø–æ—Ä—Ç –≤ <code class="docutils literal notranslate"><span class="pre">src/databases/sqlite/models/__init__.py</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#id6">–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id7">üîó –û—Ç–Ω–æ—à–µ–Ω–∏—è –º–µ–∂–¥—É ORM-–º–æ–¥–µ–ª—è–º–∏</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id8">–¢–∏–ø—ã –æ—Ç–Ω–æ—à–µ–Ω–∏–π</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#one-to-one">üîÑ One-to-One (–û–¥–∏–Ω –∫ –æ–¥–Ω–æ–º—É)</a></li>
<li class="toctree-l5"><a class="reference internal" href="#one-to-many-many-to-one">üîÑ One-to-Many / Many-to-One (–û–¥–∏–Ω –∫–æ –º–Ω–æ–≥–∏–º / –ú–Ω–æ–≥–∏–µ –∫ –æ–¥–Ω–æ–º—É)</a></li>
<li class="toctree-l5"><a class="reference internal" href="#many-to-many">üîÑ Many-to-Many (–ú–Ω–æ–≥–∏–µ –∫–æ –º–Ω–æ–≥–∏–º)</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#pydantic">üìã Pydantic</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id9">–í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥—è—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id10">–°–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏—Å—Ö–æ–¥—è—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö (–°—Ö–µ–º—ã –æ—Ç–≤–µ—Ç–∞)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#dao">üèóÔ∏è DAO</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#basedao">–ö–ª–∞—Å—Å <code class="docutils literal notranslate"><span class="pre">BaseDAO</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#userdao">–ö–ª–∞—Å—Å <code class="docutils literal notranslate"><span class="pre">UserDAO</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id11">–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id12">–ù–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –æ—Ç <code class="docutils literal notranslate"><span class="pre">BaseDAO</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#id13">–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#crud">üß± CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#create">üßÆ –°–æ–∑–¥–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (Create)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id14">–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–¥–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id15">–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id16">–°–ª–æ–∂–Ω—ã–µ —Å–ª—É—á–∞–∏: –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–∞–±–ª–∏—Ü</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#read">üìñ –ß—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (Read)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#session-get-vs-select-id"><code class="docutils literal notranslate"><span class="pre">session.get()</span></code> vs <code class="docutils literal notranslate"><span class="pre">select()</span></code> –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ–¥–Ω–æ–π –∑–∞–ø–∏—Å–∏ –ø–æ ID</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id-session-get">–ü–æ–ª—É—á–µ–Ω–∏–µ –æ–¥–Ω–æ–π –∑–∞–ø–∏—Å–∏ –ø–æ ID (—Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º <code class="docutils literal notranslate"><span class="pre">session.get()</span></code>)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id17">–ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∑–∞–ø–∏—Å–µ–π</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id18">–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id19">–í—ã–±–æ—Ä–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –∫–æ–ª–æ–Ω–æ–∫</a></li>
<li class="toctree-l4"><a class="reference internal" href="#select-options">–ü–æ–¥–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö (–û—Ç–Ω–æ—à–µ–Ω–∏—è) (—Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º <code class="docutils literal notranslate"><span class="pre">select()</span></code> –∏ <code class="docutils literal notranslate"><span class="pre">options()</span></code>)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#update">üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (Update)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id20">–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id21">–ú–∞—Å—Å–æ–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ <code class="docutils literal notranslate"><span class="pre">update()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#delete">üóëÔ∏è –£–¥–∞–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (Delete)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id22">–£–¥–∞–ª–µ–Ω–∏–µ –≤ —Å—Ç–∏–ª–µ –û–û–ü</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id23">–ú–∞—Å—Å–æ–≤–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ <code class="docutils literal notranslate"><span class="pre">delete()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#id24">–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã —É–¥–∞–ª–µ–Ω–∏—è –≤ <code class="docutils literal notranslate"><span class="pre">BaseDAO</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#alembic">üß≠ Alembic: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ö–µ–º–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id25">üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Alembic (—É–∂–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –≤ —à–∞–±–ª–æ–Ω–µ)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id26">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ <code class="docutils literal notranslate"><span class="pre">alembic/env.py</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id27">1. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è ORM-–º–æ–¥–µ–ª–µ–π</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id28">2. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id29">üîÑ –†–∞–±–æ—Ç–∞ —Å –º–∏–≥—Ä–∞—Ü–∏—è–º–∏</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id30">–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id31">–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id32">–û—Ç–∫–∞—Ç –º–∏–≥—Ä–∞—Ü–∏–∏</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="documentation.html">üìö –†–∞–±–æ—Ç–∞ —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π</a></li>
<li class="toctree-l1"><a class="reference internal" href="diagrams.html">üìù –î–∏–∞–≥—Ä–∞–º–º—ã –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –∏ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏</a></li>
<li class="toctree-l1"><a class="reference internal" href="c4_model.html"><aside class="system-message">
<p class="system-message-title">System Message: WARNING/2 (<span class="docutils literal">/home/runner/work/projectTemplate/projectTemplate/docs/articles/c4_model.md</span>, line 1)</p>
<p>Substitution error:UndefinedError: ‚Äûdiagram‚Äú is undefined [myst.substitution]</p>
</aside>
 C4 Model</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="–ú–µ–Ω—é –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤"  style="background: #2980B9" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">projectTemplate</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="–ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">üóÑÔ∏è –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ SQL</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/maxlansky/projectTemplate/blob/mainarticles/databases.md" class="fa fa-github"> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="sql">
<h1>üóÑÔ∏è –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ SQL<a class="headerlink" href="#sql" title="–°—Å—ã–ª–∫–∞ –Ω–∞ —ç—Ç–æ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫">ÔÉÅ</a></h1>
<p>#TODO: —É–ª—É—á—à–∏—Ç—å –¥–∏–∞–≥—Ä–∞–º–º—ã C4</p>
<p>–í —à–∞–±–ª–æ–Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å —Ä–µ–ª—è—Ü–∏–æ–Ω–Ω—ã–º–∏ –±–∞–∑–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ <strong>SQLAlchemy 2.0+</strong>.<br />
–í —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ <strong>SQLite</strong>, –Ω–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –∏ –¥—Ä—É–≥–∏–µ –ë–î.</p>
<p>SQLite ‚Äî —ç—Ç–æ <strong>–≤—Å—Ç—Ä–∞–∏–≤–∞–µ–º–∞—è</strong> —Ä–µ–ª—è—Ü–∏–æ–Ω–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä–∞—è <strong>–Ω–µ —Ç—Ä–µ–±—É–µ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞</strong>.<br />
–û–Ω–∞ <strong>—Ö—Ä–∞–Ω–∏—Ç –≤—Å—é –±–∞–∑—É –≤ –æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ</strong>, —á—Ç–æ –¥–µ–ª–∞–µ—Ç –µ—ë <strong>–∏–¥–µ–∞–ª—å–Ω–æ–π –¥–ª—è</strong>:</p>
<ul class="simple">
<li><p><strong>–†–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ –ø—Ä–æ—Ç–æ—Ç–∏–ø–∏—Ä–æ–≤–∞–Ω–∏—è</strong> ‚Äî –±—ã—Å—Ç—Ä–æ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è, <strong>–Ω–µ –Ω—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å</strong> —Å–µ—Ä–≤–µ—Ä –ë–î.</p></li>
<li><p><strong>–ù–µ–±–æ–ª—å—à–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤</strong> ‚Äî –≥–¥–µ <strong>–Ω–µ –Ω—É–∂–Ω–∞ –≤—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞</strong> –∏–ª–∏ <strong>–º–Ω–æ–≥–æ–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –¥–æ—Å—Ç—É–ø</strong>.</p></li>
<li><p><strong>–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</strong> ‚Äî –ª–µ–≥–∫–æ –æ—á–∏—â–∞—Ç—å, —Å–±—Ä–∞—Å—ã–≤–∞—Ç—å, –∑–∞–ø—É—Å–∫–∞—Ç—å –≤ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å—Ä–µ–¥–µ.</p></li>
<li><p><strong>–õ–æ–∫–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞</strong> ‚Äî <strong>–Ω–µ –Ω—É–∂–Ω–æ –Ω–∏—á–µ–≥–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å</strong>, –∫—Ä–æ–º–µ Python –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π.</p></li>
</ul>
<div class="warning admonition">
<p class="admonition-title">–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ</p>
<p>–î–ª—è <strong>–ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞</strong> –∏ <strong>—Å–µ—Ä—å—ë–∑–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤</strong> —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å <strong>PostgreSQL</strong> –∏–ª–∏ –¥—Ä—É–≥—É—é <strong>—Å–µ—Ä–≤–µ—Ä–Ω—É—é –°–£–ë–î</strong>, –ø–æ—Ç–æ–º—É —á—Ç–æ:</p>
<ul class="simple">
<li><p>SQLite <strong>–Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç</strong> –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—É—é –∑–∞–ø–∏—Å—å.</p></li>
<li><p>–£ –Ω–µ—ë <strong>–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è</strong> –ø–æ <strong>–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏</strong> –∏ <strong>–º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç–∏</strong>.</p></li>
<li><p>–ù–µ—Ç <strong>–≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏</strong> —Å–ª–æ–∂–Ω—ã—Ö —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, <code class="docutils literal notranslate"><span class="pre">JSON</span></code>, <code class="docutils literal notranslate"><span class="pre">ENUM</span></code>).</p></li>
</ul>
<p>–ü–æ–¥—Ä–æ–±–Ω–µ–µ –ø—Ä–æ SQLite –º–æ–∂–Ω–æ <a class="reference external" href="https://habr.com/ru/articles/547448/">–ø–æ—á–∏—Ç–∞—Ç—å –Ω–∞ –•–∞–±—Ä–µ</a></p>
</div>
<section id="sqlite">
<h2>üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å SQLite<a class="headerlink" href="#sqlite" title="–°—Å—ã–ª–∫–∞ –Ω–∞ —ç—Ç–æ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫">ÔÉÅ</a></h2>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>.
‚îú‚îÄ‚îÄ alembic/
‚îÇ   ‚îú‚îÄ‚îÄ env.py                 # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Alembic, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏—è–º–∏
‚îÇ   ‚îî‚îÄ‚îÄ versions/              # –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –º–∏–≥—Ä–∞—Ü–∏–π
‚îú‚îÄ‚îÄ configs/
‚îÇ   ‚îú‚îÄ‚îÄ settings.py            # –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (AppSettings)
‚îÇ   ‚îî‚îÄ‚îÄ schemas/
‚îÇ       ‚îî‚îÄ‚îÄ database.py        # Pydantic-—Å—Ö–µ–º—ã –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ë–î
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îî‚îÄ‚îÄ databases/
‚îÇ       ‚îú‚îÄ‚îÄ dao/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ base.py        # –ë–∞–∑–æ–≤—ã–π DAO
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ user_dao.py    # DAO –¥–ª—è –º–æ–¥–µ–ª–∏ User
‚îÇ       ‚îî‚îÄ‚îÄ sqlite/
‚îÇ           ‚îú‚îÄ‚îÄ core.py        # –î–≤–∏–∂–æ–∫, —Å–µ—Å—Å–∏—è, –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä @connection
‚îÇ           ‚îú‚îÄ‚îÄ connection.py  # –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å–µ—Å—Å–∏–∏ –¥–ª—è FastAPI
‚îÇ           ‚îú‚îÄ‚îÄ models/
‚îÇ           ‚îÇ   ‚îú‚îÄ‚îÄ base.py    # Declarative Base
‚îÇ           ‚îÇ   ‚îî‚îÄ‚îÄ user.py    # ORM-–º–æ–¥–µ–ª—å User
‚îÇ           ‚îî‚îÄ‚îÄ schemas/
‚îÇ               ‚îî‚îÄ‚îÄ user.py    # Pydantic-—Å—Ö–µ–º—ã –¥–ª—è User
</pre></div>
</div>
<p>–í —à–∞–±–ª–æ–Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head text-left"><p>–ö–æ–º–ø–æ–Ω–µ–Ω—Ç</p></th>
<th class="head text-left"><p>–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ</p></th>
<th class="head text-left"><p>–û–ø–∏—Å–∞–Ω–∏–µ</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p><strong><a class="reference external" href="https://docs.pydantic.dev/">Pydantic</a></strong></p></td>
<td class="text-left"><p><strong>–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏</strong></p></td>
<td class="text-left"><p>–û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç <strong>–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç—å</strong> –¥–∞–Ω–Ω—ã—Ö –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π.</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><strong><a class="reference external" href="https://www.sqlalchemy.org/">SQLAlchemy</a></strong></p></td>
<td class="text-left"><p><strong>ORM-–±–∏–±–ª–∏–æ—Ç–µ–∫–∞</strong></p></td>
<td class="text-left"><p>–û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç <strong>–≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ</strong> —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ <strong>Python-–æ–±—ä–µ–∫—Ç—ã</strong>. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –¥—Ä–∞–π–≤–µ—Ä <code class="docutils literal notranslate"><span class="pre">aiosqlite</span></code>.</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><strong><a class="reference external" href="https://alembic.sqlalchemy.org/">Alembic</a></strong></p></td>
<td class="text-left"><p><strong>–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –º–∏–≥—Ä–∞—Ü–∏–π</strong></p></td>
<td class="text-left"><p>–ü–æ–∑–≤–æ–ª—è–µ—Ç <strong>—É–ø—Ä–∞–≤–ª—è—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö</strong>.</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><strong>DAO-–ø–∞—Ç—Ç–µ—Ä–Ω</strong></p></td>
<td class="text-left"><p><strong>–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –ø–æ–¥—Ö–æ–¥</strong></p></td>
<td class="text-left"><p><strong>–£–ø—Ä–æ—â–∞–µ—Ç</strong> —Ä–∞–±–æ—Ç—É —Å –º–æ–¥–µ–ª—è–º–∏ –∏ <strong>—Å–∫—Ä—ã–≤–∞–µ—Ç</strong> –¥–µ—Ç–∞–ª–∏ –¥–æ—Å—Ç—É–ø–∞ –∫ –ë–î.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="id1">
<h2>üõ†Ô∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î<a class="headerlink" href="#id1" title="–°—Å—ã–ª–∫–∞ –Ω–∞ —ç—Ç–æ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫">ÔÉÅ</a></h2>
<p>–í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –º–æ–¥—É–ª–µ configs/schemas/database.py, –∫–æ—Ç–æ—Ä—ã–π –≤–∫–ª—é—á–∞–µ—Ç —Å—Ö–µ–º—É Pydantic –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ë–î. –ö–ª–∞—Å—Å <code class="docutils literal notranslate"><span class="pre">SQLiteSettings</span></code> –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ SQLite.
–ö–ª–∞—Å—Å <code class="docutils literal notranslate"><span class="pre">DatabaseSettings</span></code> –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫–æ –≤—Å–µ–º –ë–î.</p>
<div class="toggle docutils container">
</div>
<p><code class="docutils literal notranslate"><span class="pre">DatabaseSettings</span></code> –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ <code class="docutils literal notranslate"><span class="pre">AppSettings</span></code> –≤ <code class="docutils literal notranslate"><span class="pre">configs/settings.py</span></code>:</p>
<div class="toggle docutils container">
</div>
<div class="warning admonition">
<p class="admonition-title">–û–±–Ω–æ–≤–∏—Ç–µ .env —Ñ–∞–π–ª</p>
<p>–ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è <strong>–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ</strong> –æ–±–Ω–æ–≤–∏—Ç–µ —Ñ–∞–π–ª .env –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ –∏ —É–∫–∞–∂–∏—Ç–µ –≤ –Ω—ë–º –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è, –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.</p>
<p>–ü—Ä–∏–º–µ—Ä –∑–Ω–∞—á–µ–Ω–∏–π –≤ <code class="docutils literal notranslate"><span class="pre">.env</span></code> —Ñ–∞–π–ª–µ:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ SQLite</span>
<span class="nv">SQLITE_DATABASE_URL</span><span class="o">=</span>sqlite+aiosqlite:///./data/db.sqlite3<span class="w">  </span><span class="c1"># URL –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ SQLite (aiosqlite ‚Äî –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –¥–≤–∏–∂–æ–∫)</span>
<span class="nv">SQLITE_ECHO</span><span class="o">=</span><span class="nb">false</span><span class="w">                                         </span><span class="c1"># –í–∫–ª—é—á–∏—Ç—å/–æ—Ç–∫–ª—é—á–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ SQL-–∑–∞–ø—Ä–æ—Å–æ–≤ (true/false)</span>
<span class="nv">SQLITE_POOL_PRE_PING</span><span class="o">=</span><span class="nb">true</span><span class="w">                                 </span><span class="c1"># –ü—Ä–æ–≤–µ—Ä—è—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è true)</span>
<span class="nv">SQLITE_EXPIRE_ON_COMMIT</span><span class="o">=</span><span class="nb">false</span><span class="w">                             </span><span class="c1"># –ù–µ —É—Å—Ç–∞—Ä–µ–≤–∞—é—Ç –æ–±—ä–µ–∫—Ç—ã –ø–æ—Å–ª–µ commit (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è false –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π —Å–µ—Å—Å–∏–∏)</span>
<span class="nv">SQLITE_AUTOFLUSH</span><span class="o">=</span><span class="nb">false</span><span class="w">                                    </span><span class="c1"># –û—Ç–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π flush (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è false –ø—Ä–∏ —Ä—É—á–Ω–æ–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ —Å–µ—Å—Å–∏–µ–π)</span>
<span class="nv">SQLITE_POOL_SIZE</span><span class="o">=</span><span class="m">5</span><span class="w">                                        </span><span class="c1"># –†–∞–∑–º–µ—Ä –ø—É–ª–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –∫ –ë–î (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Å—Ç–æ—è–Ω–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π)</span>
<span class="nv">SQLITE_MAX_OVERFLOW</span><span class="o">=</span><span class="m">10</span><span class="w">                                    </span><span class="c1"># –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π —Å–≤–µ—Ä—Ö –ø—É–ª–∞</span>
</pre></div>
</div>
</div>
<div class="tip admonition">
<p class="admonition-title">–ö–∞–∫ –∏–∑–º–µ–Ω–∏—Ç—å –∏–º—è –ë–î</p>
<p>–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ë–î —Å–æ–∑–¥–∞–µ—Ç—Å—è –ø–æ –ø—É—Ç–∏ /data/db.sqlite3
–ü–∞–ø–∫–∞ <code class="docutils literal notranslate"><span class="pre">data/</span></code> —Å–æ–∑–¥–∞—ë—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –µ—Å–ª–∏ –æ–Ω–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.<br />
–≠—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ <code class="docutils literal notranslate"><span class="pre">configs/settings.py</span></code> –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ <code class="docutils literal notranslate"><span class="pre">AppSettings</span></code>.</p>
<p>–í—ã –º–æ–∂–µ—Ç–µ –∑–∞–¥–∞—Ç—å <strong>–∫–∞—Å—Ç–æ–º–Ω–æ–µ –∏–º—è —Ñ–∞–π–ª–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö</strong>, –∏–∑–º–µ–Ω–∏–≤ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π <code class="docutils literal notranslate"><span class="pre">SQLITE_DATABASE_URL</span></code> –≤ <code class="docutils literal notranslate"><span class="pre">.env</span></code> —Ñ–∞–π–ª–µ.</p>
<p>–ü—Ä–∏–º–µ—Ä: —Å–æ–∑–¥–∞–¥–∏–º –ë–î my_database.sqlite3</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">SQLITE_DATABASE_URL</span><span class="o">=</span>sqlite+aiosqlite:///./data/my_database.sqlite3
</pre></div>
</div>
</div>
</section>
<section id="sqlalchemy">
<h2>üß© SQLAlchemy<a class="headerlink" href="#sqlalchemy" title="–°—Å—ã–ª–∫–∞ –Ω–∞ —ç—Ç–æ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫">ÔÉÅ</a></h2>
<p>SQLAlchemy ‚Äî —ç—Ç–æ –º–æ—â–Ω–∞—è <strong>ORM-–±–∏–±–ª–∏–æ—Ç–µ–∫–∞</strong> –¥–ª—è Python. –û–Ω–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –≥–∏–±–∫–∏–π –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–± —Ä–∞–±–æ—Ç—ã —Å —Ä–µ–ª—è—Ü–∏–æ–Ω–Ω—ã–º–∏ –±–∞–∑–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö, –ø–æ–∑–≤–æ–ª—è—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å <strong>–æ–±—ä–µ–∫—Ç–Ω–æ-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥</strong> –≤–º–µ—Å—Ç–æ –Ω–∞–ø–∏—Å–∞–Ω–∏—è ‚Äú–≥–æ–ª–æ–≥–æ‚Äù SQL, —á—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç:</p>
<ul class="simple">
<li><p><strong>–¢–∞–±–ª–∏—Ü—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö</strong> –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—ã –∫–∞–∫ <strong>Python-–∫–ª–∞—Å—Å—ã</strong> (–º–æ–¥–µ–ª–∏).</p></li>
<li><p><strong>–°—Ç—Ä–æ–∫–∏ —Ç–∞–±–ª–∏—Ü</strong> –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—ã –∫–∞–∫ <strong>–æ–±—ä–µ–∫—Ç—ã</strong> —ç—Ç–∏—Ö –∫–ª–∞—Å—Å–æ–≤.</p></li>
<li><p><strong>–ó–∞–ø—Ä–æ—Å—ã –∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è</strong> –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ <strong>–º–µ—Ç–æ–¥—ã –∏ –∞—Ç—Ä–∏–±—É—Ç—ã</strong> Python-–æ–±—ä–µ–∫—Ç–æ–≤.</p></li>
</ul>
<p>–≠—Ç–æ –¥–µ–ª–∞–µ—Ç –∫–æ–¥ <strong>–±–æ–ª–µ–µ —á–∏—Ç–∞–µ–º—ã–º, —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º, –ø–µ—Ä–µ–Ω–æ—Å–∏–º—ã–º –∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–º</strong> –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å —Ä—É—á–Ω—ã–º –Ω–∞–ø–∏—Å–∞–Ω–∏–µ–º SQL.</p>
<p>–í —à–∞–±–ª–æ–Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–µ –∫–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã SQLAlchemy, –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ –≤ <code class="docutils literal notranslate"><span class="pre">src/databases/sqlite/core.py</span></code>:</p>
<div class="toggle docutils container">
</div>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head text-left"><p>–ö–æ–º–ø–æ–Ω–µ–Ω—Ç</p></th>
<th class="head text-left"><p>–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ</p></th>
<th class="head text-left"><p>–û–ø–∏—Å–∞–Ω–∏–µ</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p><strong>–î–≤–∏–∂–æ–∫ (Engine)</strong></p></td>
<td class="text-left"><p><strong>–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –æ–±—ä–µ–∫—Ç</strong> –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î.</p></td>
<td class="text-left"><p>–£–ø—Ä–∞–≤–ª—è–µ—Ç <strong>–ø—É–ª–æ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π</strong>, <strong>–Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</strong>, –∏ <strong>–≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–µ—Ç —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö</strong>. –û–Ω <strong>–Ω–µ —Å–æ–∑–¥–∞—ë—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å—Ä–∞–∑—É</strong>, –∞ –ø–æ –∑–∞–ø—Ä–æ—Å—É.</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><strong>–§–∞–±—Ä–∏–∫–∞ —Å–µ—Å—Å–∏–π (Sessionmaker)</strong></p></td>
<td class="text-left"><p><strong>–§—É–Ω–∫—Ü–∏—è</strong>, —Å–æ–∑–¥–∞—é—â–∞—è <strong>–Ω–æ–≤—ã–µ —Å–µ—Å—Å–∏–∏</strong>.</p></td>
<td class="text-left"><p>–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è <strong>–±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –∏ —É–ø—Ä–∞–≤–ª—è–µ–º–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è</strong> <code class="docutils literal notranslate"><span class="pre">AsyncSession</span></code> –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><strong>–°–µ—Å—Å–∏—è (Session)</strong></p></td>
<td class="text-left"><p><strong>–†–∞–±–æ—á–∞—è –æ–±–ª–∞—Å—Ç—å</strong> –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –ë–î.</p></td>
<td class="text-left"><p><strong>–û—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å</strong> –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ (<code class="docutils literal notranslate"><span class="pre">SELECT</span></code>, <code class="docutils literal notranslate"><span class="pre">INSERT</span></code>, <code class="docutils literal notranslate"><span class="pre">UPDATE</span></code>, <code class="docutils literal notranslate"><span class="pre">DELETE</span></code>), <strong>–æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π</strong> –æ–±—ä–µ–∫—Ç–æ–≤ –∏ <strong>—É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏</strong>.</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><strong><code class="docutils literal notranslate"><span class="pre">&#64;connection</span></code></strong></p></td>
<td class="text-left"><p><strong>–î–µ–∫–æ—Ä–∞—Ç–æ—Ä</strong>, –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É—é—â–∏–π —Å–æ–∑–¥–∞–Ω–∏–µ, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏ –∑–∞–∫—Ä—ã—Ç–∏–µ —Å–µ—Å—Å–∏–∏.</p></td>
<td class="text-left"><p><strong>–£–ø—Ä–æ—â–∞–µ—Ç –∫–æ–¥</strong>, –±–µ—Ä—ë—Ç –Ω–∞ —Å–µ–±—è <strong>–æ—Ç–∫—Ä—ã—Ç–∏–µ, –ø–µ—Ä–µ–¥–∞—á—É, –∑–∞–∫—Ä—ã—Ç–∏–µ —Å–µ—Å—Å–∏–∏</strong> –∏ <strong>–æ—Ç–∫–∞—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ø—Ä–∏ –æ—à–∏–±–∫–µ</strong>.</p></td>
</tr>
</tbody>
</table>
<section id="engine">
<h3>üöÄ –î–≤–∏–∂–æ–∫ (Engine)<a class="headerlink" href="#engine" title="–°—Å—ã–ª–∫–∞ –Ω–∞ —ç—Ç–æ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫">ÔÉÅ</a></h3>
<p>–î–≤–∏–∂–æ–∫ (<code class="docutils literal notranslate"><span class="pre">Engine</span></code>) ‚Äî —ç—Ç–æ <strong>—Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –æ–±—ä–µ–∫—Ç</strong> SQLAlchemy, –∫–æ—Ç–æ—Ä—ã–π <strong>—É–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö</strong>:</p>
<ul class="simple">
<li><p><strong>–°–æ–∑–¥–∞—ë—Ç –∏ —É–ø—Ä–∞–≤–ª—è–µ—Ç –ø—É–ª–æ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π</strong> –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö. –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ –∫ –ë–î –Ω–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è –Ω–æ–≤–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å –Ω—É–ª—è, –∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —É–∂–µ –≥–æ—Ç–æ–≤–æ–µ –∏–∑ –ø—É–ª–∞, —á—Ç–æ <strong>–ø–æ–≤—ã—à–∞–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</strong>.</p></li>
<li><p><strong>–§–æ—Ä–º–∏—Ä—É–µ—Ç –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç SQL-–∑–∞–ø—Ä–æ—Å—ã</strong> –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∏–∑ –ø—É–ª–∞.</p></li>
<li><p><strong>–í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–µ—Ç —Å –¥—Ä–∞–π–≤–µ—Ä–æ–º</strong> –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (<code class="docutils literal notranslate"><span class="pre">aiosqlite</span></code>).</p></li>
</ul>
<div class="attention admonition">
<p class="admonition-title">–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ</p>
<p>–î–≤–∏–∂–æ–∫ <strong>–Ω–µ —Å–æ–∑–¥–∞—ë—Ç —Ñ–∏–∑–∏—á–µ—Å–∫–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å—Ä–∞–∑—É –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏</strong>. –û–Ω <strong>—Å–æ–∑–¥–∞—ë—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é</strong> - –Ω–∞–ø—Ä–∏–º–µ—Ä, –∫–æ–≥–¥–∞ —Å–æ–∑–¥–∞—ë—Ç—Å—è –Ω–æ–≤–∞—è —Å–µ—Å—Å–∏—è.</p>
</div>
<div class="tip admonition">
<p class="admonition-title">–°–æ–≤–µ—Ç: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—É–ª–∞</p>
<p>–ü–∞—Ä–∞–º–µ—Ç—Ä—ã <code class="docutils literal notranslate"><span class="pre">SQLITE_POOL_SIZE</span></code> –∏ <code class="docutils literal notranslate"><span class="pre">SQLITE_MAX_OVERFLOW</span></code> –≤ .env –≤–ª–∏—è—é—Ç –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å. –£–≤–µ–ª–∏—á–∏–≤–∞–π—Ç–µ <code class="docutils literal notranslate"><span class="pre">POOL_SIZE</span></code> –¥–ª—è –≤—ã—Å–æ–∫–æ–Ω–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π, —á—Ç–æ–±—ã –∏–º–µ—Ç—å –±–æ–ª—å—à–µ –≥–æ—Ç–æ–≤—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π.</p>
</div>
</section>
<section id="session">
<h3>üß≠ –°–µ—Å—Å–∏—è (Session)<a class="headerlink" href="#session" title="–°—Å—ã–ª–∫–∞ –Ω–∞ —ç—Ç–æ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫">ÔÉÅ</a></h3>
<p>–°–µ—Å—Å–∏—è (<code class="docutils literal notranslate"><span class="pre">Session</span></code>, –≤ –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ <code class="docutils literal notranslate"><span class="pre">AsyncSession</span></code>) ‚Äî —ç—Ç–æ <strong>—Ä–∞–±–æ—á–∞—è –æ–±–ª–∞—Å—Ç—å</strong> –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö:</p>
<ul class="simple">
<li><p><strong>–Ø–≤–ª—è–µ—Ç—Å—è –æ—Å–Ω–æ–≤–Ω—ã–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º</strong> –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î (—á–µ—Ä–µ–∑ <code class="docutils literal notranslate"><span class="pre">session.execute(query)</span></code>).</p></li>
<li><p><strong>–û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è</strong> –æ–±—ä–µ–∫—Ç–æ–≤, —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –∏–ª–∏ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ —ç—Ç—É —Å–µ—Å—Å–∏—é.</p></li>
<li><p><strong>–£–ø—Ä–∞–≤–ª—è–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏</strong> (–Ω–∞—á–∏–Ω–∞–µ—Ç, —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç, –æ—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç).</p></li>
<li><p><strong>–ö—ç—à–∏—Ä—É–µ—Ç</strong> –æ–±—ä–µ–∫—Ç—ã, –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.</p></li>
</ul>
<div class="note admonition">
<p class="admonition-title">–ß—Ç–æ —Ç–∞–∫–æ–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è</p>
<p><a class="reference external" href="https://ru.wikipedia.org/wiki/%D0%A2%D1%80%D0%B0%D0%BD%D0%B7%D0%B0%D0%BA%D1%86%D0%B8%D1%8F_(%D0%B8%D0%BD%D1%84%D0%BE%D1%80%D0%BC%D0%B0%D1%82%D0%B8%D0%BA%D0%B0)">–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è</a> ‚Äî —ç—Ç–æ –≥—Ä—É–ø–ø–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Å –ë–î, –ª–æ–≥–∏—á–µ—Å–∫–∞—è –µ–¥–∏–Ω–∏—Ü–∞ —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏. –û–Ω–∞ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –ª–∏–±–æ <strong>–≤—Å–µ</strong> –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ä–∞–º–∫–∞—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ <strong>–ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è</strong>, –ª–∏–±–æ <strong>–Ω–∏ –æ–¥–Ω–æ</strong> –∏–∑ –Ω–∏—Ö (–≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏). –í SQLAlchemy —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å–µ—Å—Å–∏–∏ –∏ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è –≤—ã–∑–æ–≤–æ–º <code class="docutils literal notranslate"><span class="pre">session.commit()</span></code> (–¥–ª—è —Ñ–∏–∫—Å–∞—Ü–∏–∏) –∏–ª–∏ <code class="docutils literal notranslate"><span class="pre">session.rollback()</span></code> (–¥–ª—è –æ—Ç–∫–∞—Ç–∞).</p>
</div>
<section id="id2">
<h4>–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã —Å–µ—Å—Å–∏–∏<a class="headerlink" href="#id2" title="–°—Å—ã–ª–∫–∞ –Ω–∞ —ç—Ç–æ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫">ÔÉÅ</a></h4>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head text-left"><p>–ì—Ä—É–ø–ø–∞ –º–µ—Ç–æ–¥–æ–≤</p></th>
<th class="head text-left"><p>–ú–µ—Ç–æ–¥—ã</p></th>
<th class="head text-left"><p>–û–ø–∏—Å–∞–Ω–∏–µ</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p><strong>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏</strong></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">commit()</span></code>, <code class="docutils literal notranslate"><span class="pre">rollback()</span></code>, <code class="docutils literal notranslate"><span class="pre">flush()</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">commit()</span></code> ‚Äî —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ë–î. <code class="docutils literal notranslate"><span class="pre">rollback()</span></code> ‚Äî –æ—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç –Ω–µ–∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è. <code class="docutils literal notranslate"><span class="pre">flush()</span></code> ‚Äî –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ë–î –±–µ–∑ —Ñ–∏–∫—Å–∞—Ü–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><strong>–î–æ–±–∞–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ</strong></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">add()</span></code>, <code class="docutils literal notranslate"><span class="pre">add_all()</span></code>, <code class="docutils literal notranslate"><span class="pre">delete()</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">add()</span></code> ‚Äî –¥–æ–±–∞–≤–ª—è–µ—Ç –æ–¥–∏–Ω –æ–±—ä–µ–∫—Ç. <code class="docutils literal notranslate"><span class="pre">add_all()</span></code> ‚Äî –¥–æ–±–∞–≤–ª—è–µ—Ç —Å–ø–∏—Å–æ–∫ –æ–±—ä–µ–∫—Ç–æ–≤. <code class="docutils literal notranslate"><span class="pre">delete()</span></code> ‚Äî –ø–æ–º–µ—á–∞–µ—Ç –æ–±—ä–µ–∫—Ç –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è.</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><strong>–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö</strong></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">get()</span></code>, <code class="docutils literal notranslate"><span class="pre">execute()</span></code>, <code class="docutils literal notranslate"><span class="pre">scalar()</span></code>, <code class="docutils literal notranslate"><span class="pre">scalars()</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">get()</span></code> ‚Äî –ø–æ–ª—É—á–∞–µ—Ç –æ–±—ä–µ–∫—Ç –ø–æ –ø–µ—Ä–≤–∏—á–Ω–æ–º—É –∫–ª—é—á—É. <code class="docutils literal notranslate"><span class="pre">execute()</span></code> ‚Äî –≤—ã–ø–æ–ª–Ω—è–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å (<code class="docutils literal notranslate"><span class="pre">select</span></code>, <code class="docutils literal notranslate"><span class="pre">update</span></code>, <code class="docutils literal notranslate"><span class="pre">delete</span></code>). <code class="docutils literal notranslate"><span class="pre">scalar()</span></code>/<code class="docutils literal notranslate"><span class="pre">scalars()</span></code> ‚Äî –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ–¥–Ω–æ–≥–æ/–º–Ω–æ–∂–µ—Å—Ç–≤–∞ –∑–Ω–∞—á–µ–Ω–∏–π.</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><strong>–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ</strong></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">refresh()</span></code>, <code class="docutils literal notranslate"><span class="pre">merge()</span></code>, <code class="docutils literal notranslate"><span class="pre">expire()</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">refresh()</span></code> ‚Äî –æ–±–Ω–æ–≤–ª—è–µ—Ç –∞—Ç—Ä–∏–±—É—Ç—ã –æ–±—ä–µ–∫—Ç–∞ –∏–∑ –ë–î. <code class="docutils literal notranslate"><span class="pre">merge()</span></code> ‚Äî ‚Äú–≤—Å—Ç–∞–≤–ª—è–µ—Ç –∏–ª–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç‚Äù. <code class="docutils literal notranslate"><span class="pre">expire()</span></code> ‚Äî –ø–æ–º–µ—á–∞–µ—Ç –æ–±—ä–µ–∫—Ç –∫–∞–∫ —É—Å—Ç–∞—Ä–µ–≤—à–∏–π.</p></td>
</tr>
</tbody>
</table>
<div class="attention admonition">
<p class="admonition-title">–í–∞–∂–Ω–æ: session.get() –∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å</p>
<p>–í SQLAlchemy 2.0+ –º–µ—Ç–æ–¥ <code class="docutils literal notranslate"><span class="pre">session.get()</span></code> —Å—Ç–∞–ª <strong>–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º</strong> –∏ –¥–æ–ª–∂–µ–Ω –≤—ã–∑—ã–≤–∞—Ç—å—Å—è –∫–∞–∫ <code class="docutils literal notranslate"><span class="pre">await</span> <span class="pre">session.get(Model,</span> <span class="pre">primary_key)</span></code>.</p>
</div>
</section>
</section>
<section id="sessionmaker">
<h3>üè≠ –§–∞–±—Ä–∏–∫–∞ —Å–µ—Å—Å–∏–π (Sessionmaker)<a class="headerlink" href="#sessionmaker" title="–°—Å—ã–ª–∫–∞ –Ω–∞ —ç—Ç–æ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫">ÔÉÅ</a></h3>
<p>–§–∞–±—Ä–∏–∫–∞ —Å–µ—Å—Å–∏–π (<code class="docutils literal notranslate"><span class="pre">Sessionmaker</span></code>, –∞ –≤ –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ <code class="docutils literal notranslate"><span class="pre">async_sessionmaker</span></code>) ‚Äî —ç—Ç–æ <strong>—Å–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è</strong>, –∫–æ—Ç–æ—Ä–∞—è <strong>—Å–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—ã–µ —ç–∫–∑–µ–º–ø–ª—è—Ä—ã <code class="docutils literal notranslate"><span class="pre">AsyncSession</span></code></strong>. –≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç</p>
<ul class="simple">
<li><p><strong>–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Å—Å–∏–π</strong>: –í–º–µ—Å—Ç–æ —Ç–æ–≥–æ —á—Ç–æ–±—ã –∫–∞–∂–¥—ã–π —Ä–∞–∑ —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–µ—Å—Å–∏—é –Ω–∞–ø—Ä—è–º—É—é, –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ —Ñ–∞–±—Ä–∏–∫—É, –∫–æ—Ç–æ—Ä–∞—è –∑–Ω–∞–µ—Ç, —Å –∫–∞–∫–∏–º –¥–≤–∏–∂–∫–æ–º (<code class="docutils literal notranslate"><span class="pre">engine</span></code>) –∏ –∫–∞–∫–∏–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–µ—Å—Å–∏—é.</p></li>
<li><p><strong>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏</strong>: –í—Å–µ —Å–µ—Å—Å–∏–∏, —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ —Ñ–∞–±—Ä–∏–∫—É, –±—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–Ω–∏ –∏ —Ç–µ –∂–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, <code class="docutils literal notranslate"><span class="pre">expire_on_commit</span></code>, <code class="docutils literal notranslate"><span class="pre">autoflush</span></code>), –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ñ–∞–±—Ä–∏–∫–∏.</p></li>
<li><p><strong>–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å <code class="docutils literal notranslate"><span class="pre">&#64;connection</span></code></strong>: –î–µ–∫–æ—Ä–∞—Ç–æ—Ä <code class="docutils literal notranslate"><span class="pre">&#64;connection</span></code> –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —ç—Ç—É —Ñ–∞–±—Ä–∏–∫—É, —á—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Å–µ—Å—Å–∏—é –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–∏.</p></li>
</ul>
<p>–ö–æ–≥–¥–∞ –≤—ã –≤—ã–∑—ã–≤–∞–µ—Ç–µ <code class="docutils literal notranslate"><span class="pre">async_session()</span></code> (–∫–æ—Ç–æ—Ä–∞—è –∏ –µ—Å—Ç—å –Ω–∞—à–∞ —Ñ–∞–±—Ä–∏–∫–∞), –æ–Ω–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç <strong>–Ω–æ–≤—É—é, –Ω–µ–∑–∞–≤–∏—Å–∏–º—É—é</strong> <code class="docutils literal notranslate"><span class="pre">AsyncSession</span></code>, –≥–æ—Ç–æ–≤—É—é –∫ —Ä–∞–±–æ—Ç–µ —Å –ë–î.</p>
</section>
<section id="connection">
<h3>üß© –î–µ–∫–æ—Ä–∞—Ç–æ—Ä <code class="docutils literal notranslate"><span class="pre">&#64;connection</span></code><a class="headerlink" href="#connection" title="–°—Å—ã–ª–∫–∞ –Ω–∞ —ç—Ç–æ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫">ÔÉÅ</a></h3>
<p>–î–µ–∫–æ—Ä–∞—Ç–æ—Ä <code class="docutils literal notranslate"><span class="pre">&#64;connection</span></code> ‚Äî —ç—Ç–æ <strong>—É–¥–æ–±–Ω–∞—è –æ–±—ë—Ä—Ç–∫–∞</strong>, –∫–æ—Ç–æ—Ä–∞—è <strong>–∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É–µ—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏–µ–π</strong>:</p>
<ul class="simple">
<li><p><strong>–°–æ–∑–¥–∞—ë—Ç</strong> –Ω–æ–≤—É—é <code class="docutils literal notranslate"><span class="pre">AsyncSession</span></code> —Å –ø–æ–º–æ—â—å—é —Ñ–∞–±—Ä–∏–∫–∏.</p></li>
<li><p><strong>–ü–µ—Ä–µ–¥–∞—ë—Ç</strong> —ç—Ç—É —Å–µ—Å—Å–∏—é –≤ –¥–µ–∫–æ—Ä–∏—Ä—É–µ–º—É—é —Ñ—É–Ω–∫—Ü–∏—é –∫–∞–∫ –∞—Ä–≥—É–º–µ–Ω—Ç (–æ–±—ã—á–Ω–æ <code class="docutils literal notranslate"><span class="pre">session</span></code>).</p></li>
<li><p><strong>–û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç</strong> <strong>–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ</strong> —Å–µ—Å—Å–∏–∏ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–∏ (–¥–∞–∂–µ –µ—Å–ª–∏ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞).</p></li>
<li><p><strong>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–∑—ã–≤–∞–µ—Ç</strong> <code class="docutils literal notranslate"><span class="pre">session.commit()</span></code> –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –∏ <code class="docutils literal notranslate"><span class="pre">session.rollback()</span></code> –ø—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ <strong>–∏—Å–∫–ª—é—á–µ–Ω–∏—è</strong>, –≤–æ–∑–≤—Ä–∞—â–∞—è –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –≤ –ø—Ä–µ–¥—ã–¥—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ.</p></li>
</ul>
<div class="tip admonition">
<p class="admonition-title">–í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ &#64;connection</p>
<p>–í—Å–µ–≥–¥–∞ –æ–±–æ—Ä–∞—á–∏–≤–∞–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏–∏, –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É—é—â–∏–µ —Å –ë–î, –≤ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä <code class="docutils literal notranslate"><span class="pre">&#64;connection</span></code>. –≠—Ç–æ –¥–µ–ª–∞–µ—Ç –∫–æ–¥ –ø—Ä–æ—â–µ –∏ –Ω–∞–¥—ë–∂–Ω–µ–µ.</p>
</div>
</section>
</section>
<section id="orm">
<h2>üìä ORM<a class="headerlink" href="#orm" title="–°—Å—ã–ª–∫–∞ –Ω–∞ —ç—Ç–æ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫">ÔÉÅ</a></h2>
<p>ORM (Object-Relational Mapping) ‚Äî —ç—Ç–æ <strong>—Å–ø–æ—Å–æ–± –æ–ø–∏—Å–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö</strong> –∫–∞–∫ <strong>Python-–∫–ª–∞—Å—Å–æ–≤</strong>, –∞ <strong>—Å—Ç—Ä–æ–∫ –≤ —Ç–∞–±–ª–∏—Ü–µ</strong> ‚Äî –∫–∞–∫ <strong>–æ–±—ä–µ–∫—Ç–æ–≤ —ç—Ç–∏—Ö –∫–ª–∞—Å—Å–æ–≤</strong>.</p>
<div class="dropdown admonition">
<p class="admonition-title">–û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–Ω—è—Ç–∏—è</p>
<ul class="simple">
<li><p><strong>–ú–æ–¥–µ–ª—å</strong> ‚Äî Python-–∫–ª–∞—Å—Å, <strong>–Ω–∞—Å–ª–µ–¥—É–µ–º—ã–π –æ—Ç <code class="docutils literal notranslate"><span class="pre">Base</span></code></strong>, –∫–æ—Ç–æ—Ä—ã–π <strong>–æ–ø–∏—Å—ã–≤–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –æ–¥–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã</strong> –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.</p></li>
<li><p><strong>–ö–æ–ª–æ–Ω–∫–∞ (–∞—Ç—Ä–∏–±—É—Ç)</strong> ‚Äî <strong>–ø–æ–ª–µ —Ç–∞–±–ª–∏—Ü—ã</strong>, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–µ –∫–∞–∫ <strong>–∞—Ç—Ä–∏–±—É—Ç –∫–ª–∞—Å—Å–∞</strong> (–Ω–∞–ø—Ä–∏–º–µ—Ä, <code class="docutils literal notranslate"><span class="pre">username:</span> <span class="pre">Mapped[str]</span></code>).</p></li>
<li><p><strong>–¢–∞–±–ª–∏—Ü–∞</strong> ‚Äî <strong>—Å—É—â–Ω–æ—Å—Ç—å –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö</strong>, –∫–æ—Ç–æ—Ä–∞—è <strong>—Å–æ–∑–¥–∞—ë—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –º–æ–¥–µ–ª–∏</strong>.</p></li>
<li><p><strong>–û–±—ä–µ–∫—Ç –º–æ–¥–µ–ª–∏</strong> ‚Äî <strong>—Å—Ç—Ä–æ–∫–∞ –≤ —Ç–∞–±–ª–∏—Ü–µ</strong>, –∫–æ—Ç–æ—Ä—É—é –º–æ–∂–Ω–æ <strong>—Å–æ–∑–¥–∞—Ç—å, –ø—Ä–æ—á–∏—Ç–∞—Ç—å, –æ–±–Ω–æ–≤–∏—Ç—å –∏–ª–∏ —É–¥–∞–ª–∏—Ç—å</strong> –∫–∞–∫ Python-–æ–±—ä–µ–∫—Ç.</p></li>
</ul>
</div>
<section id="base">
<h3>üß± –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å <code class="docutils literal notranslate"><span class="pre">Base</span></code><a class="headerlink" href="#base" title="–°—Å—ã–ª–∫–∞ –Ω–∞ —ç—Ç–æ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫">ÔÉÅ</a></h3>
<p>–í SQLAlchemy <strong>–≤—Å–µ ORM-–º–æ–¥–µ–ª–∏ –¥–æ–ª–∂–Ω—ã –Ω–∞—Å–ª–µ–¥–æ–≤–∞—Ç—å—Å—è –æ—Ç –æ–¥–Ω–æ–≥–æ –æ–±—â–µ–≥–æ –∫–ª–∞—Å—Å–∞</strong> <code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.DeclarativeBase</span></code>. –î–ª—è —ç—Ç–∏—Ö —Ü–µ–ª–µ–π –≤ —à–∞–±–ª–æ–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è <strong>–∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π –±–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å <code class="docutils literal notranslate"><span class="pre">Base</span></code></strong>, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ <code class="docutils literal notranslate"><span class="pre">src/databases/sqlite/models/base.py</span></code> –∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:</p>
<ul class="simple">
<li><p><strong>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü</strong> ‚Äî SQLAlchemy –∑–Ω–∞–µ—Ç, –∫–∞–∫–∏–µ –º–æ–¥–µ–ª–∏ —Å—É—â–µ—Å—Ç–≤—É—é—Ç, –∏ –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Ç–∞–±–ª–∏—Ü—ã –≤ –ë–î.</p></li>
<li><p><strong>–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏</strong> ‚Äî –≤—Å–µ –º–æ–¥–µ–ª–∏, –Ω–∞—Å–ª–µ–¥—É—é—â–∏–µ—Å—è –æ—Ç <code class="docutils literal notranslate"><span class="pre">Base</span></code>, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∞—é—Ç –ø–æ–ª—è, –æ–ø–∏—Å–∞–Ω–Ω—ã–µ –≤ <code class="docutils literal notranslate"><span class="pre">Base</span></code>.</p></li>
<li><p><strong>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏–º—è —Ç–∞–±–ª–∏—Ü—ã</strong> ‚Äî –∏–º—è —Ç–∞–±–ª–∏—Ü—ã –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ <code class="docutils literal notranslate"><span class="pre">__tablename__</span></code> –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–≥–æ –∫–ª–∞—Å—Å–∞ –≤ –º–æ–¥–µ–ª–∏ (<code class="docutils literal notranslate"><span class="pre">User</span></code> ‚Üí <code class="docutils literal notranslate"><span class="pre">users</span></code>, <code class="docutils literal notranslate"><span class="pre">Post</span></code> ‚Üí <code class="docutils literal notranslate"><span class="pre">posts</span></code>)</p></li>
<li><p><strong>–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–π</strong> ‚Äî Alembic –∏—Å–ø–æ–ª—å–∑—É–µ—Ç <code class="docutils literal notranslate"><span class="pre">Base.metadata</span></code> –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ —Å—Ö–µ–º–µ –ë–î.</p></li>
</ul>
<div class="toggle docutils container">
</div>
</section>
<section id="user">
<h3>üß© –ú–æ–¥–µ–ª—å <code class="docutils literal notranslate"><span class="pre">User</span></code><a class="headerlink" href="#user" title="–°—Å—ã–ª–∫–∞ –Ω–∞ —ç—Ç–æ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫">ÔÉÅ</a></h3>
<p>–§–∞–π–ª <code class="docutils literal notranslate"><span class="pre">src/databases/sqlite/models/user.py</span></code> —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä–∏–º–µ—Ä ORM-–º–æ–¥–µ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –ú–æ–¥–µ–ª—å <code class="docutils literal notranslate"><span class="pre">User</span></code> –Ω–∞—Å–ª–µ–¥—É–µ—Ç—Å—è –æ—Ç <code class="docutils literal notranslate"><span class="pre">Base</span></code> –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">id</span></code> ‚Äî —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–Ω–∞—Å–ª–µ–¥—É–µ—Ç—Å—è –∏–∑ <code class="docutils literal notranslate"><span class="pre">Base</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">username</span></code> ‚Äî —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Å –∏–Ω–¥–µ–∫—Å–æ–º)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">email</span></code> ‚Äî —É–Ω–∏–∫–∞–ª—å–Ω—ã–π email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Å –∏–Ω–¥–µ–∫—Å–æ–º)</p></li>
</ul>
<div class="toggle docutils container">
</div>
<div class="tip admonition">
<p class="admonition-title">–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ <strong>repr</strong></p>
<p>–ú–µ—Ç–æ–¥ <strong>repr</strong> –ø–æ–∑–≤–æ–ª—è–µ—Ç —É–¥–æ–±–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å –æ–±—ä–µ–∫—Ç –º–æ–¥–µ–ª–∏ –ø—Ä–∏ –æ—Ç–ª–∞–¥–∫–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ –ª–æ–≥–∞—Ö –∏–ª–∏ –≤ REPL).</p>
</div>
</section>
<section id="id3">
<h3>üèóÔ∏è –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –º–æ–¥–µ–ª–∏<a class="headerlink" href="#id3" title="–°—Å—ã–ª–∫–∞ –Ω–∞ —ç—Ç–æ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫">ÔÉÅ</a></h3>
<p>–î–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–π —Ç–∞–±–ª–∏—Ü—ã –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö —Å–æ–∑–¥–∞–π—Ç–µ <strong>ORM-–º–æ–¥–µ–ª—å</strong> –≤ <code class="docutils literal notranslate"><span class="pre">src/databases/sqlite/models/</span></code>.</p>
<p>–ü—Ä–∏–º–µ—Ä: —Å–æ–∑–¥–∞–¥–∏–º –º–æ–¥–µ–ª—å <code class="docutils literal notranslate"><span class="pre">Post</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">String</span><span class="p">,</span> <span class="n">Text</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">Mapped</span><span class="p">,</span> <span class="n">mapped_column</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.base</span><span class="w"> </span><span class="kn">import</span> <span class="n">Base</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Post</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ORM-–º–æ–¥–µ–ª—å –ø–æ—Å—Ç–∞ —é–∑–µ—Ä–∞ –≤ –±–ª–æ–≥–µ.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">title</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">String</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">content</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">Text</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&lt;Post(id=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">, title=&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="si">}</span><span class="s2">&#39;)&gt;&quot;</span>
</pre></div>
</div>
<div class="tip admonition">
<p class="admonition-title">–°–æ–≤–µ—Ç: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ <strong>repr</strong> –≤ –º–æ–¥–µ–ª—è—Ö</p>
<p>–ú–µ—Ç–æ–¥ <code class="docutils literal notranslate"><span class="pre">__repr__</span></code> –ø–æ–∑–≤–æ–ª—è–µ—Ç —É–¥–æ–±–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å –æ–±—ä–µ–∫—Ç –º–æ–¥–µ–ª–∏ –ø—Ä–∏ –æ—Ç–ª–∞–¥–∫–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ –ª–æ–≥–∞—Ö –∏–ª–∏ –≤ REPL).</p>
</div>
</section>
<section id="id4">
<h3>üîÑ –ò–∑–º–µ–Ω–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏<a class="headerlink" href="#id4" title="–°—Å—ã–ª–∫–∞ –Ω–∞ —ç—Ç–æ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫">ÔÉÅ</a></h3>
<p>–í—ã –º–æ–∂–µ—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –º–æ–¥–µ–ª—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–æ–±–∞–≤–∏—Ç—å –∏–ª–∏ —É–¥–∞–ª–∏—Ç—å –ø–æ–ª–µ):</p>
<p>–ü—Ä–∏–º–µ—Ä –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—è –≤ –∫–ª–∞—Å—Å –º–æ–¥–µ–ª–∏:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">Boolean</span><span class="p">,</span> <span class="n">Integer</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">Mapped</span><span class="p">,</span> <span class="n">mapped_column</span>

<span class="k">class</span><span class="w"> </span><span class="nc">User</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">username</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">String</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">email</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">String</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">is_active</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">Boolean</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># ‚Üê –Ω–æ–≤–æ–µ –ø–æ–ª–µ</span>
</pre></div>
</div>
</section>
<section id="id5">
<h3>üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π –≤ –ë–î<a class="headerlink" href="#id5" title="–°—Å—ã–ª–∫–∞ –Ω–∞ —ç—Ç–æ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫">ÔÉÅ</a></h3>
<p>–ü–æ—Å–ª–µ <strong>—Å–æ–∑–¥–∞–Ω–∏—è</strong> –∏–ª–∏ <strong>–∏–∑–º–µ–Ω–µ–Ω–∏—è</strong> –º–æ–¥–µ–ª–∏ <strong>–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ –µ—ë</strong> –≤ –¥–≤—É—Ö –º–µ—Å—Ç–∞—Ö:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">alembic/env.py</span></code> ‚Äî —á—Ç–æ–±—ã Alembic –º–æ–≥ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">src/databases/sqlite/models/__init__.py</span></code> ‚Äî –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –∏–º–ø–æ—Ä—Ç–∞ –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è.</p></li>
</ol>
<section id="alembic-env-py">
<h4>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ <code class="docutils literal notranslate"><span class="pre">alembic/env.py</span></code><a class="headerlink" href="#alembic-env-py" title="–°—Å—ã–ª–∫–∞ –Ω–∞ —ç—Ç–æ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫">ÔÉÅ</a></h4>
<p>–í <code class="docutils literal notranslate"><span class="pre">alembic/env.py</span></code> <strong>–∏–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ</strong> –Ω–æ–≤—É—é –º–æ–¥–µ–ª—å. –≠—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ, —á—Ç–æ–±—ã <strong>Alembic –≤–∏–¥–µ–ª –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ</strong> –Ω–æ–≤–æ–π –º–æ–¥–µ–ª–∏ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –º–∏–≥—Ä–∞—Ü–∏–π.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">src.databases.sqlite.models.base</span><span class="w"> </span><span class="kn">import</span> <span class="n">Base</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.databases.sqlite.models.user</span><span class="w"> </span><span class="kn">import</span> <span class="n">User</span>  <span class="c1"># noqa: F401</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.databases.sqlite.models.post</span><span class="w"> </span><span class="kn">import</span> <span class="n">Post</span>  <span class="c1"># noqa: F401 &lt;-- –ù–û–í–ê–Ø –ú–û–î–ï–õ–¨</span>
</pre></div>
</div>
<div class="note admonition">
<p class="admonition-title">–ó–∞—á–µ–º –Ω—É–∂–µ–Ω –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π # noqa: F401</p>
<p>–í —à–∞–±–ª–æ–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ö—É–∫ ruff, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ pre-commit.
–ü—Ä–∞–≤–∏–ª–æ F401 —É–¥–∞–ª—è–µ—Ç –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∏–º–ø–æ—Ä—Ç—ã.</p>
<p>–ú–æ–¥–µ–ª—å –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é –≤ alembic/env.py, –Ω–æ Alembic –¥–æ–ª–∂–µ–Ω –∑–Ω–∞—Ç—å –æ –µ—ë —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–∏,
—á—Ç–æ–±—ã –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü.</p>
<p>–ò–º–ø–æ—Ä—Ç —Å # noqa: F401 –≥–æ–≤–æ—Ä–∏—Ç ruff, —á—Ç–æ–±—ã –Ω–µ —É–¥–∞–ª—è–ª —ç—Ç–æ—Ç –∏–º–ø–æ—Ä—Ç,
–ø–æ—Å–∫–æ–ª—å–∫—É –æ–Ω –Ω—É–∂–µ–Ω –¥–ª—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π, –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Alembic.</p>
</div>
</section>
<section id="src-databases-sqlite-models-init-py">
<h4>–≠–∫—Å–ø–æ—Ä—Ç –≤ <code class="docutils literal notranslate"><span class="pre">src/databases/sqlite/models/__init__.py</span></code><a class="headerlink" href="#src-databases-sqlite-models-init-py" title="–°—Å—ã–ª–∫–∞ –Ω–∞ —ç—Ç–æ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫">ÔÉÅ</a></h4>
<p>–û–±–Ω–æ–≤–∏—Ç–µ <code class="docutils literal notranslate"><span class="pre">src/databases/sqlite/models/__init__.py</span></code>, —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –º–æ–¥–µ–ª—å –≤ —Å–ø–∏—Å–æ–∫ —ç–∫—Å–ø–æ—Ä—Ç–∞:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">–ú–æ–¥—É–ª—å –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ –≤—Å–µ—Ö ORM-–º–æ–¥–µ–ª–µ–π SQLite.</span>

<span class="sd">–ó–¥–µ—Å—å —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è –≤—Å–µ –º–æ–¥–µ–ª–∏, —á—Ç–æ–±—ã Alembic –º–æ–≥ –∏—Ö –≤–∏–¥–µ—Ç—å.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">.user</span><span class="w"> </span><span class="kn">import</span> <span class="n">User</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.post</span><span class="w"> </span><span class="kn">import</span> <span class="n">Post</span>  <span class="c1"># &lt;-- –¥–æ–±–∞–≤—å—Ç–µ –∏–º–ø–æ—Ä—Ç</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;User&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Post&quot;</span><span class="p">,</span>  <span class="c1"># &lt;-- –¥–æ–±–∞–≤—å—Ç–µ –∏–º–ø–æ—Ä—Ç –≤ —Å–ø–∏—Å–æ–∫</span>
<span class="p">]</span>
</pre></div>
</div>
</section>
<section id="id6">
<h4>–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏<a class="headerlink" href="#id6" title="–°—Å—ã–ª–∫–∞ –Ω–∞ —ç—Ç–æ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫">ÔÉÅ</a></h4>
<p>–ü–æ—Å–ª–µ <strong>–¥–æ–±–∞–≤–ª–µ–Ω–∏—è</strong> –∏–ª–∏ <strong>–∏–∑–º–µ–Ω–µ–Ω–∏—è</strong> –º–æ–¥–µ–ª–∏ <strong>–≤—Å–µ–≥–¥–∞</strong> –≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –∏ –ø—Ä–∏–º–µ–Ω—è–π—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é:</p>
<ol class="arabic">
<li><p>–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>alembic<span class="w"> </span>revision<span class="w"> </span>--autogenerate<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;Add Post model&quot;</span><span class="w">  </span><span class="c1"># –∏–ª–∏ &quot;Add is_active field to User&quot;</span>
</pre></div>
</div>
</li>
<li><p>–ü—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>alembic<span class="w"> </span>upgrade<span class="w"> </span>head
</pre></div>
</div>
</li>
</ol>
<p>–≠—Ç–æ <strong>—Å–æ–∑–¥–∞—Å—Ç –Ω–æ–≤—É—é —Ç–∞–±–ª–∏—Ü—É</strong> –∏–ª–∏ <strong>–æ–±–Ω–æ–≤–∏—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é</strong> –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.</p>
<div class="seealso admonition">
<p class="admonition-title">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</p>
<p>–ü–æ–¥—Ä–æ–±–Ω–µ–µ —Å–º. –≤ —Ä–∞–∑–¥–µ–ª–µ Alembic</p>
</div>
</section>
</section>
<section id="id7">
<h3>üîó –û—Ç–Ω–æ—à–µ–Ω–∏—è –º–µ–∂–¥—É ORM-–º–æ–¥–µ–ª—è–º–∏<a class="headerlink" href="#id7" title="–°—Å—ã–ª–∫–∞ –Ω–∞ —ç—Ç–æ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫">ÔÉÅ</a></h3>
<p>SQLAlchemy –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–ø–∏—Å—ã–≤–∞—Ç—å <strong>–æ—Ç–Ω–æ—à–µ–Ω–∏—è (relationships)</strong> –º–µ–∂–¥—É –º–æ–¥–µ–ª—è–º–∏, —á—Ç–æ —É–ø—Ä–æ—â–∞–µ—Ç —Ä–∞–±–æ—Ç—É —Å —Å–≤—è–∑–∞–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head text-left"><p>–ì—Ä—É–ø–ø–∞</p></th>
<th class="head text-left"><p>–ü–æ–Ω—è—Ç–∏–µ</p></th>
<th class="head text-left"><p>–û–ø–∏—Å–∞–Ω–∏–µ</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p><strong>–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–≤—è–∑–∏</strong></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">relationship()</span></code></p></td>
<td class="text-left"><p>–§—É–Ω–∫—Ü–∏—è SQLAlchemy –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å–≤—è–∑–∏ –º–µ–∂–¥—É –º–æ–¥–µ–ª—è–º–∏.</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">Mapped[...]</span></code></p></td>
<td class="text-left"><p>–ê–Ω–Ω–æ—Ç–∞—Ü–∏—è —Ç–∏–ø–∞ –¥–ª—è –ø–æ–ª—è —Å–≤—è–∑–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, <code class="docutils literal notranslate"><span class="pre">Mapped[&quot;Profile&quot;]</span></code>).</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">ForeignKey</span></code></p></td>
<td class="text-left"><p>–í–Ω–µ—à–Ω–∏–π –∫–ª—é—á, —Å–æ–µ–¥–∏–Ω—è—é—â–∏–π —Ç–∞–±–ª–∏—Ü—ã.</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">secondary</span></code></p></td>
<td class="text-left"><p>–£–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—É—é —Ç–∞–±–ª–∏—Ü—É –¥–ª—è Many-to-Many.</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><strong>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–≤—è–∑–∏</strong></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">back_populates</span></code></p></td>
<td class="text-left"><p>–ü–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ —Å–≤—è–∑–∞–Ω–Ω–æ–º—É –æ–±—ä–µ–∫—Ç—É —Å –æ–±–µ–∏—Ö —Å—Ç–æ—Ä–æ–Ω.</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">uselist</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">False</span></code> –¥–ª—è One-to-One, <code class="docutils literal notranslate"><span class="pre">True</span></code> (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) –¥–ª—è One-to-Many/Many-to-One.</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">lazy</span></code></p></td>
<td class="text-left"><p>–°—Ç—Ä–∞—Ç–µ–≥–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, <code class="docutils literal notranslate"><span class="pre">lazy=&quot;joined&quot;</span></code>). –ü–æ–¥—Ä–æ–±–Ω–µ–µ –≤ —Ä–∞–∑–¥–µ–ª–µ ‚Äú–ü–æ–¥–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö‚Äù.</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><strong>–ü–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏</strong></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">cascade</span></code></p></td>
<td class="text-left"><p>–£–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ–≤–µ–¥–µ–Ω–∏–µ–º –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏/–∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, <code class="docutils literal notranslate"><span class="pre">cascade=&quot;all,</span> <span class="pre">delete-orphan&quot;</span></code>).</p></td>
</tr>
</tbody>
</table>
<section id="id8">
<h4>–¢–∏–ø—ã –æ—Ç–Ω–æ—à–µ–Ω–∏–π<a class="headerlink" href="#id8" title="–°—Å—ã–ª–∫–∞ –Ω–∞ —ç—Ç–æ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫">ÔÉÅ</a></h4>
<table class="docutils align-default">
<colgroup>
<col style="width: 16.7%" />
<col style="width: 25.0%" />
<col style="width: 16.7%" />
<col style="width: 16.7%" />
<col style="width: 25.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>–¢–∏–ø –æ—Ç–Ω–æ—à–µ–Ω–∏—è</p></th>
<th class="head"><p>–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ</p></th>
<th class="head"><p>–ü—Ä–∏–º–µ—Ä</p></th>
<th class="head"><p>–û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</p></th>
<th class="head"><p>–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>One-to-One (–û–¥–∏–Ω –∫ –æ–¥–Ω–æ–º—É)</strong></p></td>
<td><div class="line-block">
<div class="line">–°–≤—è–∑—ã–≤–∞–µ—Ç –æ–¥–∏–Ω —ç–∫–∑–µ–º–ø–ª—è—Ä –æ–¥–Ω–æ–π –º–æ–¥–µ–ª–∏ —Å –æ–¥–Ω–∏–º —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–º –¥—Ä—É–≥–æ–π.</div>
<div class="line">–ß–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è —Å—É—â–Ω–æ—Å—Ç–∏ –Ω–∞ –¥–≤–µ —Ç–∞–±–ª–∏—Ü—ã.</div>
</div>
</td>
<td><p>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏ –µ–≥–æ –ø—Ä–æ—Ñ–∏–ª—å.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">uselist=False</span></code>, <code class="docutils literal notranslate"><span class="pre">back_populates</span></code></p></td>
<td><div class="line-block">
<div class="line">–ö–æ–≥–¥–∞ —É –æ–¥–Ω–æ–π —Å—É—â–Ω–æ—Å—Ç–∏ –µ—Å—Ç—å –æ–¥–∏–Ω —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∞—Ç—Ä–∏–±—É—Ç/–¥–æ–∫—É–º–µ–Ω—Ç,</div>
<div class="line">–∫–æ—Ç–æ—Ä—ã–π –ª–æ–≥–∏—á–Ω–æ –≤—ã–Ω–µ—Å—Ç–∏ –≤ –æ—Ç–¥–µ–ª—å–Ω—É—é —Ç–∞–±–ª–∏—Ü—É.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p><strong>One-to-Many / Many-to-One (–û–¥–∏–Ω –∫–æ –º–Ω–æ–≥–∏–º / –ú–Ω–æ–≥–∏–µ –∫ –æ–¥–Ω–æ–º—É)</strong></p></td>
<td><div class="line-block">
<div class="line">–°–≤—è–∑—ã–≤–∞–µ—Ç –æ–¥–∏–Ω —ç–∫–∑–µ–º–ø–ª—è—Ä –æ–¥–Ω–æ–π –º–æ–¥–µ–ª–∏ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞–º–∏ –¥—Ä—É–≥–æ–π (–∏ –Ω–∞–æ–±–æ—Ä–æ—Ç).</div>
</div>
</td>
<td><p>–û–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞—ë—Ç –º–Ω–æ–≥–æ –ø–æ—Å—Ç–æ–≤.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ForeignKey</span></code>, <code class="docutils literal notranslate"><span class="pre">back_populates</span></code>, <code class="docutils literal notranslate"><span class="pre">cascade</span></code> (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</p></td>
<td><div class="line-block">
<div class="line">–ö–æ–≥–¥–∞ –æ–¥–Ω–∞ —Å—É—â–Ω–æ—Å—Ç—å –º–æ–∂–µ—Ç ¬´–≤–ª–∞–¥–µ—Ç—å¬ª –∏–ª–∏ –±—ã—Ç—å —Å–≤—è–∑–∞–Ω–∞ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –¥—Ä—É–≥–∏–º–∏ —Å—É—â–Ω–æ—Å—Ç—è–º–∏.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><p><strong>Many-to-Many (–ú–Ω–æ–≥–∏–µ –∫–æ –º–Ω–æ–≥–∏–º)</strong></p></td>
<td><div class="line-block">
<div class="line">–°–≤—è–∑—ã–≤–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ –æ–¥–Ω–æ–π –º–æ–¥–µ–ª–∏ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞–º–∏ –¥—Ä—É–≥–æ–π.</div>
<div class="line">–¢—Ä–µ–±—É–µ—Ç –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã.</div>
</div>
</td>
<td><div class="line-block">
<div class="line">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏ —Ç–µ–≥–∏ (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–µ–≥–æ–≤,</div>
<div class="line">—Ç–µ–≥ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–∏—Å–≤–æ–µ–Ω –Ω–µ—Å–∫–æ–ª—å–∫–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º).</div>
</div>
</td>
<td><p><code class="docutils literal notranslate"><span class="pre">secondary</span></code> (—É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—É—é —Ç–∞–±–ª–∏—Ü—É), <code class="docutils literal notranslate"><span class="pre">back_populates</span></code></p></td>
<td><div class="line-block">
<div class="line">–ö–æ–≥–¥–∞ –º–µ–∂–¥—É –¥–≤—É–º—è —Å—É—â–Ω–æ—Å—Ç—è–º–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç —Å–ª–æ–∂–Ω–∞—è —Å–≤—è–∑—å,</div>
<div class="line">–ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–π –∫–∞–∂–¥–∞—è –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–≤—è–∑–∞–Ω–∞ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞–º–∏ –¥—Ä—É–≥–æ–π.</div>
</div>
</td>
</tr>
</tbody>
</table>
<section id="one-to-one">
<h5>üîÑ One-to-One (–û–¥–∏–Ω –∫ –æ–¥–Ω–æ–º—É)<a class="headerlink" href="#one-to-one" title="–°—Å—ã–ª–∫–∞ –Ω–∞ —ç—Ç–æ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫">ÔÉÅ</a></h5>
<p>–°–≤—è–∑—å ‚Äú–æ–¥–∏–Ω-–∫-–æ–¥–Ω–æ–º—É‚Äù (<code class="docutils literal notranslate"><span class="pre">One-to-One</span></code>) –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ <strong>–æ–¥–∏–Ω —ç–∫–∑–µ–º–ø–ª—è—Ä</strong> –ø–µ—Ä–≤–æ–π –º–æ–¥–µ–ª–∏ —Å–≤—è–∑–∞–Ω <strong>—Ä–æ–≤–Ω–æ —Å –æ–¥–Ω–∏–º —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–º</strong> –≤—Ç–æ—Ä–æ–π –º–æ–¥–µ–ª–∏, –∏ –Ω–∞–æ–±–æ—Ä–æ—Ç. –≠—Ç–∞ —Å–≤—è–∑—å —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è <strong>—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è</strong> —Å—É—â–Ω–æ—Å—Ç–∏ –Ω–∞ –¥–≤–µ —Ç–∞–±–ª–∏—Ü—ã, –Ω–∞–ø—Ä–∏–º–µ—Ä, —á—Ç–æ–±—ã –æ—Ç–¥–µ–ª–∏—Ç—å –æ—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ—Ç –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã—Ö –∏–ª–∏ —Ä–µ–¥–∫–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö.</p>
<p><strong>–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:</strong> –ö–æ–≥–¥–∞ —É –æ—Å–Ω–æ–≤–Ω–æ–π —Å—É—â–Ω–æ—Å—Ç–∏ –µ—Å—Ç—å –æ–¥–∏–Ω —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∞—Ç—Ä–∏–±—É—Ç/–¥–æ–∫—É–º–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –ª–æ–≥–∏—á–Ω–æ –≤—ã–Ω–µ—Å—Ç–∏ –≤ –æ—Ç–¥–µ–ª—å–Ω—É—é —Ç–∞–±–ª–∏—Ü—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, —Ö—Ä–∞–Ω–µ–Ω–∏—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏–ª–∏ —Ä–µ–¥–∫–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –ø–æ–ª–µ–π).</p>
<p><strong>–ö–∞–∫ —ç—Ç–æ —É—Å—Ç—Ä–æ–µ–Ω–æ –≤ SQLAlchemy:</strong></p>
<ol class="arabic simple">
<li><p><strong><code class="docutils literal notranslate"><span class="pre">ForeignKey</span></code>:</strong> –û–±—ã—á–Ω–æ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ ‚Äú–¥–æ—á–µ—Ä–Ω–µ–π‚Äù –º–æ–¥–µ–ª–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, <code class="docutils literal notranslate"><span class="pre">Profile</span></code>). –û–Ω–∞ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –ø–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á (<code class="docutils literal notranslate"><span class="pre">id</span></code>) ‚Äú—Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–π‚Äù –º–æ–¥–µ–ª–∏ (<code class="docutils literal notranslate"><span class="pre">User</span></code>).</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">relationship()</span></code> –∏ <code class="docutils literal notranslate"><span class="pre">Mapped[...]</span></code>:</strong> –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å–≤—è–∑—å. –í –º–æ–¥–µ–ª–∏ <code class="docutils literal notranslate"><span class="pre">User</span></code> —Å–æ–∑–¥–∞—ë—Ç—Å—è –ø–æ–ª–µ <code class="docutils literal notranslate"><span class="pre">profile:</span> <span class="pre">Mapped[&quot;Profile&quot;]</span></code>.</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">uselist=False</span></code>:</strong> –≠—Ç–æ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä <strong>–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ</strong> —É–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤ <code class="docutils literal notranslate"><span class="pre">relationship()</span></code>, —á—Ç–æ–±—ã SQLAlchemy –ø–æ–Ω–∏–º–∞–ª, —á—Ç–æ —Å–≤—è–∑—å <strong>–æ–¥–∏–Ω-–∫-–æ–¥–Ω–æ–º—É</strong>, –∞ –Ω–µ –æ–¥–∏–Ω-–∫–æ-–º–Ω–æ–≥–∏–º. SQLAlchemy –æ–∂–∏–¥–∞–µ—Ç <strong>–æ–¥–∏–Ω</strong> –æ–±—ä–µ–∫—Ç, –∞ –Ω–µ —Å–ø–∏—Å–æ–∫.</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">back_populates</span></code>:</strong> –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç <strong>–¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω—é—é</strong> —Å–≤—è–∑—å. –ï—Å–ª–∏ –≤—ã –ø–æ–ª—É—á–∏—Ç–µ <code class="docutils literal notranslate"><span class="pre">user.profile</span></code>, –≤—ã —Å–º–æ–∂–µ—Ç–µ –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ <code class="docutils literal notranslate"><span class="pre">profile.user</span></code>.</p></li>
</ol>
<p><strong>–ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">Mapped</span><span class="p">,</span> <span class="n">relationship</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">ForeignKey</span><span class="p">,</span> <span class="n">String</span><span class="p">,</span> <span class="n">Text</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.base</span><span class="w"> </span><span class="kn">import</span> <span class="n">Base</span>

<span class="k">class</span><span class="w"> </span><span class="nc">User</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>

    <span class="n">username</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">String</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># –°–≤—è–∑—å –æ–¥–∏–Ω-–∫-–æ–¥–Ω–æ–º—É —Å Profile</span>
    <span class="c1"># uselist=False —É–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ —ç—Ç–æ –Ω–µ —Å–ø–∏—Å–æ–∫, –∞ –æ–¥–∏–Ω –æ–±—ä–µ–∫—Ç</span>
    <span class="n">profile</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="s2">&quot;Profile&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span>
        <span class="s2">&quot;Profile&quot;</span><span class="p">,</span>              <span class="c1"># –ò–º—è —Å–≤—è–∑–∞–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏</span>
        <span class="n">back_populates</span><span class="o">=</span><span class="s2">&quot;user&quot;</span><span class="p">,</span>  <span class="c1"># –ò–º—è –ø–æ–ª—è —Å–≤—è–∑–∏ –≤ –º–æ–¥–µ–ª–∏ Profile</span>
        <span class="n">uselist</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>          <span class="c1"># –£–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ —Å–≤—è–∑—å –æ–¥–∏–Ω-–∫-–æ–¥–Ω–æ–º—É</span>
        <span class="n">lazy</span><span class="o">=</span><span class="s2">&quot;joined&quot;</span>           <span class="c1"># –°—Ç—Ä–∞—Ç–µ–≥–∏—è –ø–æ–¥–≥—Ä—É–∑–∫–∏ (—Å–º. —Ä–∞–∑–¥–µ–ª &quot;–ü–æ–¥–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö&quot;)</span>
    <span class="p">)</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Profile</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>

    <span class="n">bio</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">Text</span><span class="p">)</span>
    <span class="c1"># ForeignKey —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ —Ç–∞–±–ª–∏—Ü—É &quot;users&quot; –∏ –∫–æ–ª–æ–Ω–∫—É &quot;id&quot;</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s2">&quot;users.id&quot;</span><span class="p">),</span> <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># unique=True —á–∞—Å—Ç–æ –¥–æ–±–∞–≤–ª—è—é—Ç –¥–ª—è One-to-One</span>

    <span class="c1"># –û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å</span>
    <span class="n">user</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="s2">&quot;User&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span>
        <span class="s2">&quot;User&quot;</span><span class="p">,</span>                 <span class="c1"># –ò–º—è —Å–≤—è–∑–∞–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏</span>
        <span class="n">back_populates</span><span class="o">=</span><span class="s2">&quot;profile&quot;</span><span class="p">,</span> <span class="c1"># –ò–º—è –ø–æ–ª—è —Å–≤—è–∑–∏ –≤ –º–æ–¥–µ–ª–∏ User</span>
        <span class="n">uselist</span><span class="o">=</span><span class="kc">False</span>           <span class="c1"># –û–±–µ —Å—Ç–æ—Ä–æ–Ω—ã –º–æ–≥—É—Ç –∏–º–µ—Ç—å uselist=False –¥–ª—è —è—Å–Ω–æ—Å—Ç–∏</span>
    <span class="p">)</span>
</pre></div>
</div>
<div class="tip admonition">
<p class="admonition-title">–ü–æ—á–µ–º—É unique=True –≤ user_id?</p>
<p>–•–æ—Ç—è <code class="docutils literal notranslate"><span class="pre">uselist=False</span></code> –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ <code class="docutils literal notranslate"><span class="pre">User</span></code> –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ —É –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –±—É–¥–µ—Ç —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –ø—Ä–æ—Ñ–∏–ª—å, –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ <code class="docutils literal notranslate"><span class="pre">unique=True</span></code> –Ω–∞ <code class="docutils literal notranslate"><span class="pre">user_id</span></code> –≤ —Ç–∞–±–ª–∏—Ü–µ <code class="docutils literal notranslate"><span class="pre">profiles</span></code> –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ <em>–æ–¥–∏–Ω</em> <code class="docutils literal notranslate"><span class="pre">user_id</span></code> –Ω–µ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –≤ <em>–Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö</em> —Å—Ç—Ä–æ–∫–∞—Ö —Ç–∞–±–ª–∏—Ü—ã <code class="docutils literal notranslate"><span class="pre">profiles</span></code>. –≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –Ω–∞ —É—Ä–æ–≤–Ω–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.</p>
</div>
</section>
<section id="one-to-many-many-to-one">
<h5>üîÑ One-to-Many / Many-to-One (–û–¥–∏–Ω –∫–æ –º–Ω–æ–≥–∏–º / –ú–Ω–æ–≥–∏–µ –∫ –æ–¥–Ω–æ–º—É)<a class="headerlink" href="#one-to-many-many-to-one" title="–°—Å—ã–ª–∫–∞ –Ω–∞ —ç—Ç–æ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫">ÔÉÅ</a></h5>
<p>–°–≤—è–∑—å ‚Äú–æ–¥–∏–Ω-–∫–æ-–º–Ω–æ–≥–∏–º‚Äù (<code class="docutils literal notranslate"><span class="pre">One-to-Many</span></code>) –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ <strong>–æ–¥–∏–Ω —ç–∫–∑–µ–º–ø–ª—è—Ä</strong> –ø–µ—Ä–≤–æ–π –º–æ–¥–µ–ª–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, <code class="docutils literal notranslate"><span class="pre">Author</span></code>) –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–≤—è–∑–∞–Ω —Å <strong>–º–Ω–æ–∂–µ—Å—Ç–≤–æ–º</strong> —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ –≤—Ç–æ—Ä–æ–π –º–æ–¥–µ–ª–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, <code class="docutils literal notranslate"><span class="pre">Book</span></code>). –° —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è –≤—Ç–æ—Ä–æ–π –º–æ–¥–µ–ª–∏ —ç—Ç–æ ‚Äú–º–Ω–æ–≥–∏–µ-–∫-–æ–¥–Ω–æ–º—É‚Äù (<code class="docutils literal notranslate"><span class="pre">Many-to-One</span></code>), —Ç–∞–∫ –∫–∞–∫ <strong>–º–Ω–æ–∂–µ—Å—Ç–≤–æ</strong> —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ (<code class="docutils literal notranslate"><span class="pre">Book</span></code>) —Å–≤—è–∑–∞–Ω—ã —Å <strong>–æ–¥–Ω–∏–º</strong> —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–º (<code class="docutils literal notranslate"><span class="pre">Author</span></code>). –≠—Ç–æ <strong>–æ–¥–Ω–∞ –∏ —Ç–∞ –∂–µ —Ñ–∏–∑–∏—á–µ—Å–∫–∞—è —Å–≤—è–∑—å</strong>, —Å–º–æ—Ç—Ä—è—â–∞—è —Å —Ä–∞–∑–Ω—ã—Ö —Å—Ç–æ—Ä–æ–Ω.</p>
<p><strong>–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:</strong> –ö–æ–≥–¥–∞ –æ–¥–Ω–∞ —Å—É—â–Ω–æ—Å—Ç—å ‚Äú–≤–ª–∞–¥–µ–µ—Ç‚Äù –∏–ª–∏ ‚Äú—Å–æ–¥–µ—Ä–∂–∏—Ç‚Äù –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥—Ä—É–≥–∏—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏ –µ–≥–æ –ø–æ—Å—Ç—ã, –∫–æ–º–ø–∞–Ω–∏—è –∏ –µ—ë —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏, –∑–∞–∫–∞–∑ –∏ –µ–≥–æ –ø–æ–∑–∏—Ü–∏–∏).</p>
<p><strong>–ö–∞–∫ —ç—Ç–æ —É—Å—Ç—Ä–æ–µ–Ω–æ –≤ SQLAlchemy:</strong></p>
<ol class="arabic simple">
<li><p><strong><code class="docutils literal notranslate"><span class="pre">ForeignKey</span></code>:</strong> –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ ‚Äú–¥–æ—á–µ—Ä–Ω–µ–π‚Äù –º–æ–¥–µ–ª–∏ (<code class="docutils literal notranslate"><span class="pre">Book</span></code>), —É–∫–∞–∑—ã–≤–∞—è –Ω–∞ –ø–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á (<code class="docutils literal notranslate"><span class="pre">id</span></code>) ‚Äú—Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–π‚Äù –º–æ–¥–µ–ª–∏ (<code class="docutils literal notranslate"><span class="pre">Author</span></code>). –≠—Ç–æ —Å–æ–∑–¥–∞—ë—Ç —Ñ–∏–∑–∏—á–µ—Å–∫—É—é —Å–≤—è–∑—å –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">relationship()</span></code> –≤ ‚Äú—Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–π‚Äù –º–æ–¥–µ–ª–∏ (<code class="docutils literal notranslate"><span class="pre">Author</span></code>):</strong> –°–æ–∑–¥–∞—ë—Ç –ø–æ–ª–µ <code class="docutils literal notranslate"><span class="pre">books:</span> <span class="pre">Mapped[list[&quot;Book&quot;]]</span></code>. SQLAlchemy –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –æ–∂–∏–¥–∞–µ—Ç <strong>—Å–ø–∏—Å–æ–∫</strong> —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤ (<code class="docutils literal notranslate"><span class="pre">uselist=True</span></code> –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é).</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">relationship()</span></code> –≤ ‚Äú–¥–æ—á–µ—Ä–Ω–µ–π‚Äù –º–æ–¥–µ–ª–∏ (<code class="docutils literal notranslate"><span class="pre">Book</span></code>):</strong> –°–æ–∑–¥–∞—ë—Ç –ø–æ–ª–µ <code class="docutils literal notranslate"><span class="pre">author:</span> <span class="pre">Mapped[&quot;Author&quot;]</span></code>. SQLAlchemy –æ–∂–∏–¥–∞–µ—Ç <strong>–æ–¥–∏–Ω</strong> —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π –æ–±—ä–µ–∫—Ç.</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">back_populates</span></code>:</strong> –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω—é—é —Å–≤—è–∑—å.</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">cascade</span></code>:</strong> –ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä.</p></li>
</ol>
<div class="dropdown admonition">
<p class="admonition-title">–ü–æ—è—Å–Ω–µ–Ω–∏–µ: cascade=all, delete-orphan</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">all</span></code>: –ü—Ä–∏–º–µ–Ω—è–µ—Ç –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (<code class="docutils literal notranslate"><span class="pre">save-update</span></code>, <code class="docutils literal notranslate"><span class="pre">merge</span></code>, <code class="docutils literal notranslate"><span class="pre">refresh-expire</span></code>, <code class="docutils literal notranslate"><span class="pre">expunge</span></code>, <code class="docutils literal notranslate"><span class="pre">delete</span></code>) –∫ –¥–æ—á–µ—Ä–Ω–∏–º –æ–±—ä–µ–∫—Ç–∞–º. –í –æ—Å–Ω–æ–≤–Ω–æ–º, —ç—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –¥–æ—á–µ—Ä–Ω–∏—Ö –æ–±—ä–µ–∫—Ç–∞—Ö –±—É–¥—É—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å—Å—è –∏ –ø—Ä–∏–º–µ–Ω—è—Ç—å—Å—è –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Ä–æ–¥–∏—Ç–µ–ª—è.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">delete-orphan</span></code>: –ï—Å–ª–∏ –¥–æ—á–µ—Ä–Ω–∏–π –æ–±—ä–µ–∫—Ç (<code class="docutils literal notranslate"><span class="pre">Post</span></code>) –æ—Ç–≤—è–∑—ã–≤–∞–µ—Ç—Å—è –æ—Ç —Ä–æ–¥–∏—Ç–µ–ª—è (<code class="docutils literal notranslate"><span class="pre">User</span></code>) –∏ –±–æ–ª—å—à–µ –Ω–µ —Å–≤—è–∑–∞–Ω –Ω–∏ —Å –∫–∞–∫–∏–º –¥—Ä—É–≥–∏–º —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–º –æ–±—ä–µ–∫—Ç–æ–º, –æ–Ω –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—ë–Ω –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º <code class="docutils literal notranslate"><span class="pre">commit()</span></code>. –≠—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç ‚Äú–æ—Å–∏—Ä–æ—Ç–µ–≤—à–∏–µ‚Äù –∑–∞–ø–∏—Å–∏.</p></li>
</ul>
</div>
<p><strong>–ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">Mapped</span><span class="p">,</span> <span class="n">relationship</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">ForeignKey</span><span class="p">,</span> <span class="n">String</span><span class="p">,</span> <span class="n">Text</span><span class="p">,</span> <span class="n">Integer</span>

<span class="k">class</span><span class="w"> </span><span class="nc">User</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span> <span class="c1"># &quot;–†–æ–¥–∏—Ç–µ–ª—å—Å–∫–∞—è&quot; –º–æ–¥–µ–ª—å</span>

    <span class="n">username</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">String</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># –û–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Äî –º–Ω–æ–≥–æ –ø–æ—Å—Ç–æ–≤ (One-to-Many)</span>
    <span class="c1"># SQLAlchemy –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –æ–∂–∏–¥–∞–µ—Ç —Å–ø–∏—Å–æ–∫ (uselist=True)</span>
    <span class="n">posts</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="s2">&quot;Post&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span>
        <span class="s2">&quot;Post&quot;</span><span class="p">,</span>                 <span class="c1"># –ò–º—è —Å–≤—è–∑–∞–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏</span>
        <span class="n">back_populates</span><span class="o">=</span><span class="s2">&quot;user&quot;</span><span class="p">,</span>  <span class="c1"># –ò–º—è –ø–æ–ª—è —Å–≤—è–∑–∏ –≤ –º–æ–¥–µ–ª–∏ Post</span>
        <span class="n">cascade</span><span class="o">=</span><span class="s2">&quot;all, delete-orphan&quot;</span><span class="p">,</span> <span class="c1"># –£–¥–∞–ª—è–µ—Ç –ø–æ—Å—Ç—ã –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</span>
        <span class="n">lazy</span><span class="o">=</span><span class="s2">&quot;select&quot;</span>           <span class="c1"># –°—Ç—Ä–∞—Ç–µ–≥–∏—è –ø–æ–¥–≥—Ä—É–∑–∫–∏ (—Å–º. —Ä–∞–∑–¥–µ–ª &quot;–ü–æ–¥–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö&quot;)</span>
    <span class="p">)</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Post</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span> <span class="c1"># &quot;–î–æ—á–µ—Ä–Ω—è—è&quot; –º–æ–¥–µ–ª—å</span>

    <span class="n">title</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">String</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">content</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">Text</span><span class="p">)</span>
    <span class="c1"># ForeignKey —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ —Ç–∞–±–ª–∏—Ü—É &quot;users&quot; –∏ –∫–æ–ª–æ–Ω–∫—É &quot;id&quot;</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s2">&quot;users.id&quot;</span><span class="p">))</span>

    <span class="c1"># –ú–Ω–æ–≥–∏–µ –ø–æ—Å—Ç—ã ‚Äî –∫ –æ–¥–Ω–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é (Many-to-One)</span>
    <span class="n">user</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="s2">&quot;User&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span>
        <span class="s2">&quot;User&quot;</span><span class="p">,</span>                 <span class="c1"># –ò–º—è —Å–≤—è–∑–∞–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏</span>
        <span class="n">back_populates</span><span class="o">=</span><span class="s2">&quot;posts&quot;</span>  <span class="c1"># –ò–º—è –ø–æ–ª—è —Å–≤—è–∑–∏ –≤ –º–æ–¥–µ–ª–∏ User</span>
    <span class="p">)</span>
</pre></div>
</div>
</section>
<section id="many-to-many">
<h5>üîÑ Many-to-Many (–ú–Ω–æ–≥–∏–µ –∫–æ –º–Ω–æ–≥–∏–º)<a class="headerlink" href="#many-to-many" title="–°—Å—ã–ª–∫–∞ –Ω–∞ —ç—Ç–æ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫">ÔÉÅ</a></h5>
<p>–°–≤—è–∑—å ‚Äú–º–Ω–æ–≥–∏–µ-–∫–æ-–º–Ω–æ–≥–∏–º‚Äù (<code class="docutils literal notranslate"><span class="pre">Many-to-Many</span></code>) –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ <strong>–º–Ω–æ–∂–µ—Å—Ç–≤–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤</strong> –ø–µ—Ä–≤–æ–π –º–æ–¥–µ–ª–∏ –º–æ–≥—É—Ç –±—ã—Ç—å —Å–≤—è–∑–∞–Ω—ã —Å <strong>–º–Ω–æ–∂–µ—Å—Ç–≤–æ–º —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤</strong> –≤—Ç–æ—Ä–æ–π –º–æ–¥–µ–ª–∏. –≠—Ç–∞ —Å–≤—è–∑—å —Ç—Ä–µ–±—É–µ—Ç <strong>–≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã</strong> (–∞—Å—Å–æ—Ü–∏–∞—Ü–∏–∏), –≤ –∫–æ—Ç–æ—Ä–æ–π —Ö—Ä–∞–Ω—è—Ç—Å—è –ø–∞—Ä—ã –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤, —Å–æ–µ–¥–∏–Ω—è—é—â–∏—Ö –∑–∞–ø–∏—Å–∏ –∏–∑ –æ–±–µ–∏—Ö —Ç–∞–±–ª–∏—Ü.</p>
<p><strong>–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:</strong> –ö–æ–≥–¥–∞ –º–µ–∂–¥—É –¥–≤—É–º—è —Å—É—â–Ω–æ—Å—Ç—è–º–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç —Å–ª–æ–∂–Ω–∞—è —Å–≤—è–∑—å, –∏ –∫–∞–∂–¥–∞—è –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–≤—è–∑–∞–Ω–∞ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞–º–∏ –¥—Ä—É–≥–æ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ç–µ–≥–∏ –∏ —Å—Ç–∞—Ç—å–∏, –≤—Ä–∞—á–∏ –∏ –ø–∞—Ü–∏–µ–Ω—Ç—ã, —Å—Ç—É–¥–µ–Ω—Ç—ã –∏ –∫—É—Ä—Å—ã).</p>
<p><strong>–ö–∞–∫ —ç—Ç–æ —É—Å—Ç—Ä–æ–µ–Ω–æ –≤ SQLAlchemy:</strong></p>
<ol class="arabic simple">
<li><p><strong><code class="docutils literal notranslate"><span class="pre">Table</span></code> (–∞—Å—Å–æ—Ü–∏–∞—Ç–∏–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞):</strong> –°–æ–∑–¥–∞—ë—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–π –æ–±—ä–µ–∫—Ç <code class="docutils literal notranslate"><span class="pre">Table</span></code>, –Ω–µ —è–≤–ª—è—é—â–∏–π—Å—è ORM-–º–æ–¥–µ–ª—å—é. –û–Ω —Å–æ–¥–µ—Ä–∂–∏—Ç <strong>–¥–≤–µ</strong> <code class="docutils literal notranslate"><span class="pre">ForeignKey</span></code>, –∫–∞–∂–¥–∞—è –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –ø–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á (<code class="docutils literal notranslate"><span class="pre">id</span></code>) –æ–¥–Ω–æ–π –∏–∑ —Å–≤—è–∑—ã–≤–∞–µ–º—ã—Ö ORM-–º–æ–¥–µ–ª–µ–π (<code class="docutils literal notranslate"><span class="pre">User</span></code> –∏ <code class="docutils literal notranslate"><span class="pre">Tag</span></code>).</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">relationship()</span></code> –≤ –æ–±–µ–∏—Ö –º–æ–¥–µ–ª—è—Ö:</strong> –í –æ–±–µ–∏—Ö ORM-–º–æ–¥–µ–ª—è—Ö (<code class="docutils literal notranslate"><span class="pre">User</span></code> –∏ <code class="docutils literal notranslate"><span class="pre">Tag</span></code>) —Å–æ–∑–¥–∞—é—Ç—Å—è –ø–æ–ª—è <code class="docutils literal notranslate"><span class="pre">Mapped[list[...]]</span></code>, –∏—Å–ø–æ–ª—å–∑—É—è <code class="docutils literal notranslate"><span class="pre">relationship()</span></code>.</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">secondary</span></code>:</strong> –í <code class="docutils literal notranslate"><span class="pre">relationship()</span></code> —É–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∏–º—è –∞—Å—Å–æ—Ü–∏–∞—Ç–∏–≤–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, <code class="docutils literal notranslate"><span class="pre">secondary=user_tag_association</span></code>), —á—Ç–æ–±—ã SQLAlchemy –∑–Ω–∞–ª, –≥–¥–µ –∏—Å–∫–∞—Ç—å —Å–≤—è–∑—å.</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">back_populates</span></code>:</strong> –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω—é—é —Å–≤—è–∑—å.</p></li>
</ol>
<p><strong>–ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">Table</span><span class="p">,</span> <span class="n">Column</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">,</span> <span class="n">String</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">Mapped</span><span class="p">,</span> <span class="n">relationship</span>

<span class="c1"># –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–∞—è (–∞—Å—Å–æ—Ü–∏–∞—Ç–∏–≤–Ω–∞—è) —Ç–∞–±–ª–∏—Ü–∞</span>
<span class="n">user_tag_association</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
    <span class="s2">&quot;user_tags&quot;</span><span class="p">,</span>              <span class="c1"># –ò–º—è –∞—Å—Å–æ—Ü–∏–∞—Ç–∏–≤–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã –≤ –ë–î</span>
    <span class="n">Base</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span>            <span class="c1"># –°–≤—è–∑—ã–≤–∞–µ–º —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏ Base</span>
    <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;user_id&quot;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s2">&quot;users.id&quot;</span><span class="p">)),</span> <span class="c1"># FK –Ω–∞ —Ç–∞–±–ª–∏—Ü—É users</span>
    <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;tag_id&quot;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s2">&quot;tags.id&quot;</span><span class="p">))</span>    <span class="c1"># FK –Ω–∞ —Ç–∞–±–ª–∏—Ü—É tags</span>
<span class="p">)</span>

<span class="k">class</span><span class="w"> </span><span class="nc">User</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>

    <span class="n">username</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">String</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># –ú–Ω–æ–≥–∏–µ-–∫–æ-–º–Ω–æ–≥–∏–º: —Å–ø–∏—Å–æ–∫ —Ç–µ–≥–æ–≤</span>
    <span class="n">tags</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="s2">&quot;Tag&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span>
        <span class="s2">&quot;Tag&quot;</span><span class="p">,</span>                          <span class="c1"># –ò–º—è —Å–≤—è–∑–∞–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏</span>
        <span class="n">secondary</span><span class="o">=</span><span class="n">user_tag_association</span><span class="p">,</span> <span class="c1"># –£–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –∞—Å—Å–æ—Ü–∏–∞—Ç–∏–≤–Ω—É—é —Ç–∞–±–ª–∏—Ü—É</span>
        <span class="n">back_populates</span><span class="o">=</span><span class="s2">&quot;users&quot;</span>          <span class="c1"># –ò–º—è –ø–æ–ª—è —Å–≤—è–∑–∏ –≤ –º–æ–¥–µ–ª–∏ Tag</span>
    <span class="p">)</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Tag</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>

    <span class="n">name</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">String</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># –ú–Ω–æ–≥–∏–µ-–∫–æ-–º–Ω–æ–≥–∏–º: —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</span>
    <span class="n">users</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="s2">&quot;User&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span>
        <span class="s2">&quot;User&quot;</span><span class="p">,</span>                         <span class="c1"># –ò–º—è —Å–≤—è–∑–∞–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏</span>
        <span class="n">secondary</span><span class="o">=</span><span class="n">user_tag_association</span><span class="p">,</span> <span class="c1"># –£–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –∞—Å—Å–æ—Ü–∏–∞—Ç–∏–≤–Ω—É—é —Ç–∞–±–ª–∏—Ü—É</span>
        <span class="n">back_populates</span><span class="o">=</span><span class="s2">&quot;tags&quot;</span>           <span class="c1"># –ò–º—è –ø–æ–ª—è —Å–≤—è–∑–∏ –≤ –º–æ–¥–µ–ª–∏ User</span>
    <span class="p">)</span>
</pre></div>
</div>
<p><strong>–ü–ª–∞–Ω –¥–ª—è –Ω–æ–≤–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞:</strong></p>
<ol class="arabic simple">
<li><p><strong>–í–≤–µ–¥–µ–Ω–∏–µ –≤ Pydantic-—Å—Ö–µ–º—ã –¥–ª—è SQLAlchemy:</strong></p>
<ul class="simple">
<li><p>–ö—Ä–∞—Ç–∫–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ, —á—Ç–æ —Ç–∞–∫–æ–µ Pydantic-—Å—Ö–µ–º—ã.</p></li>
<li><p>–ó–∞—á–µ–º –æ–Ω–∏ –Ω—É–∂–Ω—ã: –≤–∞–ª–∏–¥–∞—Ü–∏—è, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å, —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ, —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è.</p></li>
<li><p>–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å SQLAlchemy.</p></li>
<li><p>–ì–¥–µ –Ω–∞—Ö–æ–¥—è—Ç—Å—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, <code class="docutils literal notranslate"><span class="pre">src/databases/sqlite/schemas.py</span></code>).</p></li>
</ul>
</li>
<li><p><strong>Pydantic-—Å—Ö–µ–º—ã –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (–≤—Ö–æ–¥—è—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö):</strong></p>
<ul class="simple">
<li><p>–ü—Ä–∏–º–µ—Ä: —Å–æ–∑–¥–∞–Ω–∏–µ —Å—Ö–µ–º—ã –¥–ª—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, <code class="docutils literal notranslate"><span class="pre">UserCreateSchema</span></code>).</p></li>
<li><p>–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ FastAPI (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ) –∏–ª–∏ –≤ DAO –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º.</p></li>
<li><p>–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞: —Ç–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞.</p></li>
</ul>
</li>
<li><p><strong>Pydantic-—Å—Ö–µ–º—ã –¥–ª—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ (–≤—ã—Ö–æ–¥—è—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö):</strong></p>
<ul class="simple">
<li><p>–ü—Ä–∏–º–µ—Ä: —Å–æ–∑–¥–∞–Ω–∏–µ —Å—Ö–µ–º—ã –¥–ª—è –≤—ã—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, <code class="docutils literal notranslate"><span class="pre">UserResponseSchema</span></code>).</p></li>
<li><p>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ <code class="docutils literal notranslate"><span class="pre">from_attributes=True</span></code>.</p></li>
<li><p>–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞ SQLAlchemy –≤ Pydantic-–æ–±—ä–µ–∫—Ç: <code class="docutils literal notranslate"><span class="pre">PydanticSchema.from_orm(sqla_obj)</span></code>.</p></li>
<li><p>–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ Pydantic-–æ–±—ä–µ–∫—Ç–∞ –≤ —Å–ª–æ–≤–∞—Ä—å: <code class="docutils literal notranslate"><span class="pre">pydantic_obj.model_dump()</span></code>.</p></li>
<li><p>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å <code class="docutils literal notranslate"><span class="pre">to_dict()</span></code> –∏ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ (–∫–æ–Ω—Ç—Ä–æ–ª—å –ø–æ–ª–µ–π, —Ç–∏–ø–æ–≤ –∏ —Ç.–¥.).</p></li>
<li><p>–ü—Ä–∏–º–µ—Ä: –ø–æ–ª—É—á–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞ –∏–∑ –ë–î –∏ –≤–æ–∑–≤—Ä–∞—Ç –µ–≥–æ –≤ –≤–∏–¥–µ Pydantic-—Å—Ö–µ–º—ã.</p></li>
</ul>
</li>
</ol>
</section>
</section>
</section>
</section>
<section id="pydantic">
<h2>üìã Pydantic<a class="headerlink" href="#pydantic" title="–°—Å—ã–ª–∫–∞ –Ω–∞ —ç—Ç–æ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫">ÔÉÅ</a></h2>
<p>Pydantic ‚Äî —ç—Ç–æ –º–æ—â–Ω–∞—è <strong>–±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö</strong> –¥–ª—è Python. –í –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ SQLAlchemy, Pydantic-—Å—Ö–µ–º—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è:</p>
<ul class="simple">
<li><p><strong>–í–∞–ª–∏–¥–∞—Ü–∏–∏ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:</strong> –ü—Ä–æ–≤–µ—Ä–∫–∏, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ, –ø–æ—Å—Ç—É–ø–∞—é—â–∏–µ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∏–∑ API –∏–ª–∏ —Ñ–æ—Ä–º—ã), —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –æ–∂–∏–¥–∞–µ–º–æ–º—É —Ñ–æ—Ä–º–∞—Ç—É –∏ —Ç–∏–ø–∞–º.</p></li>
<li><p><strong>–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –≤—ã—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:</strong> –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –æ–±—ä–µ–∫—Ç–æ–≤ SQLAlchemy (–º–æ–¥–µ–ª–µ–π –ë–î) –≤ —á—ë—Ç–∫–æ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö (–æ–±—ã—á–Ω–æ —Å–ª–æ–≤–∞—Ä–∏ –∏–ª–∏ JSON), –≥–æ—Ç–æ–≤—ã–µ –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –∫–ª–∏–µ–Ω—Ç—É –∏–ª–∏ –¥—Ä—É–≥–æ–º—É —Å–µ—Ä–≤–∏—Å—É.</p></li>
<li><p><strong>–û–±–µ—Å–ø–µ—á–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:</strong> –ö–æ–Ω—Ç—Ä–æ–ª—è, –∫–∞–∫–∏–µ –ø–æ–ª—è –∏ –∫–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –∏–∑/–≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö, –ø–æ–∑–≤–æ–ª—è—è –∏—Å–∫–ª—é—á–∏—Ç—å —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ö—ç—à–∏ –ø–∞—Ä–æ–ª–µ–π) –∏–∑ –≤—ã—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.</p></li>
<li><p><strong>–ü–æ–≤—ã—à–µ–Ω–∏—è –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç–∏ –∏ —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏ –∫–æ–¥–∞:</strong> –ó–∞ —Å—á—ë—Ç —è–≤–Ω–æ–≥–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä –¥–∞–Ω–Ω—ã—Ö.</p></li>
</ul>
<p><strong>–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å SQLAlchemy</strong> –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∫–∞–∫ ORM (—É–¥–æ–±–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å –æ–±—ä–µ–∫—Ç–∞–º–∏), —Ç–∞–∫ –∏ Pydantic (–∂—ë—Å—Ç–∫–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è). Pydantic –º–æ–∂–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ ‚Äú–º–∞–ø–ø–∏—Ç—å‚Äù –∞—Ç—Ä–∏–±—É—Ç—ã –æ–±—ä–µ–∫—Ç–æ–≤ SQLAlchemy –≤ —Å–≤–æ–∏ –ø–æ–ª—è, –∏—Å–ø–æ–ª—å–∑—É—è –æ–ø—Ü–∏—é <code class="docutils literal notranslate"><span class="pre">from_attributes=True</span></code>.</p>
<p>–í —à–∞–±–ª–æ–Ω–µ –≤—Å–µ Pydantic-—Å—Ö–µ–º—ã, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å SQLite, –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –≤ –ø–∞–ø–∫–µ <code class="docutils literal notranslate"><span class="pre">src/databases/sqlite/schemas/</span></code>. –ö–∞–∂–¥–∞—è —Å—É—â–Ω–æ—Å—Ç—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, <code class="docutils literal notranslate"><span class="pre">User</span></code>) –∏–º–µ–µ—Ç —Å–≤–æ–π —Ñ–∞–π–ª —Å—Ö–µ–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, <code class="docutils literal notranslate"><span class="pre">user.py</span></code>), —Å–æ–¥–µ—Ä–∂–∞—â–∏–π —Ä–∞–∑–Ω—ã–µ —Å—Ö–µ–º—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ü–µ–ª–µ–π (–≤–∞–ª–∏–¥–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è, –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è, —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞).</p>
<div class="toggle docutils container">
</div>
<div class="tip admonition">
<p class="admonition-title">–°–æ–≤–µ—Ç: –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è Pydantic-—Å—Ö–µ–º</p>
<p>–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Å–æ–∑–¥–∞–≤–∞—Ç—å <strong>—Ä–∞–∑–Ω—ã–µ —Å—Ö–µ–º—ã</strong> –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π, –¥–æ–±–∞–≤–ª—è—è Request/Response –≤ –Ω–∞–∑–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏:</p>
<p><strong>–î–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤—Ö–æ–¥—è—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö (Requests):</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">UserCreateRequest</span></code> ‚Äî –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ <em>—Å–æ–∑–¥–∞–Ω–∏–∏</em>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">UserUpdateRequest</span></code> ‚Äî –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ <em>–æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏</em> (–º–æ–∂–µ—Ç –±—ã—Ç—å –¥—Ä—É–≥–æ–π, —Å –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º–∏ –ø–æ–ª—è–º–∏).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">{Entity}OtherOperationRequest</span></code> ‚Äî –¥–ª—è –¥—Ä—É–≥–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π.</p></li>
</ul>
<p><strong>–î–ª—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∏—Å—Ö–æ–¥—è—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö (Responses):</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">UserResponse</span></code> ‚Äî –¥–ª—è <em>–æ—Å–Ω–æ–≤–Ω–æ–π</em> —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ –≤–æ–∑–≤—Ä–∞—Ç–∞ –¥–∞–Ω–Ω—ã—Ö.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">UserPublicResponse</span></code> ‚Äî –¥–ª—è <em>–ø—É–±–ª–∏—á–Ω–æ–≥–æ</em> –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –±–µ–∑ email).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">{Entity}DetailedResponse</span></code> ‚Äî –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ–≥–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è.</p></li>
</ul>
</div>
<section id="id9">
<h3>–í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥—è—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö<a class="headerlink" href="#id9" title="–°—Å—ã–ª–∫–∞ –Ω–∞ —ç—Ç–æ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫">ÔÉÅ</a></h3>
<p>–ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ API-–∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è), –≤–∞–∂–Ω–æ <strong>–ø—Ä–æ–≤–µ—Ä–∏—Ç—å</strong> –∏—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ <em>–¥–æ</em> –ø–æ–ø—ã—Ç–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏–∑–±–µ–∂–∞—Ç—å –æ—à–∏–±–æ–∫ –∏ –æ–±–µ—Å–ø–µ—á–∏—Ç—å —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –¥–∞–∂–µ –µ—Å–ª–∏ ORM (SQLAlchemy) –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î.</p>
<p><strong>–í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–∑–≤–æ–ª—è–µ—Ç:</strong></p>
<ul class="simple">
<li><p><strong>–û–ø—Ä–µ–¥–µ–ª—è—Ç—å –æ–∂–∏–¥–∞–µ–º—ã–µ –ø–æ–ª—è –∏ –∏—Ö —Ç–∏–ø—ã</strong> (<code class="docutils literal notranslate"><span class="pre">str</span></code>, <code class="docutils literal notranslate"><span class="pre">int</span></code>, <code class="docutils literal notranslate"><span class="pre">EmailStr</span></code> –∏ —Ç.–¥.).</p></li>
<li><p><strong>–ù–∞–∫–ª–∞–¥—ã–≤–∞—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è</strong> (–Ω–∞–ø—Ä–∏–º–µ—Ä, –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ —Å—Ç—Ä–æ–∫–∏, —Ñ–æ—Ä–º–∞—Ç email, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –≤–∞–ª–∏–¥–∞—Ç–æ—Ä—ã).</p></li>
<li><p><strong>–ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å, –∫–∞–∫–∏–µ –ø–æ–ª—è –ø—Ä–∏–Ω–∏–º–∞—é—Ç—Å—è</strong>, –∏—Å–∫–ª—é—á–∞—è –Ω–µ–∂–µ–ª–∞—Ç–µ–ª—å–Ω—ã–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, <code class="docutils literal notranslate"><span class="pre">id</span></code> –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏).</p></li>
<li><p><strong>–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è —Å –≤–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞–º–∏</strong> (–Ω–∞–ø—Ä–∏–º–µ—Ä, FastAPI) –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏.</p></li>
</ul>
</section>
<section id="id10">
<h3>–°–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏—Å—Ö–æ–¥—è—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö (–°—Ö–µ–º—ã –æ—Ç–≤–µ—Ç–∞)<a class="headerlink" href="#id10" title="–°—Å—ã–ª–∫–∞ –Ω–∞ —ç—Ç–æ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫">ÔÉÅ</a></h3>
<p>–ü—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –¥–∞–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∏–ª–∏ –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è), –≤–∞–∂–Ω–æ <strong>–∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å</strong>, <em>–∫–∞–∫–∏–µ –ø–æ–ª—è –∏ –≤ –∫–∞–∫–æ–º —Ñ–æ—Ä–º–∞—Ç–µ</em> –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è. –≠—Ç–æ –æ—Å–æ–±–µ–Ω–Ω–æ –≤–∞–∂–Ω–æ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–µ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å —Ö–µ—à –ø–∞—Ä–æ–ª—è) –∏ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏ API.</p>
<p><strong>–°–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å:</strong></p>
<ul class="simple">
<li><p><strong>–ö–æ–Ω—Ç—Ä–æ–ª—å –ø–µ—Ä–µ–¥–∞–≤–∞–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö:</strong> –Ø–≤–Ω–æ —É–∫–∞–∑—ã–≤–∞–µ—Ç, <em>–∫–∞–∫–∏–µ –ø–æ–ª—è</em> –±—É–¥—É—Ç –≤–∫–ª—é—á–µ–Ω—ã –≤ –æ—Ç–≤–µ—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, <code class="docutils literal notranslate"><span class="pre">id</span></code>, <code class="docutils literal notranslate"><span class="pre">username</span></code>, <code class="docutils literal notranslate"><span class="pre">email</span></code>), –∏ <em>–∫–∞–∫–∏–µ –∏—Å–∫–ª—é—á–µ–Ω—ã</em> (–Ω–∞–ø—Ä–∏–º–µ—Ä, <code class="docutils literal notranslate"><span class="pre">password_hash</span></code>, <code class="docutils literal notranslate"><span class="pre">is_admin</span></code>).</p></li>
<li><p><strong>–¢–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:</strong> –Ø—Å–Ω–æ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –æ—Ç–≤–µ—Ç–∞.</p></li>
<li><p><strong>–ü—Ä–æ—Å—Ç–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –∏–∑ ORM-–æ–±—ä–µ–∫—Ç–∞:</strong> –ë–ª–∞–≥–æ–¥–∞—Ä—è <code class="docutils literal notranslate"><span class="pre">from_attributes=True</span></code>, –æ–±—ä–µ–∫—Ç SQLAlchemy –º–æ–∂–Ω–æ –ª–µ–≥–∫–æ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –≤ Pydantic-–æ–±—ä–µ–∫—Ç: <code class="docutils literal notranslate"><span class="pre">UserResponse.from_orm(user_instance)</span></code>. –ó–∞—Ç–µ–º –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å —Å–ª–æ–≤–∞—Ä—å: <code class="docutils literal notranslate"><span class="pre">user_response.model_dump()</span></code>.</p></li>
</ul>
</section>
</section>
<section id="dao">
<h2>üèóÔ∏è DAO<a class="headerlink" href="#dao" title="–°—Å—ã–ª–∫–∞ –Ω–∞ —ç—Ç–æ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫">ÔÉÅ</a></h2>
<p>DAO (Data Access Object) ‚Äî —ç—Ç–æ <strong>–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω</strong>, –∫–æ—Ç–æ—Ä—ã–π <strong>–∞–±—Å—Ç—Ä–∞–≥–∏—Ä—É–µ—Ç</strong> —Ä–∞–±–æ—Ç—É —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö –æ—Ç <strong>–±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏</strong> –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.</p>
<p><strong>–¶–µ–ª—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è DAO-–ø–∞—Ç—Ç–µ—Ä–Ω–∞:</strong></p>
<ul class="simple">
<li><p><strong>–ò–∑–æ–ª–∏—Ä–æ–≤–∞—Ç—å</strong> –¥–µ—Ç–∞–ª–∏ –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º –æ—Ç –æ—Å–Ω–æ–≤–Ω–æ–π –ª–æ–≥–∏–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.</p></li>
<li><p><strong>–£–ø—Ä–æ—Å—Ç–∏—Ç—å</strong> –∏ <strong>—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞—Ç—å</strong> —Ä–∞–±–æ—Ç—É —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö.</p></li>
</ul>
<p><strong>–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è DAO-–ø–∞—Ç—Ç–µ—Ä–Ω–∞:</strong></p>
<ul class="simple">
<li><p><strong>–ß–∏—Å—Ç–æ—Ç–∞ –∫–æ–¥–∞:</strong> –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ <strong>–Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç SQL-–∑–∞–ø—Ä–æ—Å–æ–≤</strong> –∏–ª–∏ –¥–µ—Ç–∞–ª–µ–π –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –ë–î. –≠—Ç–æ –¥–µ–ª–∞–µ—Ç –∫–æ–¥ –ª–µ–≥—á–µ –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.</p></li>
<li><p><strong>–£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è:</strong> DAO –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç <strong>–æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å</strong> –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ä–∞–∑–Ω—ã–º–∏ ORM-–º–æ–¥–µ–ª—è–º–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, <code class="docutils literal notranslate"><span class="pre">UserDAO</span></code>, <code class="docutils literal notranslate"><span class="pre">PostDAO</span></code> –º–æ–≥—É—Ç –∏–º–µ—Ç—å –ø–æ—Ö–æ–∂–∏–µ –º–µ—Ç–æ–¥—ã <code class="docutils literal notranslate"><span class="pre">add</span></code>, <code class="docutils literal notranslate"><span class="pre">find_one_or_none_by_id</span></code>).</p></li>
<li><p><strong>–†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å:</strong> –õ–µ–≥–∫–æ <strong>–¥–æ–±–∞–≤–ª—è—Ç—å —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –º–µ—Ç–æ–¥—ã</strong> –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ DAO-–∫–ª–∞—Å—Å—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, <code class="docutils literal notranslate"><span class="pre">UserDAO.find_active_users_by_role(...)</span></code>).</p></li>
<li><p><strong>–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å:</strong> –£–ø—Ä–æ—â–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –¥—Ä—É–≥—É—é –ë–î –∏–ª–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è) –±–µ–∑ –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–Ω–∏—è –≤—Å–µ–π –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏.</p></li>
</ul>
<div class="warning admonition">
<p class="admonition-title">–í–∞–∂–Ω–æ</p>
<p><code class="docutils literal notranslate"><span class="pre">DAO</span></code> –ø–æ–¥—Ö–æ–¥–∏—Ç <strong>—Ç–æ–ª—å–∫–æ –¥–ª—è SQL-–±–∞–∑ –¥–∞–Ω–Ω—ã—Ö</strong>, —Å –∫–æ—Ç–æ—Ä—ã–º–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç SQLAlchemy.<br />
–î–ª—è Redis, –≤–µ–∫—Ç–æ—Ä–Ω—ã—Ö –ë–î –∏–ª–∏ –¥—Ä—É–≥–∏—Ö —Ö—Ä–∞–Ω–∏–ª–∏—â –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è <strong>–¥—Ä—É–≥–∏–µ –ø–æ–¥—Ö–æ–¥—ã</strong>.</p>
</div>
<section id="basedao">
<h3>–ö–ª–∞—Å—Å <code class="docutils literal notranslate"><span class="pre">BaseDAO</span></code><a class="headerlink" href="#basedao" title="–°—Å—ã–ª–∫–∞ –Ω–∞ —ç—Ç–æ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫">ÔÉÅ</a></h3>
<p>–ö–ª–∞—Å—Å <code class="docutils literal notranslate"><span class="pre">BaseDAO</span></code> ‚Äî —ç—Ç–æ <strong>–±–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å</strong>, –æ—Ç –∫–æ—Ç–æ—Ä–æ–≥–æ <strong>–Ω–∞—Å–ª–µ–¥—É—é—Ç—Å—è –≤—Å–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ DAO-–∫–ª–∞—Å—Å—ã</strong> (–Ω–∞–ø—Ä–∏–º–µ—Ä, <code class="docutils literal notranslate"><span class="pre">UserDAO</span></code>, <code class="docutils literal notranslate"><span class="pre">PostDAO</span></code>). –ï–≥–æ –æ—Å–Ω–æ–≤–Ω–∞—è —Ü–µ–ª—å ‚Äî <strong>–ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –æ–±—â–∏–µ, —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –º–µ—Ç–æ–¥—ã –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö</strong>, —Ç–∞–∫–∏–µ –∫–∞–∫ <strong>–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ</strong>, <strong>–ø–æ–ª—É—á–µ–Ω–∏–µ</strong>, <strong>–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ</strong> –∏ <strong>—É–¥–∞–ª–µ–Ω–∏–µ</strong> –∑–∞–ø–∏—Å–µ–π, –∏ —Ç–µ–º —Å–∞–º—ã–º <strong>–∏–∑–±–µ–∂–∞—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞</strong>.</p>
<p>–ö–æ–≥–¥–∞ –í—ã —Å–æ–∑–¥–∞—ë—Ç–µ –Ω–æ–≤—ã–π DAO (–Ω–∞–ø—Ä–∏–º–µ—Ä, <code class="docutils literal notranslate"><span class="pre">UserDAO</span></code>), –í—ã —É–∫–∞–∑—ã–≤–∞–µ—Ç–µ –µ–º—É, <em>—Å –∫–∞–∫–æ–π</em> ORM-–º–æ–¥–µ–ª—å—é –æ–Ω –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, <code class="docutils literal notranslate"><span class="pre">model</span> <span class="pre">=</span> <span class="pre">User</span></code>). –ó–∞—Ç–µ–º <code class="docutils literal notranslate"><span class="pre">BaseDAO</span></code> –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç—É –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–±—â–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, <code class="docutils literal notranslate"><span class="pre">add</span></code>, <code class="docutils literal notranslate"><span class="pre">find_one_or_none_by_id</span></code>), –Ω–µ –∑–Ω–∞—è <em>–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö</em> –ø–æ–ª–µ–π –º–æ–¥–µ–ª–∏ <code class="docutils literal notranslate"><span class="pre">User</span></code>.</p>
<p>```{admonition} –ò–¥–µ—è: –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ <code class="docutils literal notranslate"><span class="pre">BaseDAO</span></code></p>
<dl class="myst field-list simple">
<dt class="field-odd">class<span class="colon">:</span></dt>
<dd class="field-odd"><p>tip
–í –±—É–¥—É—â–µ–º –≤ <code class="docutils literal notranslate"><span class="pre">BaseDAO</span></code> –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å <strong>–¥—Ä—É–≥–∏–µ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã</strong>, —Ç–∞–∫–∏–µ –∫–∞–∫ <code class="docutils literal notranslate"><span class="pre">find_one_or_none_by_id</span></code>, <code class="docutils literal notranslate"><span class="pre">update_one_by_id</span></code>, <code class="docutils literal notranslate"><span class="pre">delete_one_by_id</span></code>, <code class="docutils literal notranslate"><span class="pre">find_all</span></code> –∏ —Ç.–¥., —á—Ç–æ–±—ã <strong>–º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å</strong> —Ä–∞–±–æ—Ç—É —Å —Ä–∞–∑–Ω—ã–º–∏ —Å—É—â–Ω–æ—Å—Ç—è–º–∏.</p>
</dd>
</dl>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
```{eval-rst}
.. toggle:: –ü–æ–∫–∞–∑–∞—Ç—å

   .. literalinclude:: ../src/databases/dao/base.py
      :language: python
      :caption: src/databases/dao/base.py
</pre></div>
</div>
</section>
<section id="userdao">
<h3>–ö–ª–∞—Å—Å <code class="docutils literal notranslate"><span class="pre">UserDAO</span></code><a class="headerlink" href="#userdao" title="–°—Å—ã–ª–∫–∞ –Ω–∞ —ç—Ç–æ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫">ÔÉÅ</a></h3>
<p>–ö–ª–∞—Å—Å <code class="docutils literal notranslate"><span class="pre">UserDAO</span></code> ‚Äî —ç—Ç–æ <strong>–∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è</strong> DAO-–ø–∞—Ç—Ç–µ—Ä–Ω–∞, –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω–∞—è –¥–ª—è <strong>–≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å ORM-–º–æ–¥–µ–ª—å—é <code class="docutils literal notranslate"><span class="pre">User</span></code></strong>. –û–Ω <strong>–Ω–∞—Å–ª–µ–¥—É–µ—Ç—Å—è</strong> –æ—Ç –±–∞–∑–æ–≤–æ–≥–æ –∫–ª–∞—Å—Å–∞ <code class="docutils literal notranslate"><span class="pre">BaseDAO</span></code>, —Ç–µ–º —Å–∞–º—ã–º <strong>–Ω–∞—Å–ª–µ–¥—É—è</strong> –æ–±—â–∏–µ –º–µ—Ç–æ–¥—ã –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π Create, Update, Delete (–º–µ—Ç–æ–¥—ã <code class="docutils literal notranslate"><span class="pre">add</span></code>, <code class="docutils literal notranslate"><span class="pre">add_many</span></code>, <code class="docutils literal notranslate"><span class="pre">update_one_by_id</span></code>, <code class="docutils literal notranslate"><span class="pre">update_many_by_filter</span></code>, <code class="docutils literal notranslate"><span class="pre">delete_one_by_id</span></code>, <code class="docutils literal notranslate"><span class="pre">delete_many_by_filter</span></code> –∏ —Ç.–¥., –µ—Å–ª–∏ –æ–Ω–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –≤ <code class="docutils literal notranslate"><span class="pre">BaseDAO</span></code>).</p>
<div class="toggle docutils container">
</div>
<div class="tip admonition">
<p class="admonition-title">–°–æ–≤–µ—Ç</p>
<p>–í—ã –º–æ–∂–µ—Ç–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –∏ –¥—Ä—É–≥–∏–µ –º–æ–¥–µ–ª–∏, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –Ω–∞—Å–ª–µ–¥–æ–≤–∞—Ç—å—Å—è –æ—Ç BaseDAO</p>
</div>
<p><strong>–û—Å–Ω–æ–≤–Ω—ã–µ —Ü–µ–ª–∏ <code class="docutils literal notranslate"><span class="pre">UserDAO</span></code>:</strong></p>
<ol class="arabic simple">
<li><p><strong>–ù–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –æ–±—â–∏—Ö –º–µ—Ç–æ–¥–æ–≤:</strong> –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤ –∏–∑ <code class="docutils literal notranslate"><span class="pre">BaseDAO</span></code> –¥–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, <code class="docutils literal notranslate"><span class="pre">UserDAO.add(...)</span></code>).</p></li>
<li><p><strong>–†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤:</strong> –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ <strong>—É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤</strong>, —Ö–∞—Ä–∞–∫—Ç–µ—Ä–Ω—ã—Ö –∏–º–µ–Ω–Ω–æ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, <code class="docutils literal notranslate"><span class="pre">get_all_users</span></code>, <code class="docutils literal notranslate"><span class="pre">find_active_users</span></code>, <code class="docutils literal notranslate"><span class="pre">add_user_with_profile</span></code>).</p></li>
<li><p><strong>–ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –¥–æ—Å—Ç—É–ø–∞:</strong> –í–µ—Å—å –∫–æ–¥, —Å–≤—è–∑–∞–Ω–Ω—ã–π —Å –ø–æ–ª—É—á–µ–Ω–∏–µ–º, —Å–æ–∑–¥–∞–Ω–∏–µ–º, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º –∏ —É–¥–∞–ª–µ–Ω–∏–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, —Å–æ—Å—Ä–µ–¥–æ—Ç–æ—á–µ–Ω –≤ –æ–¥–Ω–æ–º –∫–ª–∞—Å—Å–µ.</p></li>
</ol>
<section id="id11">
<h4>–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏<a class="headerlink" href="#id11" title="–°—Å—ã–ª–∫–∞ –Ω–∞ —ç—Ç–æ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫">ÔÉÅ</a></h4>
<p>–ü–µ—Ä–≤—ã–º –∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º —à–∞–≥–æ–º –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ª—é–±–æ–≥–æ DAO-–∫–ª–∞—Å—Å–∞ (–≤–∫–ª—é—á–∞—è <code class="docutils literal notranslate"><span class="pre">UserDAO</span></code>) —è–≤–ª—è–µ—Ç—Å—è —É–∫–∞–∑–∞–Ω–∏–µ <strong>ORM-–º–æ–¥–µ–ª–∏</strong>, —Å –∫–æ—Ç–æ—Ä–æ–π –æ–Ω –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å. –≠—Ç–æ –¥–µ–ª–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –∞—Ç—Ä–∏–±—É—Ç <code class="docutils literal notranslate"><span class="pre">model</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># src/databases/dao/user_dao.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.databases.dao.base</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseDAO</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.databases.sqlite.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">User</span> <span class="c1"># –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º ORM-–º–æ–¥–µ–ª—å</span>

<span class="k">class</span><span class="w"> </span><span class="nc">UserDAO</span><span class="p">(</span><span class="n">BaseDAO</span><span class="p">):</span>
    <span class="c1"># –£–∫–∞–∑—ã–≤–∞–µ–º, —Å –∫–∞–∫–æ–π –º–æ–¥–µ–ª—å—é —Ä–∞–±–æ—Ç–∞–µ—Ç —ç—Ç–æ—Ç DAO</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">User</span>
    <span class="c1"># –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ UserDAO –±—É–¥—É—Ç –ø—Ä–∏–º–µ–Ω—è—Ç—å—Å—è –∫ —Ç–∞–±–ª–∏—Ü–µ, —Å–≤—è–∑–∞–Ω–Ω–æ–π —Å –º–æ–¥–µ–ª—å—é User</span>
</pre></div>
</div>
</section>
<section id="id12">
<h4>–ù–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –æ—Ç <code class="docutils literal notranslate"><span class="pre">BaseDAO</span></code><a class="headerlink" href="#id12" title="–°—Å—ã–ª–∫–∞ –Ω–∞ —ç—Ç–æ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫">ÔÉÅ</a></h4>
<p>–ë–ª–∞–≥–æ–¥–∞—Ä—è –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏—é –æ—Ç <code class="docutils literal notranslate"><span class="pre">BaseDAO</span></code>, –∫–ª–∞—Å—Å <code class="docutils literal notranslate"><span class="pre">UserDAO</span></code> —Å—Ä–∞–∑—É –∂–µ –ø–æ–ª—É—á–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫ <strong>—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–º –º–µ—Ç–æ–¥–∞–º</strong>, –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–º –≤ –±–∞–∑–æ–≤–æ–º –∫–ª–∞—Å—Å–µ. –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –í—ã –º–æ–∂–µ—Ç–µ —Å—Ä–∞–∑—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å, –Ω–∞–ø—Ä–∏–º–µ—Ä, –º–µ—Ç–æ–¥ <code class="docutils literal notranslate"><span class="pre">add</span></code> –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –Ω–µ —Ä–µ–∞–ª–∏–∑—É—è –µ–≥–æ –∑–∞–Ω–æ–≤–æ.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–∞—Å–ª–µ–¥—É–µ–º–æ–≥–æ –º–µ—Ç–æ–¥–∞</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.databases.dao.user_dao</span><span class="w"> </span><span class="kn">import</span> <span class="n">UserDAO</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.databases.sqlite.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">connection</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.databases.sqlite.schemas</span><span class="w"> </span><span class="kn">import</span> <span class="n">UserCreateRequest</span> <span class="c1"># –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è, —á—Ç–æ —Å—Ö–µ–º–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞</span>

<span class="nd">@connection</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">create_new_user_handler</span><span class="p">(</span><span class="n">user_data</span><span class="p">:</span> <span class="n">UserCreateRequest</span><span class="p">,</span> <span class="n">session</span><span class="p">):</span>
    <span class="c1"># –í—ã–∑—ã–≤–∞–µ–º –º–µ—Ç–æ–¥ add –∏–∑ BaseDAO —á–µ—Ä–µ–∑ UserDAO</span>
    <span class="c1"># BaseDAO.add —Å–æ–∑–¥–∞—Å—Ç —ç–∫–∑–µ–º–ø–ª—è—Ä User, –¥–æ–±–∞–≤–∏—Ç –µ–≥–æ –≤ —Å–µ—Å—Å–∏—é –∏ –∑–∞—Ñ–∏–∫—Å–∏—Ä—É–µ—Ç</span>
    <span class="n">new_user</span> <span class="o">=</span> <span class="k">await</span> <span class="n">UserDAO</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="o">**</span><span class="n">user_data</span><span class="o">.</span><span class="n">model_dump</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">new_user</span><span class="o">.</span><span class="n">id</span>
</pre></div>
</div>
</section>
<section id="id13">
<h4>–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤<a class="headerlink" href="#id13" title="–°—Å—ã–ª–∫–∞ –Ω–∞ —ç—Ç–æ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫">ÔÉÅ</a></h4>
<p>–•–æ—Ç—è <code class="docutils literal notranslate"><span class="pre">BaseDAO</span></code> –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –æ–±—â–∏–µ –º–µ—Ç–æ–¥—ã, —á–∞—Å—Ç–æ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –≤ <strong>—É–Ω–∏–∫–∞–ª—å–Ω–æ–π –ª–æ–≥–∏–∫–µ</strong>, —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ–π –¥–ª—è —Å—É—â–Ω–æ—Å—Ç–∏ <code class="docutils literal notranslate"><span class="pre">User</span></code>. –ò–º–µ–Ω–Ω–æ –¥–ª—è —ç—Ç–æ–≥–æ —Å–æ–∑–¥–∞—é—Ç—Å—è <strong>—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –º–µ—Ç–æ–¥—ã</strong> –≤–Ω—É—Ç—Ä–∏ <code class="docutils literal notranslate"><span class="pre">UserDAO</span></code>.</p>
<p><strong>–ü—Ä–∏–º–µ—Ä 1: –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># src/databases/dao/user_dao.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">select</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.ext.asyncio</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncSession</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.databases.dao.base</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseDAO</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.databases.sqlite.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">User</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.databases.sqlite.schemas</span><span class="w"> </span><span class="kn">import</span> <span class="n">UserResponse</span> <span class="c1"># Pydantic-—Å—Ö–µ–º–∞ –¥–ª—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏</span>

<span class="k">class</span><span class="w"> </span><span class="nc">UserDAO</span><span class="p">(</span><span class="n">BaseDAO</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">User</span>

    <span class="nd">@classmethod</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_all_users</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">session</span><span class="p">:</span> <span class="n">AsyncSession</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">UserResponse</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, —Å–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ Pydantic-—Å—Ö–µ–º—É.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">query</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">model</span><span class="p">)</span> <span class="c1"># SELECT * FROM users;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="n">records</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">scalars</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span> <span class="c1"># –ò–∑–≤–ª–µ–∫–∞–µ–º –∫–∞–∫ –æ–±—ä–µ–∫—Ç—ã –º–æ–¥–µ–ª–∏ User</span>
        <span class="c1"># –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º ORM-–æ–±—ä–µ–∫—Ç—ã –≤ Pydantic-–æ–±—ä–µ–∫—Ç—ã –¥–ª—è –æ—Ç–≤–µ—Ç–∞</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">UserResponse</span><span class="o">.</span><span class="n">from_orm</span><span class="p">(</span><span class="n">record</span><span class="p">)</span> <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">records</span><span class="p">]</span>
</pre></div>
</div>
<p><strong>–ü—Ä–∏–º–µ—Ä 2: –°–ª–æ–∂–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –ø—Ä–æ—Ñ–∏–ª—è</strong></p>
<p>–ö–∞–∫ –æ–±—Å—É–∂–¥–∞–ª–æ—Å—å —Ä–∞–Ω–µ–µ, –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è —Å–æ–∑–¥–∞—Ç—å <em>—Å–≤—è–∑–∞–Ω–Ω—ã–µ</em> –∑–∞–ø–∏—Å–∏ –≤ —Ä–∞–∑–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö –≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏. –≠—Ç–æ –∏–¥–µ–∞–ª—å–Ω—ã–π –∫–∞–Ω–¥–∏–¥–∞—Ç –¥–ª—è —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ–≥–æ –º–µ—Ç–æ–¥–∞ –≤ <code class="docutils literal notranslate"><span class="pre">UserDAO</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># src/databases/dao/user_dao.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.ext.asyncio</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncSession</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.databases.dao.base</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseDAO</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.databases.sqlite.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">User</span><span class="p">,</span> <span class="n">Profile</span> <span class="c1"># –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è, —á—Ç–æ Profile –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.databases.sqlite.schemas</span><span class="w"> </span><span class="kn">import</span> <span class="n">UserCreateRequest</span> <span class="c1"># Pydantic-—Å—Ö–µ–º–∞ –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏</span>

<span class="k">class</span><span class="w"> </span><span class="nc">UserDAO</span><span class="p">(</span><span class="n">BaseDAO</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">User</span>

    <span class="nd">@classmethod</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">add_user_with_profile</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">session</span><span class="p">:</span> <span class="n">AsyncSession</span><span class="p">,</span> <span class="n">user_</span> <span class="n">UserCreateRequest</span><span class="p">,</span> <span class="n">profile_</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">User</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        –î–æ–±–∞–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –ø—Ä–∏–≤—è–∑–∞–Ω–Ω—ã–π –∫ –Ω–µ–º—É –ø—Ä–æ—Ñ–∏–ª—å –≤ –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.</span>

<span class="sd">        –ê—Ä–≥—É–º–µ–Ω—Ç—ã:</span>
<span class="sd">        - session: AsyncSession - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Å–µ—Å—Å–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö</span>
<span class="sd">        - user_data: UserCreateRequest - Pydantic-—Å—Ö–µ–º–∞ —Å –¥–∞–Ω–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</span>
<span class="sd">        - profile_data: dict - —Å–ª–æ–≤–∞—Ä—å —Å –¥–∞–Ω–Ω—ã–º–∏ –ø—Ä–æ—Ñ–∏–ª—è</span>

<span class="sd">        –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:</span>
<span class="sd">        - User - –æ–±—ä–µ–∫—Ç —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># 1. –°–æ–∑–¥–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –¥–∞–Ω–Ω—ã—Ö Pydantic-—Å—Ö–µ–º—ã (–¥–∞–Ω–Ω—ã–µ —É–∂–µ –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω—ã)</span>
        <span class="n">user</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">model</span><span class="p">(</span>
            <span class="n">username</span><span class="o">=</span><span class="n">user_data</span><span class="o">.</span><span class="n">username</span><span class="p">,</span>
            <span class="n">email</span><span class="o">=</span><span class="n">user_data</span><span class="o">.</span><span class="n">email</span><span class="p">,</span>
            <span class="c1"># password_hash = hash_password(user_data.password) # –û–±—ã—á–Ω–æ –ø–∞—Ä–æ–ª—å —Ö–µ—à–∏—Ä—É–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ</span>
        <span class="p">)</span>
        <span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
        <span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>  <span class="c1"># &lt;-- –í–ê–ñ–ù–û: –ø–æ–ª—É—á–∞–µ–º user.id, –Ω–µ —Ñ–∏–∫—Å–∏—Ä—É—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é</span>

        <span class="c1"># 2. –°–æ–∑–¥–∞–µ–º –ø—Ä–æ—Ñ–∏–ª—å, –∏—Å–ø–æ–ª—å–∑—É—è ID —Ç–æ–ª—å–∫–æ —á—Ç–æ —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</span>
        <span class="n">profile</span> <span class="o">=</span> <span class="n">Profile</span><span class="p">(</span>
            <span class="n">user_id</span><span class="o">=</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="c1"># &lt;-- –ó–¥–µ—Å—å –Ω—É–∂–µ–Ω ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</span>
            <span class="n">bio</span><span class="o">=</span><span class="n">profile_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;bio&#39;</span><span class="p">),</span>
            <span class="c1"># ... –¥—Ä—É–≥–∏–µ –ø–æ–ª—è –ø—Ä–æ—Ñ–∏–ª—è</span>
        <span class="p">)</span>
        <span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">profile</span><span class="p">)</span>

        <span class="c1"># 3. –û–¥–∏–Ω –∫–æ–º–º–∏—Ç –¥–ª—è –æ–±–µ–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π</span>
        <span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

        <span class="c1"># 4. –û–±–Ω–æ–≤–ª—è–µ–º –æ–±—ä–µ–∫—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å —Å–æ–∑–¥–∞–Ω–Ω—ã–µ –¥–∞—Ç—ã)</span>
        <span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">refresh</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">user</span>  <span class="c1"># –í–æ–∑–≤—Ä–∞—â–∞–µ–º –æ–±—ä–µ–∫—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="crud">
<h2>üß± CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏<a class="headerlink" href="#crud" title="–°—Å—ã–ª–∫–∞ –Ω–∞ —ç—Ç–æ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫">ÔÉÅ</a></h2>
<p>CRUD ‚Äî —ç—Ç–æ –∞–±–±—Ä–µ–≤–∏–∞—Ç—É—Ä–∞, –æ–±–æ–∑–Ω–∞—á–∞—é—â–∞—è <strong>—á–µ—Ç—ã—Ä–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏</strong> –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –¥–∞–Ω–Ω—ã–º–∏: <strong>Create (–°–æ–∑–¥–∞–Ω–∏–µ), Read (–ß—Ç–µ–Ω–∏–µ), Update (–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ), Delete (–£–¥–∞–ª–µ–Ω–∏–µ)</strong>. SQLAlchemy –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –º–æ—â–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —ç—Ç–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π. –í —à–∞–±–ª–æ–Ω–µ –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è <strong>–ø–∞—Ç—Ç–µ—Ä–Ω DAO</strong>, –∫–æ—Ç–æ—Ä—ã–π <strong>—Å–∫—Ä—ã–≤–∞–µ—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç—å</strong> SQL-–∑–∞–ø—Ä–æ—Å–æ–≤ –∏ <strong>—É–ø—Ä–æ—â–∞–µ—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ</strong> —Å ORM-–º–æ–¥–µ–ª—è–º–∏.</p>
<p>–í —ç—Ç–æ–º —Ä–∞–∑–¥–µ–ª–µ –ø–æ–¥—Ä–æ–±–Ω–æ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω—ã –≤—Å–µ CRUD-–æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º SQLAlchemy –∏ DAO-–∫–ª–∞—Å—Å–æ–≤, –≤–∫–ª—é—á–∞—è —Ä–∞–±–æ—Ç—É —Å Pydantic-—Å—Ö–µ–º–∞–º–∏ –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö.</p>
<section id="create">
<h3>üßÆ –°–æ–∑–¥–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (Create)<a class="headerlink" href="#create" title="–°—Å—ã–ª–∫–∞ –Ω–∞ —ç—Ç–æ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫">ÔÉÅ</a></h3>
<p>–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –∑–∞–ø–∏—Å–µ–π –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ ORM-–º–æ–¥–µ–ª–µ–π. SQLAlchemy –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –¥–ª—è —ç—Ç–æ–≥–æ –º–µ—Ç–æ–¥—ã —Å–µ—Å—Å–∏–∏ <code class="docutils literal notranslate"><span class="pre">session.add()</span></code> –∏ <code class="docutils literal notranslate"><span class="pre">session.add_all()</span></code>. –í —à–∞–±–ª–æ–Ω–µ —ç—Ç–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏–Ω–∫–∞–ø—Å—É–ª–∏—Ä–æ–≤–∞–Ω—ã –≤ –º–µ—Ç–æ–¥–∞—Ö <code class="docutils literal notranslate"><span class="pre">BaseDAO</span></code>.</p>
<p>–î–ª—è <strong>–≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤—Ö–æ–¥—è—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö</strong> –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å <strong>Pydantic-—Å—Ö–µ–º—ã</strong> (–Ω–∞–ø—Ä–∏–º–µ—Ä, <code class="docutils literal notranslate"><span class="pre">UserCreateRequest</span></code>).</p>
<section id="id14">
<h4>–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–¥–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞<a class="headerlink" href="#id14" title="–°—Å—ã–ª–∫–∞ –Ω–∞ —ç—Ç–æ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫">ÔÉÅ</a></h4>
<p>–î–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è <strong>–æ–¥–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞</strong> —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥ <code class="docutils literal notranslate"><span class="pre">add()</span></code> –∏–∑ <code class="docutils literal notranslate"><span class="pre">BaseDAO</span></code> –∏–ª–∏ –µ–≥–æ –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, <code class="docutils literal notranslate"><span class="pre">UserDAO</span></code>), <strong>–ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ –≤–∞–ª–∏–¥–∏—Ä—É—è –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ Pydantic-—Å—Ö–µ–º—É</strong>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">src.databases.dao.user_dao</span><span class="w"> </span><span class="kn">import</span> <span class="n">UserDAO</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.databases.sqlite.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">connection</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.databases.sqlite.schemas</span><span class="w"> </span><span class="kn">import</span> <span class="n">UserCreateRequest</span> <span class="c1"># –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Å—Ö–µ–º—É –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏</span>

<span class="nd">@connection</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">create_user_endpoint</span><span class="p">(</span><span class="n">user_data</span><span class="p">:</span> <span class="n">UserCreateRequest</span><span class="p">,</span> <span class="n">session</span><span class="p">):</span> <span class="c1"># –ü—Ä–∏–Ω–∏–º–∞–µ–º Pydantic-—Å—Ö–µ–º—É</span>
    <span class="c1"># Pydantic —É–∂–µ –ø—Ä–æ–≤–µ—Ä–∏–ª —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö</span>
    <span class="c1"># –ú–æ–∂–µ–º –±—ã—Ç—å —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ user_data.username, user_data.email –∏ —Ç.–¥. —Å—É—â–µ—Å—Ç–≤—É—é—Ç –∏ –≤–∞–ª–∏–¥–Ω—ã</span>
    <span class="n">user</span> <span class="o">=</span> <span class="k">await</span> <span class="n">UserDAO</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="n">user_data</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="n">email</span><span class="o">=</span><span class="n">user_data</span><span class="o">.</span><span class="n">email</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">user</span><span class="o">.</span><span class="n">id</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">BaseDAO.add()</span></code> —Å–æ–∑–¥–∞—ë—Ç —ç–∫–∑–µ–º–ø–ª—è—Ä –º–æ–¥–µ–ª–∏, –¥–æ–±–∞–≤–ª—è–µ—Ç –µ–≥–æ –≤ —Å–µ—Å—Å–∏—é, —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–æ–∑–¥–∞–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç.</p>
</section>
<section id="id15">
<h4>–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤<a class="headerlink" href="#id15" title="–°—Å—ã–ª–∫–∞ –Ω–∞ —ç—Ç–æ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫">ÔÉÅ</a></h4>
<p>–î–ª—è <strong>–º–∞—Å—Å–æ–≤–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è</strong> –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∑–∞–ø–∏—Å–µ–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–µ—Ç–æ–¥ <code class="docutils literal notranslate"><span class="pre">add_many()</span></code> –∏–∑ <code class="docutils literal notranslate"><span class="pre">BaseDAO</span></code>. –ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ Pydantic-—Å—Ö–µ–º, –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ —Ç–∞–∫–∂–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω—ã, –Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ –≤–∏–¥–µ —Å–ø–∏—Å–∫–∞ Pydantic-–æ–±—ä–µ–∫—Ç–æ–≤ –∏–ª–∏ –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–ª–æ–≤–∞—Ä–µ–π.</p>
<p><strong>–í–∞—Ä–∏–∞–Ω—Ç 1: –°–ø–∏—Å–æ–∫ –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–ª–æ–≤–∞—Ä–µ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ—Å–ª–µ <code class="docutils literal notranslate"><span class="pre">.model_dump()</span></code> –æ—Ç Pydantic-—Å—Ö–µ–º)</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">src.databases.dao.user_dao</span><span class="w"> </span><span class="kn">import</span> <span class="n">UserDAO</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.databases.sqlite.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">connection</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.databases.sqlite.schemas</span><span class="w"> </span><span class="kn">import</span> <span class="n">UserCreateRequest</span> <span class="c1"># –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Å—Ö–µ–º—É –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏</span>

<span class="nd">@connection</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">create_many_users_endpoint</span><span class="p">(</span><span class="n">users_data</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">UserCreateRequest</span><span class="p">],</span> <span class="n">session</span><span class="p">):</span> <span class="c1"># –ü—Ä–∏–Ω–∏–º–∞–µ–º —Å–ø–∏—Å–æ–∫ —Å—Ö–µ–º</span>
    <span class="c1"># –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º —Å–ø–∏—Å–æ–∫ Pydantic-—Å—Ö–µ–º –≤ —Å–ø–∏—Å–æ–∫ —Å–ª–æ–≤–∞—Ä–µ–π –¥–ª—è BaseDAO.add_many</span>
    <span class="n">users_dicts</span> <span class="o">=</span> <span class="p">[</span><span class="n">user_schema</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span> <span class="k">for</span> <span class="n">user_schema</span> <span class="ow">in</span> <span class="n">users_data</span><span class="p">]</span>
    <span class="n">users</span> <span class="o">=</span> <span class="k">await</span> <span class="n">UserDAO</span><span class="o">.</span><span class="n">add_many</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">users_dicts</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">u</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">users</span><span class="p">]</span>
</pre></div>
</div>
<p><strong>–í–∞—Ä–∏–∞–Ω—Ç 2: –ü—Ä—è–º–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è —Å–ø–∏—Å–∫–∞ —Å–ª–æ–≤–∞—Ä–µ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ FastAPI)</strong></p>
<p>–ï—Å–ª–∏ –≤—ã –ø–æ–ª—É—á–∞–µ—Ç–µ —Å–ø–∏—Å–æ–∫ —Å–ª–æ–≤–∞—Ä–µ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, <code class="docutils literal notranslate"><span class="pre">list[dict]</span></code>) –∏ —Ö–æ—Ç–∏—Ç–µ –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∂–¥—ã–π —Å–ª–æ–≤–∞—Ä—å, –≤—ã –º–æ–∂–µ—Ç–µ —ç—Ç–æ —Å–¥–µ–ª–∞—Ç—å –ø–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–æ–º <code class="docutils literal notranslate"><span class="pre">add_many</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">src.databases.dao.user_dao</span><span class="w"> </span><span class="kn">import</span> <span class="n">UserDAO</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.databases.sqlite.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">connection</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.databases.sqlite.schemas</span><span class="w"> </span><span class="kn">import</span> <span class="n">UserCreateRequest</span> <span class="c1"># –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Å—Ö–µ–º—É –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏</span>

<span class="nd">@connection</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">create_many_users_endpoint_raw</span><span class="p">(</span><span class="n">users_raw_data</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="n">session</span><span class="p">):</span> <span class="c1"># –ü—Ä–∏–Ω–∏–º–∞–µ–º —Å–ø–∏—Å–æ–∫ —Å–ª–æ–≤–∞—Ä–µ–π</span>
    <span class="c1"># –í–∞–ª–∏–¥–∏—Ä—É–µ–º –∫–∞–∂–¥—ã–π —Å–ª–æ–≤–∞—Ä—å —á–µ—Ä–µ–∑ Pydantic</span>
    <span class="n">validated_users_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">UserCreateRequest</span><span class="p">(</span><span class="o">**</span><span class="n">user_dict</span><span class="p">)</span> <span class="k">for</span> <span class="n">user_dict</span> <span class="ow">in</span> <span class="n">users_raw_data</span><span class="p">]</span>
    <span class="c1"># –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ —Å–ª–æ–≤–∞—Ä–∏ –¥–ª—è BaseDAO</span>
    <span class="n">users_dicts</span> <span class="o">=</span> <span class="p">[</span><span class="n">user_schema</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span> <span class="k">for</span> <span class="n">user_schema</span> <span class="ow">in</span> <span class="n">validated_users_data</span><span class="p">]</span>
    <span class="n">users</span> <span class="o">=</span> <span class="k">await</span> <span class="n">UserDAO</span><span class="o">.</span><span class="n">add_many</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">users_dicts</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">u</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">users</span><span class="p">]</span>
</pre></div>
</div>
<p>–ú–µ—Ç–æ–¥ <code class="docutils literal notranslate"><span class="pre">add_many()</span></code> –∏–∑ <code class="docutils literal notranslate"><span class="pre">BaseDAO</span></code> –≤ –æ–±–æ–∏—Ö —Å–ª—É—á–∞—è—Ö –ø—Ä–∏–Ω–∏–º–∞–µ—Ç <strong>—Å–ø–∏—Å–æ–∫ —Å–ª–æ–≤–∞—Ä–µ–π</strong>, –≥–¥–µ –∫–∞–∂–¥—ã–π —Å–ª–æ–≤–∞—Ä—å —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –æ–¥–Ω–æ–≥–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ –º–æ–¥–µ–ª–∏.</p>
</section>
<section id="id16">
<h4>–°–ª–æ–∂–Ω—ã–µ —Å–ª—É—á–∞–∏: –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–∞–±–ª–∏—Ü<a class="headerlink" href="#id16" title="–°—Å—ã–ª–∫–∞ –Ω–∞ —ç—Ç–æ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫">ÔÉÅ</a></h4>
<p>–í —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö —á–∞—Å—Ç–æ –±—ã–≤–∞–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ <strong>—Å–æ–∑–¥–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π</strong> –≤ —Ä–∞–∑–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö –∑–∞ <strong>–æ–¥–Ω—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é</strong>. –î–ª—è —Ç–∞–∫–∏—Ö —Å–ª—É—á–∞–µ–≤ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Å–æ–∑–¥–∞–≤–∞—Ç—å <strong>—Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã</strong> –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö DAO-–∫–ª–∞—Å—Å–∞—Ö.</p>
<p>–ù–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è —Å–æ–∑–¥–∞—Ç—å <strong>–∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü–µ <code class="docutils literal notranslate"><span class="pre">users</span></code></strong> –∏ <strong>—Å–≤—è–∑–∞–Ω–Ω—É—é –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü–µ <code class="docutils literal notranslate"><span class="pre">profiles</span></code></strong>. –≠—Ç–æ –º–æ–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤ –∫–ª–∞—Å—Å–µ <code class="docutils literal notranslate"><span class="pre">UserDAO</span></code> —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># src/databases/dao/user_dao.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.ext.asyncio</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncSession</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.databases.dao.base</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseDAO</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.databases.sqlite.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">User</span><span class="p">,</span> <span class="n">Profile</span> <span class="c1"># –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è, —á—Ç–æ Profile —Ç–∞–∫–∂–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.databases.sqlite.schemas</span><span class="w"> </span><span class="kn">import</span> <span class="n">UserCreateRequest</span> <span class="c1"># –ò—Å–ø–æ–ª—å–∑—É–µ–º Pydantic-—Å—Ö–µ–º—É –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏</span>

<span class="k">class</span><span class="w"> </span><span class="nc">UserDAO</span><span class="p">(</span><span class="n">BaseDAO</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">User</span>

    <span class="nd">@classmethod</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">add_user_with_profile</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">session</span><span class="p">:</span> <span class="n">AsyncSession</span><span class="p">,</span> <span class="n">user_data</span><span class="p">:</span> <span class="n">UserCreateRequest</span><span class="p">,</span> <span class="n">profile_data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">User</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        –î–æ–±–∞–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –ø—Ä–∏–≤—è–∑–∞–Ω–Ω—ã–π –∫ –Ω–µ–º—É –ø—Ä–æ—Ñ–∏–ª—å –≤ –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.</span>

<span class="sd">        –ê—Ä–≥—É–º–µ–Ω—Ç—ã:</span>
<span class="sd">        - session: AsyncSession - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Å–µ—Å—Å–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö</span>
<span class="sd">        - user_data: UserCreateRequest - Pydantic-—Å—Ö–µ–º–∞ —Å –¥–∞–Ω–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</span>
<span class="sd">        - profile_data: dict - —Å–ª–æ–≤–∞—Ä—å —Å –¥–∞–Ω–Ω—ã–º–∏ –ø—Ä–æ—Ñ–∏–ª—è</span>

<span class="sd">        –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:</span>
<span class="sd">        - User - –æ–±—ä–µ–∫—Ç —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># 1. –°–æ–∑–¥–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –¥–∞–Ω–Ω—ã—Ö Pydantic-—Å—Ö–µ–º—ã (–¥–∞–Ω–Ω—ã–µ —É–∂–µ –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω—ã)</span>
        <span class="n">user</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">model</span><span class="p">(</span>
            <span class="n">username</span><span class="o">=</span><span class="n">user_data</span><span class="o">.</span><span class="n">username</span><span class="p">,</span>
            <span class="n">email</span><span class="o">=</span><span class="n">user_data</span><span class="o">.</span><span class="n">email</span><span class="p">,</span>
            <span class="c1"># password_hash = hash_password(user_data.password) # –û–±—ã—á–Ω–æ –ø–∞—Ä–æ–ª—å —Ö–µ—à–∏—Ä—É–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ</span>
        <span class="p">)</span>
        <span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
        <span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>  <span class="c1"># &lt;-- –í–ê–ñ–ù–û: –ø–æ–ª—É—á–∞–µ–º user.id, –Ω–µ —Ñ–∏–∫—Å–∏—Ä—É—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é</span>

        <span class="c1"># 2. –°–æ–∑–¥–∞–µ–º –ø—Ä–æ—Ñ–∏–ª—å, –∏—Å–ø–æ–ª—å–∑—É—è ID —Ç–æ–ª—å–∫–æ —á—Ç–æ —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</span>
        <span class="n">profile</span> <span class="o">=</span> <span class="n">Profile</span><span class="p">(</span>
            <span class="n">user_id</span><span class="o">=</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="c1"># &lt;-- –ó–¥–µ—Å—å –Ω—É–∂–µ–Ω ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</span>
            <span class="n">bio</span><span class="o">=</span><span class="n">profile_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;bio&#39;</span><span class="p">),</span>
            <span class="c1"># ... –¥—Ä—É–≥–∏–µ –ø–æ–ª—è –ø—Ä–æ—Ñ–∏–ª—è</span>
        <span class="p">)</span>
        <span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">profile</span><span class="p">)</span>

        <span class="c1"># 3. –û–¥–∏–Ω –∫–æ–º–º–∏—Ç –¥–ª—è –æ–±–µ–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π</span>
        <span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

        <span class="c1"># 4. –û–±–Ω–æ–≤–ª—è–µ–º –æ–±—ä–µ–∫—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å —Å–æ–∑–¥–∞–Ω–Ω—ã–µ –¥–∞—Ç—ã)</span>
        <span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">refresh</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">user</span>  <span class="c1"># –í–æ–∑–≤—Ä–∞—â–∞–µ–º –æ–±—ä–µ–∫—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</span>
</pre></div>
</div>
<div class="tip admonition">
<p class="admonition-title">–°–æ–≤–µ—Ç: –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏</p>
<p>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Pydantic-—Å—Ö–µ–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, <code class="docutils literal notranslate"><span class="pre">UserCreateRequest</span></code>) –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤—Ö–æ–¥—è—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –¥–µ–ª–∞–µ—Ç –∫–æ–¥ –±–æ–ª–µ–µ –±–µ–∑–æ–ø–∞—Å–Ω—ã–º –∏ –Ω–∞–¥—ë–∂–Ω—ã–º.</p>
</div>
<p>–•–æ—Ä–æ—à–æ, –≤–æ—Ç —É–ª—É—á—à–µ–Ω–Ω—ã–π —Ä–∞–∑–¥–µ–ª ‚Äú–ß—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö‚Äù, –≥–¥–µ —Å–Ω–∞—á–∞–ª–∞ —Å—Ä–∞–≤–Ω–∏–≤–∞—é—Ç—Å—è <code class="docutils literal notranslate"><span class="pre">select</span></code> –∏ <code class="docutils literal notranslate"><span class="pre">get</span></code>, –¥–µ–ª–∞–µ—Ç—Å—è —É–ø–æ—Ä –Ω–∞ <code class="docutils literal notranslate"><span class="pre">get</span></code> –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ–¥–Ω–æ–π –∑–∞–ø–∏—Å–∏ –ø–æ ID, –∏ –ø—Ä–∏–º–µ—Ä—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã —Å —É—á—ë—Ç–æ–º –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç–∏ <code class="docutils literal notranslate"><span class="pre">get</span></code> –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è <code class="docutils literal notranslate"><span class="pre">Pydantic</span></code>-—Å—Ö–µ–º.</p>
</section>
</section>
<hr class="docutils" />
<section id="read">
<h3>üìñ –ß—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (Read)<a class="headerlink" href="#read" title="–°—Å—ã–ª–∫–∞ –Ω–∞ —ç—Ç–æ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫">ÔÉÅ</a></h3>
<p>–ß—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –≤ SQLAlchemy –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è —Å –ø–æ–º–æ—â—å—é —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤. –î–≤–∞ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Å–ø–æ—Å–æ–±–∞ –ø–æ–ª—É—á–µ–Ω–∏—è <strong>–æ–¥–Ω–æ–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∑–∞–ø–∏—Å–∏</strong> –ø–æ –µ—ë <strong>–ø–µ—Ä–≤–∏—á–Ω–æ–º—É –∫–ª—é—á—É (–æ–±—ã—á–Ω–æ <code class="docutils literal notranslate"><span class="pre">id</span></code>)</strong> ‚Äî —ç—Ç–æ <code class="docutils literal notranslate"><span class="pre">select()</span></code> –∏ <code class="docutils literal notranslate"><span class="pre">session.get()</span></code>. –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è <strong>–Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∑–∞–ø–∏—Å–µ–π</strong> –∏–ª–∏ <strong>–∑–∞–ø–∏—Å–µ–π –ø–æ –¥—Ä—É–≥–∏–º –∫—Ä–∏—Ç–µ—Ä–∏—è–º</strong> –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è <code class="docutils literal notranslate"><span class="pre">select()</span></code>.</p>
<section id="session-get-vs-select-id">
<h4><code class="docutils literal notranslate"><span class="pre">session.get()</span></code> vs <code class="docutils literal notranslate"><span class="pre">select()</span></code> –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ–¥–Ω–æ–π –∑–∞–ø–∏—Å–∏ –ø–æ ID<a class="headerlink" href="#session-get-vs-select-id" title="–°—Å—ã–ª–∫–∞ –Ω–∞ —ç—Ç–æ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫">ÔÉÅ</a></h4>
<p>–ö–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å <strong>–æ–¥–Ω—É –∑–∞–ø–∏—Å—å –ø–æ –µ—ë —É–Ω–∏–∫–∞–ª—å–Ω–æ–º—É –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—É (ID)</strong>, <strong><code class="docutils literal notranslate"><span class="pre">session.get()</span></code></strong> ‚Äî —ç—Ç–æ <strong>–ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω—ã–π –∏ –±–æ–ª–µ–µ —É–¥–æ–±–Ω—ã–π</strong> —Å–ø–æ—Å–æ–± –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å <code class="docutils literal notranslate"><span class="pre">select()</span></code>.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head text-left"><p>–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞</p></th>
<th class="head text-left"><p><code class="docutils literal notranslate"><span class="pre">session.get()</span></code></p></th>
<th class="head text-left"><p><code class="docutils literal notranslate"><span class="pre">select()</span></code> (—Å —Ñ–∏–ª—å—Ç—Ä–æ–º –ø–æ ID)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p><strong>–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ</strong></p></td>
<td class="text-left"><p>–ü–æ–ª—É—á–∏—Ç—å –æ–¥–∏–Ω –æ–±—ä–µ–∫—Ç –ø–æ –ø–µ—Ä–≤–∏—á–Ω–æ–º—É –∫–ª—é—á—É.</p></td>
<td class="text-left"><p>–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —Å–ø–æ—Å–æ–± —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è <code class="docutils literal notranslate"><span class="pre">SELECT</span></code> –∑–∞–ø—Ä–æ—Å–æ–≤.</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><strong>–£–¥–æ–±—Å—Ç–≤–æ</strong></p></td>
<td class="text-left"><p><strong>–ü—Ä–æ—â–µ –∏ –∫–æ—Ä–æ—á–µ</strong>. –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –º–æ–¥–µ–ª—å –∏ –∑–Ω–∞—á–µ–Ω–∏–µ <code class="docutils literal notranslate"><span class="pre">id</span></code>.</p></td>
<td class="text-left"><p>–¢—Ä–µ–±—É–µ—Ç —Å–æ–∑–¥–∞–Ω–∏—è <code class="docutils literal notranslate"><span class="pre">select()</span></code> –∑–∞–ø—Ä–æ—Å–∞, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, <code class="docutils literal notranslate"><span class="pre">.filter_by(id=id_value)</span></code>) –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (<code class="docutils literal notranslate"><span class="pre">.scalar_one_or_none()</span></code>).</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><strong>–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</strong></p></td>
<td class="text-left"><p><strong>–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ</strong>. SQLAlchemy –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –∫—ç—à —Å–µ—Å—Å–∏–∏.</p></td>
<td class="text-left"><p>–°–æ–∑–¥–∞—ë—Ç SQL-–∑–∞–ø—Ä–æ—Å (<code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">...</span> <span class="pre">WHERE</span> <span class="pre">id</span> <span class="pre">=</span> <span class="pre">?</span></code>) –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ –ë–î.</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><strong>–ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å</strong></p></td>
<td class="text-left"><p><strong>–ù–∞–¥—ë–∂–Ω–µ–µ</strong>. –ù–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –Ω–∞–∑–≤–∞–Ω–∏—è –∫–æ–ª–æ–Ω–∫–∏ –ø–µ—Ä–≤–∏—á–Ω–æ–≥–æ –∫–ª—é—á–∞. SQLAlchemy –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –µ—ë –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.</p></td>
<td class="text-left"><p>–ó–∞–≤–∏—Å–∏—Ç –æ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —É–∫–∞–∑–∞–Ω–∏—è –∫–æ–ª–æ–Ω–∫–∏ –≤ <code class="docutils literal notranslate"><span class="pre">filter_by()</span></code> –∏–ª–∏ <code class="docutils literal notranslate"><span class="pre">where()</span></code>.</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><strong>–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å</strong></p></td>
<td class="text-left"><p>–°—Ç–∞–ª–∞ <strong>–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π</strong> –≤ SQLAlchemy 2.0+ (<code class="docutils literal notranslate"><span class="pre">await</span> <span class="pre">session.get(...)</span></code>).</p></td>
<td class="text-left"><p>–í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞—Å—å —Å <code class="docutils literal notranslate"><span class="pre">await</span> <span class="pre">session.execute(...)</span></code> –≤ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–º —Ä–µ–∂–∏–º–µ.</p></td>
</tr>
</tbody>
</table>
<p>–ú–µ—Ç–æ–¥ <code class="docutils literal notranslate"><span class="pre">select()</span></code> –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è <strong>–≤—Å–µ—Ö –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤</strong> –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö: –ø–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –∑–∞–ø–∏—Å–µ–π, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –¥—Ä—É–≥–∏–º –ø–æ–ª—è–º, –≤—ã–±–æ—Ä–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –∫–æ–ª–æ–Ω–æ–∫, —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞, —Ä–∞–±–æ—Ç–∞ —Å –æ—Ç–Ω–æ—à–µ–Ω–∏—è–º–∏ –∏ —Ç.–¥.</p>
<p>–û–Ω –ø–æ–∑–≤–æ–ª—è–µ—Ç:</p>
<ul class="simple">
<li><p>–í—ã–±–∏—Ä–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ –æ–¥–Ω–æ–π –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ç–∞–±–ª–∏—Ü</p></li>
<li><p>–£–∫–∞–∑—ã–≤–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è</p></li>
<li><p>–ü—Ä–∏–º–µ–Ω—è—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã (<code class="docutils literal notranslate"><span class="pre">where</span></code>, <code class="docutils literal notranslate"><span class="pre">filter_by</span></code>), —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ (<code class="docutils literal notranslate"><span class="pre">order_by</span></code>), –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ (<code class="docutils literal notranslate"><span class="pre">group_by</span></code>)</p></li>
<li><p>–û–±—ä–µ–¥–∏–Ω—è—Ç—å –¥–∞–Ω–Ω—ã–µ —Å –ø–æ–º–æ—â—å—é <code class="docutils literal notranslate"><span class="pre">JOIN</span></code></p></li>
<li><p>–†–∞–±–æ—Ç–∞—Ç—å —Å –∞–≥—Ä–µ–≥–∞—Ç–Ω—ã–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏</p></li>
</ul>
</section>
<section id="id-session-get">
<h4>–ü–æ–ª—É—á–µ–Ω–∏–µ –æ–¥–Ω–æ–π –∑–∞–ø–∏—Å–∏ –ø–æ ID (—Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º <code class="docutils literal notranslate"><span class="pre">session.get()</span></code>)<a class="headerlink" href="#id-session-get" title="–°—Å—ã–ª–∫–∞ –Ω–∞ —ç—Ç–æ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫">ÔÉÅ</a></h4>
<p>–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ–¥–Ω–æ–π –∑–∞–ø–∏—Å–∏ –ø–æ –µ—ë –ø–µ—Ä–≤–∏—á–Ω–æ–º—É –∫–ª—é—á—É (<code class="docutils literal notranslate"><span class="pre">id</span></code>) —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å <code class="docutils literal notranslate"><span class="pre">session.get()</span></code>, —Ç–∞–∫ –∫–∞–∫ —ç—Ç–æ –ø—Ä–æ—â–µ, —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ –∏ –Ω–∞–¥—ë–∂–Ω–µ–µ. –≠—Ç–æ—Ç –º–µ—Ç–æ–¥ –º–æ–∂–Ω–æ –∏–Ω–∫–∞–ø—Å—É–ª–∏—Ä–æ–≤–∞—Ç—å –≤ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –º–µ—Ç–æ–¥ <code class="docutils literal notranslate"><span class="pre">BaseDAO</span></code>.</p>
<p><strong>–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤ <code class="docutils literal notranslate"><span class="pre">BaseDAO</span></code>:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># src/databases/dao/base.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.ext.asyncio</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncSession</span>

<span class="k">class</span><span class="w"> </span><span class="nc">BaseDAO</span><span class="p">:</span>
    <span class="n">model</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># ... (—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥)</span>

    <span class="nd">@classmethod</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">find_one_or_none_by_id</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">session</span><span class="p">:</span> <span class="n">AsyncSession</span><span class="p">,</span> <span class="n">data_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–¥–Ω—É –∑–∞–ø–∏—Å—å –ø–æ –µ—ë ID –∏–ª–∏ None, –µ—Å–ª–∏ –∑–∞–ø–∏—Å—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞.</span>
<span class="sd">        –ò—Å–ø–æ–ª—å–∑—É–µ—Ç session.get() –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ –ø–µ—Ä–≤–∏—á–Ω–æ–º—É –∫–ª—é—á—É.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">data_id</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å Pydantic-—Å—Ö–µ–º–æ–π –¥–ª—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">src.databases.dao.user_dao</span><span class="w"> </span><span class="kn">import</span> <span class="n">UserDAO</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.databases.sqlite.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">connection</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.databases.sqlite.schemas</span><span class="w"> </span><span class="kn">import</span> <span class="n">UserResponse</span> <span class="c1"># –ò—Å–ø–æ–ª—å–∑—É–µ–º Pydantic-—Å—Ö–µ–º—É –¥–ª—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏</span>

<span class="nd">@connection</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_user_by_id_endpoint</span><span class="p">(</span><span class="n">user_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">session</span><span class="p">:</span> <span class="n">AsyncSession</span><span class="p">):</span>
    <span class="n">user</span> <span class="o">=</span> <span class="k">await</span> <span class="n">UserDAO</span><span class="o">.</span><span class="n">find_one_or_none_by_id</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">user</span><span class="p">:</span>
        <span class="c1"># –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º ORM-–æ–±—ä–µ–∫—Ç –≤ Pydantic-—Å—Ö–µ–º—É –¥–ª—è –æ—Ç–≤–µ—Ç–∞</span>
        <span class="k">return</span> <span class="n">UserResponse</span><span class="o">.</span><span class="n">from_orm</span><span class="p">(</span><span class="n">user</span><span class="p">)</span> <span class="c1"># Pydantic —Å–∞–º &quot;–≤—ã—Ç–∞—â–∏—Ç&quot; –Ω—É–∂–Ω—ã–µ –∞—Ç—Ä–∏–±—É—Ç—ã</span>
    <span class="k">return</span> <span class="kc">None</span> <span class="c1"># –∏–ª–∏ HTTP 404</span>
</pre></div>
</div>
</section>
<section id="id17">
<h4>–ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∑–∞–ø–∏—Å–µ–π<a class="headerlink" href="#id17" title="–°—Å—ã–ª–∫–∞ –Ω–∞ —ç—Ç–æ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫">ÔÉÅ</a></h4>
<p><strong>–ü—Ä–∏–º–µ—Ä: –ø–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># src/databases/dao/user_dao.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">select</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.ext.asyncio</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncSession</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.databases.dao.base</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseDAO</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.databases.sqlite.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">User</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.databases.sqlite.schemas</span><span class="w"> </span><span class="kn">import</span> <span class="n">UserResponse</span> <span class="c1"># –ò—Å–ø–æ–ª—å–∑—É–µ–º Pydantic-—Å—Ö–µ–º—É –¥–ª—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏</span>

<span class="k">class</span><span class="w"> </span><span class="nc">UserDAO</span><span class="p">(</span><span class="n">BaseDAO</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">User</span>

    <span class="nd">@classmethod</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_all_users</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">session</span><span class="p">:</span> <span class="n">AsyncSession</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">UserResponse</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, —Å–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ Pydantic-—Å—Ö–µ–º—É.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">query</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">model</span><span class="p">)</span> <span class="c1"># SELECT * FROM users;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="n">records</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">scalars</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span> <span class="c1"># –ò–∑–≤–ª–µ–∫–∞–µ–º –∫–∞–∫ –æ–±—ä–µ–∫—Ç—ã –º–æ–¥–µ–ª–∏ User</span>
        <span class="c1"># –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º ORM-–æ–±—ä–µ–∫—Ç—ã –≤ Pydantic-–æ–±—ä–µ–∫—Ç—ã –¥–ª—è –æ—Ç–≤–µ—Ç–∞</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">UserResponse</span><span class="o">.</span><span class="n">from_orm</span><span class="p">(</span><span class="n">record</span><span class="p">)</span> <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">records</span><span class="p">]</span>
</pre></div>
</div>
</section>
<section id="id18">
<h4>–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö<a class="headerlink" href="#id18" title="–°—Å—ã–ª–∫–∞ –Ω–∞ —ç—Ç–æ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫">ÔÉÅ</a></h4>
<p>–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è <strong>–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π</strong> –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è <strong>—Ñ–∏–ª—å—Ç—Ä—ã</strong> –≤ <code class="docutils literal notranslate"><span class="pre">select()</span></code>.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">where()</span></code> ‚Äî –≥–∏–±–∫–∏–π –∏ –º–æ—â–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è <strong>—Å–ª–æ–∂–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π</strong>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">filter_by()</span></code> ‚Äî –±–æ–ª–µ–µ <strong>—É–¥–æ–±–Ω—ã–π –∏ –ø—Ä–æ—Å—Ç–æ–π</strong> —Å–ø–æ—Å–æ–±, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –ø–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –∑–Ω–∞—á–µ–Ω–∏—è–º –ø–æ–ª–µ–π.</p></li>
</ul>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>–ú–µ—Ç–æ–¥</p></th>
<th class="head"><p>–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å</p></th>
<th class="head"><p>–ü—Ä–∏–º–µ—Ä</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">where()</span></code></p></td>
<td><p>–°–ª–æ–∂–Ω—ã–µ —É—Å–ª–æ–≤–∏—è, –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã (<code class="docutils literal notranslate"><span class="pre">&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;</span></code>, <code class="docutils literal notranslate"><span class="pre">!=</span></code>, <code class="docutils literal notranslate"><span class="pre">like</span></code>, <code class="docutils literal notranslate"><span class="pre">in</span></code>)</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">User.age</span> <span class="pre">&gt;</span> <span class="pre">18</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">filter_by()</span></code></p></td>
<td><p>–ü—Ä–æ—Å—Ç—ã–µ —É—Å–ª–æ–≤–∏—è –ø–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –ø–æ–ª—è–º</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">username=&quot;john_doe&quot;</span></code></p></td>
</tr>
</tbody>
</table>
<p><strong>–ü—Ä–∏–º–µ—Ä—ã:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">select</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.databases.sqlite.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">User</span>

<span class="c1"># –ü–æ–ª—É—á–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å—Ç–∞—Ä—à–µ 18 –ª–µ—Ç (where)</span>
<span class="n">query</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">age</span> <span class="o">&gt;</span> <span class="mi">18</span><span class="p">,</span> <span class="n">User</span><span class="o">.</span><span class="n">is_active</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span>

<span class="c1"># –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ –∏–º–µ–Ω–∏ (filter_by)</span>
<span class="n">query</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s2">&quot;john_doe&quot;</span><span class="p">)</span>

<span class="c1"># –ü–æ–ª—É—á–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (filter_by)</span>
<span class="n">query</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">is_active</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id19">
<h4>–í—ã–±–æ—Ä–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –∫–æ–ª–æ–Ω–æ–∫<a class="headerlink" href="#id19" title="–°—Å—ã–ª–∫–∞ –Ω–∞ —ç—Ç–æ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫">ÔÉÅ</a></h4>
<p>–ò–Ω–æ–≥–¥–∞ –≤ –∑–∞–ø—Ä–æ—Å–µ <strong>–Ω–µ –Ω—É–∂–Ω—ã –≤—Å–µ –ø–æ–ª—è</strong> –º–æ–¥–µ–ª–∏. –ú–æ–∂–Ω–æ —è–≤–Ω–æ —É–∫–∞–∑–∞—Ç—å –Ω—É–∂–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏ –≤ <code class="docutils literal notranslate"><span class="pre">select()</span></code>, —á—Ç–æ <strong>–æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å</strong> –∏ <strong>—Å–æ–∫—Ä–∞—Ç–∏—Ç –æ–±—ä—ë–º –ø–µ—Ä–µ–¥–∞–≤–∞–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö</strong>. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–∞–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ —É–¥–æ–±–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Å –ø–æ–º–æ—â—å—é <strong>—Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö Pydantic-—Å—Ö–µ–º</strong>.</p>
<p><strong>–ü—Ä–∏–º–µ—Ä: –ø–æ–ª—É—á–µ–Ω–∏–µ ID –∏ –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># src/databases/sqlite/schemas/user.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">ConfigDict</span>

<span class="k">class</span><span class="w"> </span><span class="nc">UsernameIdResponse</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Pydantic-—Å—Ö–µ–º–∞ –¥–ª—è –æ—Ç–≤–µ—Ç–∞ —Å ID –∏ –∏–º–µ–Ω–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">id</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">username</span><span class="p">:</span> <span class="nb">str</span>

    <span class="n">model_config</span> <span class="o">=</span> <span class="n">ConfigDict</span><span class="p">(</span>
        <span class="n">from_attributes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="c1"># –ü–æ–∑–≤–æ–ª—è–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å .from_orm() –∏ —Å –∫–æ—Ä—Ç–µ–∂–∞–º–∏/—Å–ª–æ–≤–∞—Ä—è–º–∏</span>
    <span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># src/databases/dao/user_dao.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">select</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.ext.asyncio</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncSession</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.databases.dao.base</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseDAO</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.databases.sqlite.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">User</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.databases.sqlite.schemas.user</span><span class="w"> </span><span class="kn">import</span> <span class="n">UsernameIdResponse</span>

<span class="k">class</span><span class="w"> </span><span class="nc">UserDAO</span><span class="p">(</span><span class="n">BaseDAO</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">User</span>

    <span class="nd">@classmethod</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_username_id</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">session</span><span class="p">:</span> <span class="n">AsyncSession</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">UsernameIdResponse</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ Pydantic-–æ–±—ä–µ–∫—Ç–æ–≤ UsernameIdResponse (id, username).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">query</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">username</span><span class="p">)</span> <span class="c1"># SELECT id, username FROM users;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="n">records</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">all</span><span class="p">()</span> <span class="c1"># –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç [(id1, username1), (id2, username2), ...]</span>
        <span class="c1"># –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –∫–æ—Ä—Ç–µ–∂–∏ –≤ Pydantic-–æ–±—ä–µ–∫—Ç—ã</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">UsernameIdResponse</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">record</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">username</span><span class="o">=</span><span class="n">record</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">records</span><span class="p">]</span>
</pre></div>
</div>
</section>
<section id="select-options">
<h4>–ü–æ–¥–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö (–û—Ç–Ω–æ—à–µ–Ω–∏—è) (—Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º <code class="docutils literal notranslate"><span class="pre">select()</span></code> –∏ <code class="docutils literal notranslate"><span class="pre">options()</span></code>)<a class="headerlink" href="#select-options" title="–°—Å—ã–ª–∫–∞ –Ω–∞ —ç—Ç–æ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫">ÔÉÅ</a></h4>
<p>–ö–æ–≥–¥–∞ —É –≤–∞—Å –µ—Å—Ç—å <strong>—Å–≤—è–∑–∞–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã</strong> (–Ω–∞–ø—Ä–∏–º–µ—Ä, <code class="docutils literal notranslate"><span class="pre">User</span></code> –∏ <code class="docutils literal notranslate"><span class="pre">Profile</span></code>), SQLAlchemy –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –º–æ–∂–µ—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å —Å–≤—è–∑–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ <strong>–ª–µ–Ω–∏–≤–æ</strong> (lazy loading). –≠—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –ø—Ä–æ–±–ª–µ–º–µ <strong>‚ÄúN+1 –∑–∞–ø—Ä–æ—Å–æ–≤‚Äù</strong>, –∫–æ–≥–¥–∞ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è N –æ–±—ä–µ–∫—Ç–æ–≤ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è N –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤.</p>
<p>SQLAlchemy –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç <strong>—Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –ø–æ–¥–≥—Ä—É–∑–∫–∏</strong>, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å —ç—Ç–æ–π –ø—Ä–æ–±–ª–µ–º—ã:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">joinedload()</span></code> ‚Äî –ø–æ–¥–≥—Ä—É–∑–∫–∞ —á–µ—Ä–µ–∑ <code class="docutils literal notranslate"><span class="pre">LEFT</span> <span class="pre">OUTER</span> <span class="pre">JOIN</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">selectinload()</span></code> ‚Äî –ø–æ–¥–≥—Ä—É–∑–∫–∞ —á–µ—Ä–µ–∑ –æ—Ç–¥–µ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å —Å <code class="docutils literal notranslate"><span class="pre">IN</span></code>. –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –¥–ª—è –±–æ–ª—å—à–∏—Ö –Ω–∞–±–æ—Ä–æ–≤ –¥–∞–Ω–Ω—ã—Ö.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">subqueryload()</span></code> ‚Äî –ø–æ–¥–≥—Ä—É–∑–∫–∞ —á–µ—Ä–µ–∑ –æ—Ç–¥–µ–ª—å–Ω—ã–π –ø–æ–¥–∑–∞–ø—Ä–æ—Å.</p></li>
</ul>
<p><strong>–ü—Ä–∏–º–µ—Ä —Å <code class="docutils literal notranslate"><span class="pre">selectinload</span></code> (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è —Å–ø–∏—Å–∫–æ–≤ —Å –æ—Ç–Ω–æ—à–µ–Ω–∏—è–º–∏):</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># src/databases/dao/user_dao.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">select</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.ext.asyncio</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncSession</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">selectinload</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.databases.dao.base</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseDAO</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.databases.sqlite.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">User</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.databases.sqlite.schemas</span><span class="w"> </span><span class="kn">import</span> <span class="n">UserResponse</span> <span class="c1"># –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è, —á—Ç–æ UserResponse –≤–∫–ª—é—á–∞–µ—Ç –ø—Ä–æ—Ñ–∏–ª—å</span>

<span class="k">class</span><span class="w"> </span><span class="nc">UserDAO</span><span class="p">(</span><span class="n">BaseDAO</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">User</span>

    <span class="nd">@classmethod</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_users_with_profiles</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">session</span><span class="p">:</span> <span class="n">AsyncSession</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">UserResponse</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –∏—Ö –ø—Ä–æ—Ñ–∏–ª—è–º–∏, –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–º–∏ –∑–∞ –æ–¥–∏–Ω –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">query</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">model</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">selectinload</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">profile</span><span class="p">))</span> <span class="c1"># –ü–æ–¥–≥—Ä—É–∑–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è</span>
        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="n">users</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">scalars</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="c1"># –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º ORM-–æ–±—ä–µ–∫—Ç—ã (—Å —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–º–∏ –ø—Ä–æ—Ñ–∏–ª—è–º–∏) –≤ Pydantic-–æ–±—ä–µ–∫—Ç—ã –¥–ª—è –æ—Ç–≤–µ—Ç–∞</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">UserResponse</span><span class="o">.</span><span class="n">from_orm</span><span class="p">(</span><span class="n">user</span><span class="p">)</span> <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">users</span><span class="p">]</span>
</pre></div>
</div>
<div class="tip admonition">
<p class="admonition-title">–°–æ–≤–µ—Ç: –ò–∑–±–µ–≥–∞–π—Ç–µ N+1</p>
<p>–í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –ø–æ–¥–≥—Ä—É–∑–∫–∏ (<code class="docutils literal notranslate"><span class="pre">selectinload</span></code>, <code class="docutils literal notranslate"><span class="pre">joinedload</span></code>) –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –æ—Ç–Ω–æ—à–µ–Ω–∏—è–º–∏, –æ—Å–æ–±–µ–Ω–Ω–æ –µ—Å–ª–∏ –≤—ã –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç–µ —Å–ø–∏—Å–æ–∫ –æ–±—ä–µ–∫—Ç–æ–≤, —Å–æ–¥–µ—Ä–∂–∞—â–∏—Ö —Å–≤—è–∑–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.</p>
</div>
</section>
</section>
<section id="update">
<h3>üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (Update)<a class="headerlink" href="#update" title="–°—Å—ã–ª–∫–∞ –Ω–∞ —ç—Ç–æ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫">ÔÉÅ</a></h3>
<p>SQLAlchemy –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç <strong>–¥–≤–∞ –æ—Å–Ω–æ–≤–Ω—ã—Ö –ø–æ–¥—Ö–æ–¥–∞</strong> –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö:</p>
<ul class="simple">
<li><p><strong>–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞</strong> ‚Äî —á–µ—Ä–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∞—Ç—Ä–∏–±—É—Ç–æ–≤ ORM-–æ–±—ä–µ–∫—Ç–∞ (–ø–∞—Ç—Ç–µ—Ä–Ω Unit of Work).</p></li>
<li><p><strong>–ú–∞—Å—Å–æ–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ</strong> ‚Äî —á–µ—Ä–µ–∑ –ø—Ä—è–º–æ–π SQL-–∑–∞–ø—Ä–æ—Å <code class="docutils literal notranslate"><span class="pre">UPDATE</span></code>.</p></li>
</ul>
<section id="id20">
<h4>–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞<a class="headerlink" href="#id20" title="–°—Å—ã–ª–∫–∞ –Ω–∞ —ç—Ç–æ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫">ÔÉÅ</a></h4>
<p>–≠—Ç–æ—Ç —Å–ø–æ—Å–æ–± –∏—Å–ø–æ–ª—å–∑—É–µ—Ç <strong>–ø–∞—Ç—Ç–µ—Ä–Ω Unit of Work</strong>, –≤ –∫–æ—Ç–æ—Ä–æ–º SQLAlchemy <strong>–æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è</strong> –≤ –æ–±—ä–µ–∫—Ç–∞—Ö –∏ <strong>–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç SQL-–∑–∞–ø—Ä–æ—Å—ã</strong> –ø—Ä–∏ –∫–æ–º–º–∏—Ç–µ. –û–Ω —É–¥–æ–±–µ–Ω –¥–ª—è <strong>–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞</strong>, –ø–æ–ª—É—á–µ–Ω–Ω–æ–≥–æ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.</p>
<p><strong>–ü—Ä–∏–º–µ—Ä: –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–≤—Ä—É—á–Ω—É—é)</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">src.databases.dao.user_dao</span><span class="w"> </span><span class="kn">import</span> <span class="n">UserDAO</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.databases.sqlite.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">connection</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.databases.sqlite.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">User</span> <span class="c1"># –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –º–æ–¥–µ–ª—å</span>

<span class="nd">@connection</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">update_user_name_manual</span><span class="p">(</span><span class="n">user_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">new_username</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">session</span><span class="p">):</span>
    <span class="c1"># 1. –ü–æ–ª—É—á–∞–µ–º –æ–±—ä–µ–∫—Ç –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö</span>
    <span class="n">user</span> <span class="o">=</span> <span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span> <span class="c1"># &lt;-- –ü–æ–ª—É—á–∞–µ–º –Ω–∞–ø—Ä—è–º—É—é</span>
    <span class="k">if</span> <span class="n">user</span><span class="p">:</span>
        <span class="c1"># 2. –ò–∑–º–µ–Ω—è–µ–º –∞—Ç—Ä–∏–±—É—Ç</span>
        <span class="n">user</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span> <span class="n">new_username</span>
        <span class="c1"># 3. –ò–∑–º–µ–Ω–µ–Ω–∏—è –±—É–¥—É—Ç –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω—ã –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–º @connection –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ –∏–∑ —Ñ—É–Ω–∫—Ü–∏–∏</span>
    <span class="k">return</span> <span class="n">user</span>
</pre></div>
</div>
<p><strong>–ü—Ä–∏–º–µ—Ä: –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º <code class="docutils literal notranslate"><span class="pre">BaseDAO</span></code> –∏ Pydantic-—Å—Ö–µ–º—ã –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏)</strong></p>
<p>–î–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏–∏ –∏ —É–¥–æ–±—Å—Ç–≤–∞, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –º–µ—Ç–æ–¥ <code class="docutils literal notranslate"><span class="pre">update_one_by_id</span></code> –≤ <code class="docutils literal notranslate"><span class="pre">BaseDAO</span></code>, –ø—Ä–∏–Ω–∏–º–∞—é—â–∏–π Pydantic-—Å—Ö–µ–º—É –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏–∑–º–µ–Ω—è–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö.</p>
<p><strong>–°–æ–∑–¥–∞–Ω–∏–µ Pydantic-—Å—Ö–µ–º—ã –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># src/databases/sqlite/schemas/user.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">ConfigDict</span><span class="p">,</span> <span class="n">EmailStr</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span> <span class="c1"># –ò—Å–ø–æ–ª—å–∑—É–µ–º Optional –¥–ª—è –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π</span>

<span class="k">class</span><span class="w"> </span><span class="nc">UserUpdateRequest</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Pydantic-—Å—Ö–µ–º–∞ –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.</span>
<span class="sd">    –í—Å–µ –ø–æ–ª—è –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã, —Ç–∞–∫ –∫–∞–∫ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –º–æ–≥—É—Ç –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å—Å—è –Ω–µ –≤—Å–µ –ø–æ–ª—è.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">username</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">email</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">EmailStr</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="c1"># password –Ω–µ –≤–∫–ª—é—á–µ–Ω–æ —Å—é–¥–∞, –µ—Å–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è –æ—Ç–¥–µ–ª—å–Ω—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç</span>

    <span class="n">model_config</span> <span class="o">=</span> <span class="n">ConfigDict</span><span class="p">(</span>
        <span class="n">from_attributes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="c1"># –ü–æ–∑–≤–æ–ª—è–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å .from_orm(), –µ—Å–ª–∏ –Ω—É–∂–Ω–æ</span>
    <span class="p">)</span>
</pre></div>
</div>
<p><strong>–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤ <code class="docutils literal notranslate"><span class="pre">BaseDAO</span></code>:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># src/databases/dao/base.py (–æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π BaseDAO)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.exc</span><span class="w"> </span><span class="kn">import</span> <span class="n">SQLAlchemyError</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.ext.asyncio</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncSession</span>

<span class="k">class</span><span class="w"> </span><span class="nc">BaseDAO</span><span class="p">:</span>
    <span class="n">model</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># ... (model, add, add_many, find_one_or_none_by_id)</span>

    <span class="nd">@classmethod</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">update_one_by_id</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">session</span><span class="p">:</span> <span class="n">AsyncSession</span><span class="p">,</span> <span class="n">data_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">BaseModel</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        –û–±–Ω–æ–≤–ª—è–µ—Ç –æ–¥–Ω—É –∑–∞–ø–∏—Å—å –ø–æ ID —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Pydantic-—Å—Ö–µ–º—ã –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">values_dict</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span><span class="n">exclude_unset</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># –ü–æ–ª—É—á–∞–µ–º —Ç–æ–ª—å–∫–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –ø–æ–ª—è –∏–∑ —Å—Ö–µ–º—ã</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">record</span> <span class="o">=</span> <span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">data_id</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">record</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="c1"># –û–±–Ω–æ–≤–ª—è–µ–º –∞—Ç—Ä–∏–±—É—Ç—ã ORM-–æ–±—ä–µ–∫—Ç–∞</span>
                <span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span> <span class="c1"># –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å –ë–î</span>
            <span class="k">return</span> <span class="n">record</span>
        <span class="k">except</span> <span class="n">SQLAlchemyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span> <span class="c1"># –û—Ç–∫–∞—Ç—ã–≤–∞–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –ø—Ä–∏ –æ—à–∏–±–∫–µ</span>
            <span class="k">raise</span> <span class="n">e</span>
</pre></div>
</div>
<p><strong>–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">src.databases.dao.user_dao</span><span class="w"> </span><span class="kn">import</span> <span class="n">UserDAO</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.databases.sqlite.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">connection</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.databases.sqlite.schemas</span><span class="w"> </span><span class="kn">import</span> <span class="n">UserUpdateRequest</span> <span class="c1"># –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º Pydantic-—Å—Ö–µ–º—É</span>

<span class="nd">@connection</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">update_user_via_dao</span><span class="p">(</span><span class="n">user_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">update_data</span><span class="p">:</span> <span class="n">UserUpdateRequest</span><span class="p">,</span> <span class="n">session</span><span class="p">):</span>
    <span class="c1"># Pydantic-—Å—Ö–µ–º–∞ update_data —É–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–æ–ª—è</span>
    <span class="n">updated_user</span> <span class="o">=</span> <span class="k">await</span> <span class="n">UserDAO</span><span class="o">.</span><span class="n">update_one_by_id</span><span class="p">(</span>
        <span class="n">session</span><span class="o">=</span><span class="n">session</span><span class="p">,</span>
        <span class="n">data_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span>
        <span class="n">values</span><span class="o">=</span><span class="n">update_data</span> <span class="c1"># –ü–µ—Ä–µ–¥–∞—ë–º –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π Pydantic-–æ–±—ä–µ–∫—Ç</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">updated_user</span>
</pre></div>
</div>
</section>
<section id="id21">
<h4>–ú–∞—Å—Å–æ–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ <code class="docutils literal notranslate"><span class="pre">update()</span></code><a class="headerlink" href="#id21" title="–°—Å—ã–ª–∫–∞ –Ω–∞ —ç—Ç–æ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫">ÔÉÅ</a></h4>
<p>–≠—Ç–æ—Ç –ø–æ–¥—Ö–æ–¥ <strong>–Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –æ–±—ä–µ–∫—Ç—ã –≤ –ø–∞–º—è—Ç—å</strong>, –∞ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç <strong>–ø—Ä—è–º–æ–π SQL-–∑–∞–ø—Ä–æ—Å <code class="docutils literal notranslate"><span class="pre">UPDATE</span></code></strong>, —á—Ç–æ –¥–µ–ª–∞–µ—Ç –µ–≥–æ <strong>—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ</strong> –ø—Ä–∏ <strong>–º–∞—Å—Å–æ–≤—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö</strong>.</p>
<p><strong>–ü—Ä–∏–º–µ—Ä: –º–∞—Å—Å–æ–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ —É—Å–ª–æ–≤–∏—é (–≤—Ä—É—á–Ω—É—é)</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">update</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.databases.dao.user_dao</span><span class="w"> </span><span class="kn">import</span> <span class="n">UserDAO</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.databases.sqlite.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">connection</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.databases.sqlite.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">User</span>

<span class="nd">@connection</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">update_users_by_age_manual</span><span class="p">(</span><span class="n">min_age</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">new_status</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">session</span><span class="p">:</span> <span class="n">AsyncSession</span><span class="p">):</span>
    <span class="n">stmt</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">update</span><span class="p">(</span><span class="n">User</span><span class="p">)</span>
        <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">age</span> <span class="o">&gt;=</span> <span class="n">min_age</span><span class="p">)</span> <span class="c1"># –£—Å–ª–æ–≤–∏–µ WHERE</span>
        <span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="n">new_status</span><span class="p">)</span>   <span class="c1"># –ù–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è</span>
    <span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">rowcount</span>  <span class="c1"># –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–∑–º–µ–Ω—ë–Ω–Ω—ã—Ö —Å—Ç—Ä–æ–∫</span>
</pre></div>
</div>
<p><strong>–ü—Ä–∏–º–µ—Ä: –º–∞—Å—Å–æ–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (—Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º <code class="docutils literal notranslate"><span class="pre">BaseDAO</span></code> –∏ Pydantic-—Å—Ö–µ–º –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∏ –∑–Ω–∞—á–µ–Ω–∏–π)</strong></p>
<p>–î–ª—è —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–≥–æ –º–∞—Å—Å–æ–≤–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ –≤ <code class="docutils literal notranslate"><span class="pre">BaseDAO</span></code>, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–π Pydantic-—Å—Ö–µ–º—ã –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∫–∞–∫ —Ñ–∏–ª—å—Ç—Ä–æ–≤, —Ç–∞–∫ –∏ –Ω–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π.</p>
<p><strong>–°–æ–∑–¥–∞–Ω–∏–µ Pydantic-—Å—Ö–µ–º –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∏ –∑–Ω–∞—á–µ–Ω–∏–π (–ø—Ä–∏–º–µ—Ä):</strong></p>
<p>–î–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å—Ö–µ–º—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, <code class="docutils literal notranslate"><span class="pre">UserUpdateRequest</span></code> –¥–ª—è –∑–Ω–∞—á–µ–Ω–∏–π) –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ, –Ω–∞–ø—Ä–∏–º–µ—Ä, <code class="docutils literal notranslate"><span class="pre">UserFilterSchema</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># src/databases/sqlite/schemas/user.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">ConfigDict</span><span class="p">,</span> <span class="n">EmailStr</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span>

<span class="c1"># ... (UserUpdateRequest –∫–∞–∫ —Ä–∞–Ω—å—à–µ)</span>

<span class="k">class</span><span class="w"> </span><span class="nc">UserFilterSchema</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Pydantic-—Å—Ö–µ–º–∞ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">username</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">email</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">EmailStr</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">is_active</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">model_config</span> <span class="o">=</span> <span class="n">ConfigDict</span><span class="p">(</span>
        <span class="n">from_attributes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
<p><strong>–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤ <code class="docutils literal notranslate"><span class="pre">BaseDAO</span></code>:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># src/databases/dao/base.py (–æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π BaseDAO)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">update</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.exc</span><span class="w"> </span><span class="kn">import</span> <span class="n">SQLAlchemyError</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.ext.asyncio</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncSession</span>

<span class="k">class</span><span class="w"> </span><span class="nc">BaseDAO</span><span class="p">:</span>
    <span class="c1"># ... (model, add, add_many, find_one_or_none_by_id, update_one_by_id)</span>

    <span class="nd">@classmethod</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">update_many_by_filter</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">session</span><span class="p">:</span> <span class="n">AsyncSession</span><span class="p">,</span> <span class="n">filter_criteria</span><span class="p">:</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">BaseModel</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        –ú–∞—Å—Å–æ–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π –ø–æ —Ñ–∏–ª—å—Ç—Ä—É, –∏—Å–ø–æ–ª—å–∑—É—è Pydantic-—Å—Ö–µ–º—ã.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">filter_dict</span> <span class="o">=</span> <span class="n">filter_criteria</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span><span class="n">exclude_unset</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã</span>
        <span class="n">values_dict</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span><span class="n">exclude_unset</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>         <span class="c1"># –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –Ω–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">stmt</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">update</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>
                <span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="o">**</span><span class="n">filter_dict</span><span class="p">)</span> <span class="c1"># &lt;-- Pydantic-—Å—Ö–µ–º–∞ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ (WHERE)</span>
                <span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="o">**</span><span class="n">values_dict</span><span class="p">)</span>    <span class="c1"># &lt;-- Pydantic-—Å—Ö–µ–º–∞ –¥–ª—è –Ω–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π (SET)</span>
            <span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>
            <span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">rowcount</span>
        <span class="k">except</span> <span class="n">SQLAlchemyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
            <span class="k">raise</span> <span class="n">e</span>
</pre></div>
</div>
<p><strong>–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">src.databases.dao.user_dao</span><span class="w"> </span><span class="kn">import</span> <span class="n">UserDAO</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.databases.sqlite.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">connection</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.databases.sqlite.schemas</span><span class="w"> </span><span class="kn">import</span> <span class="n">UserUpdateRequest</span><span class="p">,</span> <span class="n">UserFilterSchema</span>

<span class="nd">@connection</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">mass_update_users_via_dao</span><span class="p">(</span><span class="n">session</span><span class="p">):</span>
    <span class="c1"># –ü–æ–¥–≥–æ—Ç–æ–≤–∏–º —Ñ–∏–ª—å—Ç—Ä</span>
    <span class="n">filter_schema</span> <span class="o">=</span> <span class="n">UserFilterSchema</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s2">&quot;old_name&quot;</span><span class="p">)</span> <span class="c1"># –û–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ—Ö —Å username=&quot;old_name&quot;</span>
    <span class="c1"># –ü–æ–¥–≥–æ—Ç–æ–≤–∏–º –Ω–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è</span>
    <span class="n">values_schema</span> <span class="o">=</span> <span class="n">UserUpdateRequest</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s2">&quot;new_name&quot;</span><span class="p">)</span> <span class="c1"># –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å username=&quot;new_name&quot;</span>

    <span class="n">updated_count</span> <span class="o">=</span> <span class="k">await</span> <span class="n">UserDAO</span><span class="o">.</span><span class="n">update_many_by_filter</span><span class="p">(</span>
        <span class="n">session</span><span class="o">=</span><span class="n">session</span><span class="p">,</span>
        <span class="n">filter_criteria</span><span class="o">=</span><span class="n">filter_schema</span><span class="p">,</span> <span class="c1"># –ü–µ—Ä–µ–¥–∞—ë–º —Å—Ö–µ–º—É —Ñ–∏–ª—å—Ç—Ä–∞</span>
        <span class="n">values</span><span class="o">=</span><span class="n">values_schema</span>           <span class="c1"># –ü–µ—Ä–µ–¥–∞—ë–º —Å—Ö–µ–º—É –∑–Ω–∞—á–µ–Ω–∏–π</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;–û–±–Ω–æ–≤–ª–µ–Ω–æ </span><span class="si">{</span><span class="n">updated_count</span><span class="si">}</span><span class="s1"> –∑–∞–ø–∏—Å–µ–π&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">updated_count</span>
</pre></div>
</div>
</section>
</section>
<section id="delete">
<h3>üóëÔ∏è –£–¥–∞–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (Delete)<a class="headerlink" href="#delete" title="–°—Å—ã–ª–∫–∞ –Ω–∞ —ç—Ç–æ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫">ÔÉÅ</a></h3>
<p>SQLAlchemy –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç <strong>–¥–≤–∞ –æ—Å–Ω–æ–≤–Ω—ã—Ö –ø–æ–¥—Ö–æ–¥–∞</strong> –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è:</p>
<ul class="simple">
<li><p><strong>–û–±—ä–µ–∫—Ç–Ω–æ-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥</strong> ‚Äî —Å–Ω–∞—á–∞–ª–∞ –ø–æ–ª—É—á–∞–µ–º –æ–±—ä–µ–∫—Ç, –∑–∞—Ç–µ–º —É–¥–∞–ª—è–µ–º –µ–≥–æ.</p></li>
<li><p><strong>–ú–∞—Å—Å–æ–≤–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –Ω–∞ —É—Ä–æ–≤–Ω–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö</strong> ‚Äî –±–µ–∑ –∑–∞–≥—Ä—É–∑–∫–∏ –æ–±—ä–µ–∫—Ç–æ–≤ –≤ –ø–∞–º—è—Ç—å.</p></li>
</ul>
<section id="id22">
<h4>–£–¥–∞–ª–µ–Ω–∏–µ –≤ —Å—Ç–∏–ª–µ –û–û–ü<a class="headerlink" href="#id22" title="–°—Å—ã–ª–∫–∞ –Ω–∞ —ç—Ç–æ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫">ÔÉÅ</a></h4>
<p>–ü—Ä–∏ —ç—Ç–æ–º –ø–æ–¥—Ö–æ–¥–µ <strong>—Å–Ω–∞—á–∞–ª–∞ –ø–æ–ª—É—á–∞—é—Ç –æ–±—ä–µ–∫—Ç</strong> –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, –∞ –∑–∞—Ç–µ–º <strong>—É–¥–∞–ª—è—é—Ç –µ–≥–æ</strong> —Å –ø–æ–º–æ—â—å—é <code class="docutils literal notranslate"><span class="pre">session.delete()</span></code>. –≠—Ç–æ—Ç —Å–ø–æ—Å–æ–± —É–¥–æ–±–µ–Ω –¥–ª—è <strong>—É–¥–∞–ª–µ–Ω–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞</strong>, –ø–æ–ª—É—á–µ–Ω–Ω–æ–≥–æ –ø–æ ID –∏–ª–∏ –¥—Ä—É–≥–æ–º—É —É–Ω–∏–∫–∞–ª—å–Ω–æ–º—É –∫—Ä–∏—Ç–µ—Ä–∏—é.</p>
<p><strong>–ü—Ä–∏–º–µ—Ä: —É–¥–∞–ª–µ–Ω–∏–µ –æ–¥–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ –ø–æ ID (–≤—Ä—É—á–Ω—É—é)</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">src.databases.dao.user_dao</span><span class="w"> </span><span class="kn">import</span> <span class="n">UserDAO</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.databases.sqlite.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">connection</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.databases.sqlite.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">User</span> <span class="c1"># –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –º–æ–¥–µ–ª—å</span>

<span class="nd">@connection</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">delete_user_by_id_manual</span><span class="p">(</span><span class="n">user_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">session</span><span class="p">:</span> <span class="n">AsyncSession</span><span class="p">):</span>
    <span class="n">user</span> <span class="o">=</span> <span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span> <span class="c1"># &lt;-- –ü–æ–ª—É—á–∞–µ–º –Ω–∞–ø—Ä—è–º—É—é</span>
    <span class="k">if</span> <span class="n">user</span><span class="p">:</span>
        <span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">user</span><span class="p">)</span> <span class="c1"># –ü–æ–º–µ—á–∞–µ–º –æ–±—ä–µ–∫—Ç –∫–∞–∫ —É–¥–∞–ª—ë–Ω–Ω—ã–π</span>
    <span class="c1"># session.commit() –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ @connection</span>
    <span class="k">return</span> <span class="n">user</span>
</pre></div>
</div>
<p><strong>–ü—Ä–∏–º–µ—Ä: —É–¥–∞–ª–µ–Ω–∏–µ –æ–¥–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ –ø–æ ID (—Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º <code class="docutils literal notranslate"><span class="pre">BaseDAO</span></code>)</strong></p>
<p>–î–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –º–µ—Ç–æ–¥ <code class="docutils literal notranslate"><span class="pre">delete_one_by_id</span></code> –≤ <code class="docutils literal notranslate"><span class="pre">BaseDAO</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># src/databases/dao/base.py (–æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π BaseDAO)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.exc</span><span class="w"> </span><span class="kn">import</span> <span class="n">SQLAlchemyError</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.ext.asyncio</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncSession</span>

<span class="k">class</span><span class="w"> </span><span class="nc">BaseDAO</span><span class="p">:</span>
    <span class="c1"># ... (model, add, add_many, find_one_or_none_by_id, update_one_by_id, update_many_by_filter)</span>

    <span class="nd">@classmethod</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">delete_one_by_id</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">session</span><span class="p">:</span> <span class="n">AsyncSession</span><span class="p">,</span> <span class="n">data_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        –£–¥–∞–ª—è–µ—Ç –æ–¥–Ω—É –∑–∞–ø–∏—Å—å –ø–æ ID.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">data_id</span><span class="p">)</span> <span class="c1"># &lt;-- –ò—Å–ø–æ–ª—å–∑—É–µ–º session.get</span>
            <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
                <span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">data</span>
        <span class="k">except</span> <span class="n">SQLAlchemyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
            <span class="k">raise</span> <span class="n">e</span>
</pre></div>
</div>
<p><strong>–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">src.databases.dao.user_dao</span><span class="w"> </span><span class="kn">import</span> <span class="n">UserDAO</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.databases.sqlite.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">connection</span>

<span class="nd">@connection</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">delete_user_via_dao</span><span class="p">(</span><span class="n">user_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">session</span><span class="p">:</span> <span class="n">AsyncSession</span><span class="p">):</span>
    <span class="n">deleted_user</span> <span class="o">=</span> <span class="k">await</span> <span class="n">UserDAO</span><span class="o">.</span><span class="n">delete_one_by_id</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">deleted_user</span> <span class="c1"># –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —É–¥–∞–ª—ë–Ω–Ω—ã–π ORM-–æ–±—ä–µ–∫—Ç –∏–ª–∏ None</span>
</pre></div>
</div>
</section>
<section id="id23">
<h4>–ú–∞—Å—Å–æ–≤–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ <code class="docutils literal notranslate"><span class="pre">delete()</span></code><a class="headerlink" href="#id23" title="–°—Å—ã–ª–∫–∞ –Ω–∞ —ç—Ç–æ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫">ÔÉÅ</a></h4>
<p>–≠—Ç–æ—Ç –ø–æ–¥—Ö–æ–¥ <strong>–Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –æ–±—ä–µ–∫—Ç—ã –≤ –ø–∞–º—è—Ç—å</strong>, –∞ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç <strong>–ø—Ä—è–º–æ–π SQL-–∑–∞–ø—Ä–æ—Å <code class="docutils literal notranslate"><span class="pre">DELETE</span></code></strong>, —á—Ç–æ –¥–µ–ª–∞–µ—Ç –µ–≥–æ <strong>—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ</strong> –ø—Ä–∏ <strong>–º–∞—Å—Å–æ–≤–æ–º —É–¥–∞–ª–µ–Ω–∏–∏</strong>.</p>
<p><strong>–ü—Ä–∏–º–µ—Ä: –º–∞—Å—Å–æ–≤–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –ø–æ —É—Å–ª–æ–≤–∏—é (–≤—Ä—É—á–Ω—É—é)</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">delete</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.databases.dao.user_dao</span><span class="w"> </span><span class="kn">import</span> <span class="n">UserDAO</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.databases.sqlite.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">connection</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.databases.sqlite.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">User</span>

<span class="nd">@connection</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">delete_users_by_age_manual</span><span class="p">(</span><span class="n">min_age</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">session</span><span class="p">:</span> <span class="n">AsyncSession</span><span class="p">):</span>
    <span class="n">stmt</span> <span class="o">=</span> <span class="n">delete</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">age</span> <span class="o">&gt;=</span> <span class="n">min_age</span><span class="p">)</span> <span class="c1"># –£—Å–ª–æ–≤–∏–µ WHERE</span>
    <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">rowcount</span>  <span class="c1"># –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–¥–∞–ª—ë–Ω–Ω—ã—Ö —Å—Ç—Ä–æ–∫</span>
</pre></div>
</div>
</section>
<section id="id24">
<h4>–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã —É–¥–∞–ª–µ–Ω–∏—è –≤ <code class="docutils literal notranslate"><span class="pre">BaseDAO</span></code><a class="headerlink" href="#id24" title="–°—Å—ã–ª–∫–∞ –Ω–∞ —ç—Ç–æ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫">ÔÉÅ</a></h4>
<p>–î–ª—è —É–Ω–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ —É–¥–æ–±—Å—Ç–≤–∞ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã —É–¥–∞–ª–µ–Ω–∏—è –≤ <code class="docutils literal notranslate"><span class="pre">BaseDAO</span></code>.</p>
<p><strong>–ú–∞—Å—Å–æ–≤–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –ø–æ —Ñ–∏–ª—å—Ç—Ä–∞–º (—Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Pydantic-—Å—Ö–µ–º—ã)</strong></p>
<p>–ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –º–µ—Ç–æ–¥, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–π Pydantic-—Å—Ö–µ–º—É –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏ –ø–µ—Ä–µ–¥–∞—á–∏ –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏.</p>
<p><strong>–°–æ–∑–¥–∞–Ω–∏–µ Pydantic-—Å—Ö–µ–º—ã –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ (–ø—Ä–∏–º–µ—Ä):</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># src/databases/sqlite/schemas/user.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">ConfigDict</span><span class="p">,</span> <span class="n">EmailStr</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span>

<span class="c1"># ... (UserUpdateRequest, UsernameIdResponse –∫–∞–∫ —Ä–∞–Ω—å—à–µ)</span>

<span class="k">class</span><span class="w"> </span><span class="nc">UserFilterSchema</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Pydantic-—Å—Ö–µ–º–∞ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">username</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">email</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">EmailStr</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">is_active</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">model_config</span> <span class="o">=</span> <span class="n">ConfigDict</span><span class="p">(</span>
        <span class="n">from_attributes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
<p><strong>–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤ <code class="docutils literal notranslate"><span class="pre">BaseDAO</span></code>:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># src/databases/dao/base.py (–æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π BaseDAO)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">delete</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.exc</span><span class="w"> </span><span class="kn">import</span> <span class="n">SQLAlchemyError</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.ext.asyncio</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncSession</span>

<span class="k">class</span><span class="w"> </span><span class="nc">BaseDAO</span><span class="p">:</span>
    <span class="c1"># ... (model, add, add_many, find_one_or_none_by_id, update_one_by_id, update_many_by_filter, delete_one_by_id)</span>

    <span class="nd">@classmethod</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">delete_many_by_filter</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">session</span><span class="p">:</span> <span class="n">AsyncSession</span><span class="p">,</span> <span class="n">filters</span><span class="p">:</span> <span class="n">BaseModel</span> <span class="o">|</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        –ú–∞—Å—Å–æ–≤–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π –ø–æ —Ñ–∏–ª—å—Ç—Ä—É, –∏—Å–ø–æ–ª—å–∑—É—è Pydantic-—Å—Ö–µ–º—É.</span>
<span class="sd">        –ï—Å–ª–∏ filters=None, —É–¥–∞–ª—è–µ—Ç –≤—Å–µ –∑–∞–ø–∏—Å–∏ (–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ!).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">filters</span><span class="p">:</span>
            <span class="n">filter_dict</span> <span class="o">=</span> <span class="n">filters</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span><span class="n">exclude_unset</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã –∏–∑ —Å—Ö–µ–º—ã</span>
            <span class="n">stmt</span> <span class="o">=</span> <span class="n">delete</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">model</span><span class="p">)</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="o">**</span><span class="n">filter_dict</span><span class="p">)</span> <span class="c1"># &lt;-- Pydantic-—Å—Ö–µ–º–∞ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ (WHERE)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">stmt</span> <span class="o">=</span> <span class="n">delete</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">model</span><span class="p">)</span> <span class="c1"># –£–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>
            <span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">rowcount</span>
        <span class="k">except</span> <span class="n">SQLAlchemyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
            <span class="k">raise</span> <span class="n">e</span>

    <span class="nd">@classmethod</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">delete_many_by_ids</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">session</span><span class="p">:</span> <span class="n">AsyncSession</span><span class="p">,</span> <span class="n">ids</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        –ú–∞—Å—Å–æ–≤–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π –ø–æ —Å–ø–∏—Å–∫—É ID.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ids</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="n">stmt</span> <span class="o">=</span> <span class="n">delete</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">model</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">in_</span><span class="p">(</span><span class="n">ids</span><span class="p">))</span> <span class="c1"># –£—Å–ª–æ–≤–∏–µ WHERE id IN (...)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>
            <span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">rowcount</span>
        <span class="k">except</span> <span class="n">SQLAlchemyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
            <span class="k">raise</span> <span class="n">e</span>
</pre></div>
</div>
<p><strong>–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">src.databases.dao.user_dao</span><span class="w"> </span><span class="kn">import</span> <span class="n">UserDAO</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.databases.sqlite.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">connection</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.databases.sqlite.schemas</span><span class="w"> </span><span class="kn">import</span> <span class="n">UserFilterSchema</span>

<span class="nd">@connection</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">mass_delete_users_by_filter</span><span class="p">(</span><span class="n">session</span><span class="p">):</span>
    <span class="c1"># –ü–æ–¥–≥–æ—Ç–æ–≤–∏–º —Ñ–∏–ª—å—Ç—Ä</span>
    <span class="n">filter_schema</span> <span class="o">=</span> <span class="n">UserFilterSchema</span><span class="p">(</span><span class="n">is_active</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="c1"># –£–¥–∞–ª–∏—Ç—å –≤—Å–µ—Ö –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</span>

    <span class="n">deleted_count</span> <span class="o">=</span> <span class="k">await</span> <span class="n">UserDAO</span><span class="o">.</span><span class="n">delete_many_by_filter</span><span class="p">(</span>
        <span class="n">session</span><span class="o">=</span><span class="n">session</span><span class="p">,</span>
        <span class="n">filters</span><span class="o">=</span><span class="n">filter_schema</span> <span class="c1"># –ü–µ—Ä–µ–¥–∞—ë–º —Å—Ö–µ–º—É —Ñ–∏–ª—å—Ç—Ä–∞</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;–£–¥–∞–ª–µ–Ω–æ </span><span class="si">{</span><span class="n">deleted_count</span><span class="si">}</span><span class="s1"> –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">deleted_count</span>

<span class="nd">@connection</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">mass_delete_users_by_ids</span><span class="p">(</span><span class="n">user_ids_to_delete</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">session</span><span class="p">):</span>
    <span class="n">deleted_count</span> <span class="o">=</span> <span class="k">await</span> <span class="n">UserDAO</span><span class="o">.</span><span class="n">delete_many_by_ids</span><span class="p">(</span>
        <span class="n">session</span><span class="o">=</span><span class="n">session</span><span class="p">,</span>
        <span class="n">ids</span><span class="o">=</span><span class="n">user_ids_to_delete</span> <span class="c1"># –ü–µ—Ä–µ–¥–∞—ë–º —Å–ø–∏—Å–æ–∫ ID</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;–£–¥–∞–ª–µ–Ω–æ </span><span class="si">{</span><span class="n">deleted_count</span><span class="si">}</span><span class="s1"> –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ ID&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">deleted_count</span>
</pre></div>
</div>
<div class="warning admonition">
<p class="admonition-title">–í–∞–∂–Ω–æ</p>
<p>–ë—É–¥—å—Ç–µ –æ—Å—Ç–æ—Ä–æ–∂–Ω—ã —Å –º–µ—Ç–æ–¥–æ–º <code class="docutils literal notranslate"><span class="pre">delete_many_by_filter</span></code>, –µ—Å–ª–∏ –ø–µ—Ä–µ–¥–∞—ë—Ç–µ <code class="docutils literal notranslate"><span class="pre">filters=None</span></code> ‚Äî –æ–Ω —É–¥–∞–ª–∏—Ç <strong>–≤—Å–µ –∑–∞–ø–∏—Å–∏</strong> –≤ —Ç–∞–±–ª–∏—Ü–µ.</p>
</div>
<p>–û—Ç–ª–∏—á–Ω–æ! –î–∞–≤–∞–π —É–ª—É—á—à–∏–º —Ä–∞–∑–¥–µ–ª ‚ÄúAlembic‚Äù, —Å–¥–µ–ª–∞–≤ –µ–≥–æ –±–æ–ª–µ–µ –ø–æ–ª–Ω—ã–º, —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º, –ø–æ–Ω—è—Ç–Ω—ã–º –∏ —Å–≤—è–∑–∞–Ω–Ω—ã–º —Å —Ç–µ–º, —á—Ç–æ —É–∂–µ –æ–ø–∏—Å–∞–Ω–æ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏. –í–æ—Ç —á—Ç–æ –º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å:</p>
<ol class="arabic simple">
<li><p><strong>–î–æ–±–∞–≤–∏—Ç—å –≤–≤–µ–¥–µ–Ω–∏–µ:</strong> –û–±—ä—è—Å–Ω–∏—Ç—å, <em>—á—Ç–æ —Ç–∞–∫–æ–µ</em> Alembic –∏ <em>–∑–∞—á–µ–º</em> –æ–Ω –Ω—É–∂–µ–Ω –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ SQLAlchemy –∏ ORM-–º–æ–¥–µ–ª–µ–π.</p></li>
<li><p><strong>–£—Ç–æ—á–Ω–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:</strong> –£–∫–∞–∑–∞—Ç—å, —á—Ç–æ –∫–æ–º–∞–Ω–¥–∞ <code class="docutils literal notranslate"><span class="pre">alembic</span> <span class="pre">init</span> <span class="pre">-t</span> <span class="pre">async</span> <span class="pre">alembic</span></code> —É–∂–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –≤ —à–∞–±–ª–æ–Ω–µ, –∏ –æ–ø–∏—Å–∞—Ç—å, <em>—á—Ç–æ</em> –æ–Ω–∞ –¥–µ–ª–∞–µ—Ç <em>–∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ</em> –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ —à–∞–±–ª–æ–Ω–∞ (–ø–∞–ø–∫–∞ <code class="docutils literal notranslate"><span class="pre">alembic/</span></code>, <code class="docutils literal notranslate"><span class="pre">alembic.ini</span></code>).</p></li>
<li><p><strong>–î–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫—É <code class="docutils literal notranslate"><span class="pre">env.py</span></code>:</strong> –û–±—ä—è—Å–Ω–∏—Ç—å, <em>–∑–∞—á–µ–º</em> –Ω—É–∂–Ω—ã –∏–º–ø–æ—Ä—Ç—ã –º–æ–¥–µ–ª–µ–π (—á—Ç–æ–±—ã Alembic ‚Äú–≤–∏–¥–µ–ª‚Äù –∏—Ö –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ), –∏ <em>–∫–∞–∫ –∏–º–µ–Ω–Ω–æ</em> –ø–æ–¥–∫–ª—é—á–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ <code class="docutils literal notranslate"><span class="pre">configs.settings</span></code>.</p></li>
<li><p><strong>–î–æ–±–∞–≤–∏—Ç—å —Ä–∞–∑–¥–µ–ª –ø—Ä–æ —Ä–∞–±–æ—Ç—É —Å –º–∏–≥—Ä–∞—Ü–∏—è–º–∏:</strong> –û–±—ä—è—Å–Ω–∏—Ç—å, <em>–∫–∞–∫</em> –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å, –ø—Ä–∏–º–µ–Ω—è—Ç—å, –æ—Ç–∫–∞—Ç—ã–≤–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏, –∏ <em>–∫–æ–≥–¥–∞</em> —ç—Ç–æ –Ω—É–∂–Ω–æ –¥–µ–ª–∞—Ç—å (–ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –º–æ–¥–µ–ª–µ–π).</p></li>
<li><p><strong>–î–æ–±–∞–≤–∏—Ç—å —Ä–∞–∑–¥–µ–ª –ø—Ä–æ <code class="docutils literal notranslate"><span class="pre">alembic.ini</span></code>:</strong> –£–ø–æ–º—è–Ω—É—Ç—å, —á—Ç–æ –æ—Å–Ω–æ–≤–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –¥–µ–ª–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ <code class="docutils literal notranslate"><span class="pre">env.py</span></code>, –Ω–æ <code class="docutils literal notranslate"><span class="pre">alembic.ini</span></code> —Å–æ–¥–µ—Ä–∂–∏—Ç –¥—Ä—É–≥–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ, –º–æ–∂–Ω–æ –∫—Ä–∞—Ç–∫–æ).</p></li>
<li><p><strong>–°–≤—è–∑–∞—Ç—å —Å ORM-–º–æ–¥–µ–ª—è–º–∏:</strong> –ü–æ–¥—á–µ—Ä–∫–Ω—É—Ç—å, —á—Ç–æ –º–∏–≥—Ä–∞—Ü–∏–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è <em>–Ω–∞ –æ—Å–Ω–æ–≤–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ ORM-–º–æ–¥–µ–ª—è—Ö</em>.</p></li>
<li><p><strong>–î–æ–±–∞–≤–∏—Ç—å –∞–¥–º–æ–Ω–∏—Ü–∏–∏:</strong> –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å <code class="docutils literal notranslate"><span class="pre">seealso</span></code>, <code class="docutils literal notranslate"><span class="pre">warning</span></code>, <code class="docutils literal notranslate"><span class="pre">tip</span></code> –¥–ª—è –≤–∞–∂–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.</p></li>
</ol>
<p>–í–æ—Ç –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π —Ä–∞–∑–¥–µ–ª:</p>
</section>
</section>
</section>
<hr class="docutils" />
<section id="alembic">
<h2>üß≠ Alembic: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ö–µ–º–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö<a class="headerlink" href="#alembic" title="–°—Å—ã–ª–∫–∞ –Ω–∞ —ç—Ç–æ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫">ÔÉÅ</a></h2>
<p>Alembic ‚Äî —ç—Ç–æ <strong>–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—Ö–µ–º–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö</strong>, <strong>–∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å SQLAlchemy</strong>. –û–Ω –ø–æ–∑–≤–æ–ª—è–µ—Ç <strong>—É–ø—Ä–∞–≤–ª—è—Ç—å –≤–µ—Ä—Å–∏—è–º–∏ —Å—Ö–µ–º—ã</strong>, <strong>–æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</strong> –≤ ORM-–º–æ–¥–µ–ª—è—Ö –∏ <strong>–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å</strong> SQL-—Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (–∏–ª–∏ –æ—Ç–∫–∞—Ç–∞) —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö. –≠—Ç–æ <strong>–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ</strong> –ø—Ä–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ, —á—Ç–æ–±—ã <strong>—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å</strong> –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ —Å —Ä–µ–∞–ª—å–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π –ë–î.</p>
<p><strong>–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Alembic:</strong></p>
<ul class="simple">
<li><p><strong>–ö–æ–Ω—Ç—Ä–æ–ª—å –∏–∑–º–µ–Ω–µ–Ω–∏–π:</strong> –ö–∞–∂–¥–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ö–µ–º—ã —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç—Å—è –≤ –≤–∏–¥–µ –º–∏–≥—Ä–∞—Ü–∏–∏.</p></li>
<li><p><strong>–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:</strong> –ü–æ–∑–≤–æ–ª—è–µ—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–µ—Ä–µ–¥ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ.</p></li>
<li><p><strong>–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è:</strong> –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å CI/CD –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π —Å—Ö–µ–º—ã.</p></li>
</ul>
<section id="id25">
<h3>üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Alembic (—É–∂–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –≤ —à–∞–±–ª–æ–Ω–µ)<a class="headerlink" href="#id25" title="–°—Å—ã–ª–∫–∞ –Ω–∞ —ç—Ç–æ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫">ÔÉÅ</a></h3>
<p>–í —à–∞–±–ª–æ–Ω–µ Alembic —É–∂–µ <strong>–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω</strong> –∫–æ–º–∞–Ω–¥–æ–π <code class="docutils literal notranslate"><span class="pre">alembic</span> <span class="pre">init</span> <span class="pre">-t</span> <span class="pre">async</span> <span class="pre">alembic</span></code>. –≠—Ç–æ —Å–æ–∑–¥–∞–ª–æ:</p>
<ul class="simple">
<li><p>–î–∏—Ä–µ–∫—Ç–æ—Ä–∏—é <code class="docutils literal notranslate"><span class="pre">alembic/</span></code> ‚Äî —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ–∞–π–ª—ã –º–∏–≥—Ä–∞—Ü–∏–π –∏ —à–∞–±–ª–æ–Ω —Å–∫—Ä–∏–ø—Ç–æ–≤.</p></li>
<li><p>–§–∞–π–ª <code class="docutils literal notranslate"><span class="pre">alembic.ini</span></code> ‚Äî –æ—Å–Ω–æ–≤–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Alembic (—á–∞—Å—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –≤ <code class="docutils literal notranslate"><span class="pre">env.py</span></code>).</p></li>
<li><p>–§–∞–π–ª <code class="docutils literal notranslate"><span class="pre">alembic/env.py</span></code> ‚Äî —Ç–æ—á–∫–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å ORM-–º–æ–¥–µ–ª—è–º–∏.</p></li>
</ul>
</section>
<section id="id26">
<h3>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ <code class="docutils literal notranslate"><span class="pre">alembic/env.py</span></code><a class="headerlink" href="#id26" title="–°—Å—ã–ª–∫–∞ –Ω–∞ —ç—Ç–æ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫">ÔÉÅ</a></h3>
<p>–§–∞–π–ª <code class="docutils literal notranslate"><span class="pre">alembic/env.py</span></code> ‚Äî <strong>–∫–ª—é—á–µ–≤–æ–π</strong> –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ Alembic —Å –≤–∞—à–∏–º –ø—Ä–æ–µ–∫—Ç–æ–º SQLAlchemy. –û–Ω —É–∫–∞–∑—ã–≤–∞–µ—Ç Alembic, <strong>—Å –∫–∞–∫–∏–º–∏ –º–æ–¥–µ–ª—è–º–∏</strong> —Ä–∞–±–æ—Ç–∞—Ç—å –∏ <strong>–∫–∞–∫ –ø–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è</strong> –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.</p>
<div class="toggle docutils container">
</div>
<section id="id27">
<h4>1. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è ORM-–º–æ–¥–µ–ª–µ–π<a class="headerlink" href="#id27" title="–°—Å—ã–ª–∫–∞ –Ω–∞ —ç—Ç–æ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫">ÔÉÅ</a></h4>
<p>Alembic –¥–æ–ª–∂–µ–Ω <strong>–∑–Ω–∞—Ç—å</strong> –æ –≤–∞—à–∏—Ö ORM-–º–æ–¥–µ–ª—è—Ö, —á—Ç–æ–±—ã <strong>–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏</strong> –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π. –î–ª—è —ç—Ç–æ–≥–æ <strong>–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ</strong> –∏–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ <strong>–≤—Å–µ</strong> —Å–≤–æ–∏ –º–æ–¥–µ–ª–∏ –∏ <strong>–±–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å <code class="docutils literal notranslate"><span class="pre">Base</span></code></strong> –≤ <code class="docutils literal notranslate"><span class="pre">alembic/env.py</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># alembic/env.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">logging.config</span><span class="w"> </span><span class="kn">import</span> <span class="n">fileConfig</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">engine_from_config</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">pool</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">alembic</span><span class="w"> </span><span class="kn">import</span> <span class="n">context</span>

<span class="c1"># –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º Base –∏ –≤—Å–µ –º–æ–¥–µ–ª–∏</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.databases.sqlite.models.base</span><span class="w"> </span><span class="kn">import</span> <span class="n">Base</span> <span class="c1"># &lt;-- –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.databases.sqlite.models.user</span><span class="w"> </span><span class="kn">import</span> <span class="n">User</span>  <span class="c1"># &lt;-- –ü—Ä–∏–º–µ—Ä –º–æ–¥–µ–ª–∏</span>
<span class="c1"># from src.databases.sqlite.models.post import Post  # &lt;-- –î–æ–±–∞–≤–ª—è–π—Ç–µ –¥—Ä—É–≥–∏–µ –º–æ–¥–µ–ª–∏ –ø–æ –º–µ—Ä–µ –∏—Ö —Å–æ–∑–¥–∞–Ω–∏—è</span>
<span class="c1"># from src.databases.sqlite.models.comment import Comment # &lt;-- –∏ —Ç.–¥.</span>

<span class="c1"># this is the Alembic Config object</span>
<span class="n">config</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">config</span>

<span class="c1"># Interpret the config file for Python logging.</span>
<span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">config_file_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">fileConfig</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">config_file_name</span><span class="p">)</span>

<span class="c1"># –£–∫–∞–∑—ã–≤–∞–µ–º Alembic, –∫–∞–∫–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å</span>
<span class="n">target_metadata</span> <span class="o">=</span> <span class="n">Base</span><span class="o">.</span><span class="n">metadata</span> <span class="c1"># &lt;-- –£–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –≤—Å–µ—Ö –º–æ–¥–µ–ª–µ–π, –Ω–∞—Å–ª–µ–¥—É—é—â–∏—Ö—Å—è –æ—Ç Base</span>

<span class="k">def</span><span class="w"> </span><span class="nf">run_migrations_offline</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run migrations in &#39;offline&#39; mode.&quot;&quot;&quot;</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get_main_option</span><span class="p">(</span><span class="s2">&quot;sqlalchemy.url&quot;</span><span class="p">)</span>
    <span class="n">context</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span>
        <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span>
        <span class="n">target_metadata</span><span class="o">=</span><span class="n">target_metadata</span><span class="p">,</span> <span class="c1"># &lt;-- –ü–µ—Ä–µ–¥–∞—ë–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ</span>
        <span class="n">literal_binds</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">dialect_opts</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;paramstyle&quot;</span><span class="p">:</span> <span class="s2">&quot;named&quot;</span><span class="p">},</span>
    <span class="p">)</span>

    <span class="k">with</span> <span class="n">context</span><span class="o">.</span><span class="n">begin_transaction</span><span class="p">():</span>
        <span class="n">context</span><span class="o">.</span><span class="n">run_migrations</span><span class="p">()</span>


<span class="k">def</span><span class="w"> </span><span class="nf">run_migrations_online</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run migrations in &#39;online&#39; mode.&quot;&quot;&quot;</span>
    <span class="n">connectable</span> <span class="o">=</span> <span class="n">engine_from_config</span><span class="p">(</span>
        <span class="n">config</span><span class="o">.</span><span class="n">get_section</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">config_ini_section</span><span class="p">),</span>
        <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;sqlalchemy.&quot;</span><span class="p">,</span>
        <span class="n">poolclass</span><span class="o">=</span><span class="n">pool</span><span class="o">.</span><span class="n">NullPool</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">with</span> <span class="n">connectable</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
        <span class="n">context</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span>
            <span class="n">connection</span><span class="o">=</span><span class="n">connection</span><span class="p">,</span> <span class="n">target_metadata</span><span class="o">=</span><span class="n">target_metadata</span> <span class="c1"># &lt;-- –ü–µ—Ä–µ–¥–∞—ë–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ</span>
        <span class="p">)</span>

        <span class="k">with</span> <span class="n">context</span><span class="o">.</span><span class="n">begin_transaction</span><span class="p">():</span>
            <span class="n">context</span><span class="o">.</span><span class="n">run_migrations</span><span class="p">()</span>


<span class="k">if</span> <span class="n">context</span><span class="o">.</span><span class="n">is_offline_mode</span><span class="p">():</span>
    <span class="n">run_migrations_offline</span><span class="p">()</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">run_migrations_online</span><span class="p">()</span>
</pre></div>
</div>
<div class="warning admonition">
<p class="admonition-title">–í–∞–∂–Ω–æ: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –º–æ–¥–µ–ª–µ–π</p>
<p>–ü–æ—Å–ª–µ <strong>—Å–æ–∑–¥–∞–Ω–∏—è</strong> –Ω–æ–≤–æ–π ORM-–º–æ–¥–µ–ª–∏ <strong>–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ</strong> –¥–æ–±–∞–≤—å—Ç–µ –µ—ë –∏–º–ø–æ—Ä—Ç –≤ <code class="docutils literal notranslate"><span class="pre">alembic/env.py</span></code>, —á—Ç–æ–±—ã Alembic –º–æ–≥ –µ—ë ‚Äú—É–≤–∏–¥–µ—Ç—å‚Äù –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –º–∏–≥—Ä–∞—Ü–∏–π.</p>
</div>
</section>
<section id="id28">
<h4>2. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î<a class="headerlink" href="#id28" title="–°—Å—ã–ª–∫–∞ –Ω–∞ —ç—Ç–æ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫">ÔÉÅ</a></h4>
<p>Alembic –Ω—É–∂–Ω–æ –∑–Ω–∞—Ç—å, <strong>–∫–∞–∫ –ø–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è</strong> –∫ –≤–∞—à–µ–π –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö. –í —à–∞–±–ª–æ–Ω–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ë–î —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ <code class="docutils literal notranslate"><span class="pre">configs.settings</span></code>. –ù—É–∂–Ω–æ <strong>—É–∫–∞–∑–∞—Ç—å</strong> Alembic –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å URL –∏–∑ —ç—Ç–∏—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫.</p>
<p>–û–±—ã—á–Ω–æ —ç—Ç–æ –¥–µ–ª–∞–µ—Ç—Å—è –≤ <code class="docutils literal notranslate"><span class="pre">alembic.ini</span></code>, –Ω–æ –≤ <code class="docutils literal notranslate"><span class="pre">env.py</span></code> –º–æ–∂–Ω–æ <strong>–ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å</strong> –∏–ª–∏ <strong>—É–∫–∞–∑–∞—Ç—å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># alembic/env.py (—Ñ—Ä–∞–≥–º–µ–Ω—Ç, –≤–Ω—É—Ç—Ä–∏ —Ñ—É–Ω–∫—Ü–∏–π run_migrations_online/run_migrations_offline)</span>
<span class="c1"># ...</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">configs.settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">settings</span> <span class="c1"># &lt;-- –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</span>

<span class="k">def</span><span class="w"> </span><span class="nf">run_migrations_online</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run migrations in &#39;online&#39; mode.&quot;&quot;&quot;</span>
    <span class="c1"># –ü–æ–ª—É—á–∞–µ–º URL –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫</span>
    <span class="n">alembic_config</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get_section</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">config_ini_section</span><span class="p">)</span>
    <span class="n">alembic_config</span><span class="p">[</span><span class="s1">&#39;sqlalchemy.url&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">sqlite</span><span class="o">.</span><span class="n">database_url</span> <span class="c1"># &lt;-- –ü–æ–¥—Å—Ç–∞–≤–ª—è–µ–º URL –∏–∑ settings</span>

    <span class="n">connectable</span> <span class="o">=</span> <span class="n">engine_from_config</span><span class="p">(</span>
        <span class="n">alembic_config</span><span class="p">,</span> <span class="c1"># &lt;-- –ü–µ—Ä–µ–¥–∞—ë–º –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π –∫–æ–Ω—Ñ–∏–≥</span>
        <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">poolclass</span><span class="o">=</span><span class="n">pool</span><span class="o">.</span><span class="n">NullPool</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="c1"># ...</span>
</pre></div>
</div>
<p>–ò–ª–∏, –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ, –º–æ–∂–Ω–æ –∑–∞–¥–∞—Ç—å URL –Ω–∞–ø—Ä—è–º—É—é –≤ <code class="docutils literal notranslate"><span class="pre">config.set_main_option</span></code> –≤ <code class="docutils literal notranslate"><span class="pre">run_migrations_offline</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># alembic/env.py (—Ñ—Ä–∞–≥–º–µ–Ω—Ç, –≤–Ω—É—Ç—Ä–∏ —Ñ—É–Ω–∫—Ü–∏–∏ run_migrations_offline)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">configs.settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">settings</span> <span class="c1"># &lt;-- –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</span>

<span class="k">def</span><span class="w"> </span><span class="nf">run_migrations_offline</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run migrations in &#39;offline&#39; mode.&quot;&quot;&quot;</span>
    <span class="c1"># url = config.get_main_option(&quot;sqlalchemy.url&quot;)</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">sqlite</span><span class="o">.</span><span class="n">database_url</span> <span class="c1"># &lt;-- –ü–æ–ª—É—á–∞–µ–º URL –∏–∑ settings</span>
    <span class="n">context</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span>
        <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span>
        <span class="n">target_metadata</span><span class="o">=</span><span class="n">target_metadata</span><span class="p">,</span>
        <span class="n">literal_binds</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">dialect_opts</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;paramstyle&quot;</span><span class="p">:</span> <span class="s2">&quot;named&quot;</span><span class="p">},</span>
    <span class="p">)</span>
    <span class="c1"># ...</span>
</pre></div>
</div>
<p>–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ URL –≤ <code class="docutils literal notranslate"><span class="pre">.env</span></code> —Ñ–∞–π–ª–µ (–∏, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ, –≤ <code class="docutils literal notranslate"><span class="pre">settings</span></code>) –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω.</p>
</section>
</section>
<section id="id29">
<h3>üîÑ –†–∞–±–æ—Ç–∞ —Å –º–∏–≥—Ä–∞—Ü–∏—è–º–∏<a class="headerlink" href="#id29" title="–°—Å—ã–ª–∫–∞ –Ω–∞ —ç—Ç–æ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫">ÔÉÅ</a></h3>
<p>–ü–æ—Å–ª–µ <strong>–∏–∑–º–µ–Ω–µ–Ω–∏—è</strong> ORM-–º–æ–¥–µ–ª–µ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—è –∏–ª–∏ –Ω–æ–≤–æ–π –º–æ–¥–µ–ª–∏) <strong>–≤—Å–µ–≥–¥–∞</strong> –Ω—É–∂–Ω–æ <strong>—Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å</strong> –∏ <strong>–ø—Ä–∏–º–µ–Ω–∏—Ç—å</strong> –º–∏–≥—Ä–∞—Ü–∏—é.</p>
<section id="id30">
<h4>–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏<a class="headerlink" href="#id30" title="–°—Å—ã–ª–∫–∞ –Ω–∞ —ç—Ç–æ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫">ÔÉÅ</a></h4>
<p>–°–æ–∑–¥–∞—ë—Ç —Ñ–∞–π–ª –º–∏–≥—Ä–∞—Ü–∏–∏, –æ–ø–∏—Å—ã–≤–∞—é—â–∏–π –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –º–æ–¥–µ–ª—è—Ö:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>alembic<span class="w"> </span>revision<span class="w"> </span>--autogenerate<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;–û–ø–∏—Å–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, Add Post model)&quot;</span>
</pre></div>
</div>
<p>Alembic –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ç–µ–∫—É—â–∏–µ –º–æ–¥–µ–ª–∏ –∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π SQL-—Å–∫—Ä–∏–ø—Ç –≤ <code class="docutils literal notranslate"><span class="pre">alembic/versions/</span></code>.</p>
</section>
<section id="id31">
<h4>–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏<a class="headerlink" href="#id31" title="–°—Å—ã–ª–∫–∞ –Ω–∞ —ç—Ç–æ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫">ÔÉÅ</a></h4>
<p>–ü—Ä–∏–º–µ–Ω—è–µ—Ç <strong>–≤—Å–µ</strong> –Ω–µ–ø—Ä–∏–º–µ–Ω—ë–Ω–Ω—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>alembic<span class="w"> </span>upgrade<span class="w"> </span>head
</pre></div>
</div>
<p>–î–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è <strong>–∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π</strong> –º–∏–≥—Ä–∞—Ü–∏–∏:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>alembic<span class="w"> </span>upgrade<span class="w"> </span>&lt;revision_id&gt;
</pre></div>
</div>
</section>
<section id="id32">
<h4>–û—Ç–∫–∞—Ç –º–∏–≥—Ä–∞—Ü–∏–∏<a class="headerlink" href="#id32" title="–°—Å—ã–ª–∫–∞ –Ω–∞ —ç—Ç–æ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫">ÔÉÅ</a></h4>
<p>–û—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç <strong>–ø–æ—Å–ª–µ–¥–Ω—é—é</strong> –ø—Ä–∏–º–µ–Ω—ë–Ω–Ω—É—é –º–∏–≥—Ä–∞—Ü–∏—é:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>alembic<span class="w"> </span>downgrade<span class="w"> </span>-1
</pre></div>
</div>
<p>–î–ª—è –æ—Ç–∫–∞—Ç–∞ <strong>–¥–æ</strong> –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –≤–µ—Ä—Å–∏–∏:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>alembic<span class="w"> </span>downgrade<span class="w"> </span>&lt;revision_id&gt;
</pre></div>
</div>
<div class="tip admonition">
<p class="admonition-title">–°–æ–≤–µ—Ç: –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏</p>
<p>–í—Å–µ–≥–¥–∞ <strong>–ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ</strong> —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –º–∏–≥—Ä–∞—Ü–∏–π –ø–µ—Ä–µ–¥ –∏—Ö –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º. Alembic –º–æ–∂–µ—Ç –Ω–µ –≤—Å–µ–≥–¥–∞ —É–≥–∞–¥–∞—Ç—å —Å–ª–æ–∂–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –∫–æ–ª–æ–Ω–∫–∏). –ò–Ω–æ–≥–¥–∞ –Ω—É–∂–Ω–æ <strong>—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</strong> —Ñ–∞–π–ª –º–∏–≥—Ä–∞—Ü–∏–∏ –≤—Ä—É—á–Ω—É—é.</p>
</div>
<div class="warning admonition">
<p class="admonition-title">–í–∞–∂–Ω–æ: ENUM –∏ SQLite</p>
<p>–ï—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ —Ç–∏–ø <code class="docutils literal notranslate"><span class="pre">ENUM</span></code> –∏ <strong>SQLite</strong>, —É—á—Ç–∏—Ç–µ, —á—Ç–æ SQLite –µ–≥–æ <strong>–Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç</strong> –Ω–∞–ø—Ä—è–º—É—é. Alembic –±—É–¥–µ—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è <code class="docutils literal notranslate"><span class="pre">ENUM</span></code>, –Ω–æ –æ–Ω–∏ –º–æ–≥—É—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å –∏–ª–∏ –≤–µ—Å—Ç–∏ —Å–µ–±—è –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ. –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ <code class="docutils literal notranslate"><span class="pre">String</span></code> –∏–ª–∏ <code class="docutils literal notranslate"><span class="pre">Integer</span></code> —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –¢–∞–∫–∂–µ <strong>–Ω–µ –∑–∞–±—ã–≤–∞–π—Ç–µ —É–¥–∞–ª—è—Ç—å</strong> —Ç–∏–ø <code class="docutils literal notranslate"><span class="pre">ENUM</span></code> –ø—Ä–∏ –æ—Ç–∫–∞—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏, –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ –∫–∞—Å—Ç–æ–º–Ω—É—é –ª–æ–≥–∏–∫—É –¥–ª—è –µ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è.</p>
</div>
</section>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="–ù–∏–∂–Ω—è—è –æ–±–ª–∞—Å—Ç—å">
        <a href="recommendations.html" class="btn btn-neutral float-left" title="Recommendations: –ü–æ–ª–µ–∑–Ω—ã–µ –¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> –ü—Ä–µ–¥—ã–¥—É—â–∞—è</a>
        <a href="documentation.html" class="btn btn-neutral float-right" title="üìö –†–∞–±–æ—Ç–∞ —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π" accesskey="n" rel="next">–°–ª–µ–¥—É—é—â–∞—è <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; –ê–≤—Ç–æ—Ä—Å–∫–∏–µ –ø—Ä–∞–≤–∞ 2025, maxlansky. </p>
  </div>

  –°–æ–±—Ä–∞–Ω–æ –ø—Ä–∏ –ø–æ–º–æ—â–∏ <a href="https://www.sphinx-doc.org/">Sphinx</a> —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">—Ç–µ–º—ã,</a>
    –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–π <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>